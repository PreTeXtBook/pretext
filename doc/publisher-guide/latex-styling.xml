<?xml version="1.0" encoding="UTF-8"?>

<!--   This file is part of the documentation of PreTeXt      -->
<!--                                                          -->
<!--      PreTeXt Author's Guide                              -->
<!--                                                          -->
<!-- Copyright (C) 2013-2017  Robert A. Beezer, David Farmer  -->
<!-- See the file COPYING for copying conditions.             -->

<chapter xml:id="latex-styles">
    <title><latex /> Styles</title>

    <introduction>
        <p>Print and <init>PDF</init> output is created when <pretext/> outputs a <latex/> file, which can subsequently be easily converted to <init>PDF</init> with engines like <c>pdflatex</c> and <c>xelatex</c>.  There are many ways to influence the style (look, appearance) of this output, enhancing the content, but without changing it.  This chapter is directed at publishers who desire to create an attractive and consistent design for their books or articles.</p>

        <p>Please read this chapter thorougly once before embarking.  Certain important points are made in certain contexts, yet are universally applicable.  If you cherry-pick, you will miss them.  Note also that some simple changes, like font size, are described in <xref ref="pdf-print"/>.</p>
    </introduction>

    <section>
        <title>Preparation</title>

        <p>We do not encourage authors to make small adjustments in style, especially if they have few skills in book design.  Instead, they should choose a design built by others that will fit their needs and desires.  We do encourage publishers with design skills to create complete and harmonious designs, and to donate these back to <pretext/> with an open license, for use by all authors.  This chapter assumes you are such a publisher.  Further, it assumes you have certain technical skills.  Specifically<ul>
            <li>Good familiarity with basic <tex/> and <latex/>.</li>
            <li>The ability to debug <latex/> compilations gone bad.</li>
            <li>Willingness to study several <latex/> packages that may be new to you.</li>
            <li>Willingess to mimic and experiment with basic eXtensible Stylsheet Language (<init>XSL</init>).</li>
        </ul>Fortunately, it is easy to start small, get good results, and expand your skills further.</p>

        <p>Begin by creating a file that is a new <init>XSL</init> stylesheet.  You can likely safely copy a mature one from the <c>xsl/latex</c> directory.  Be certain to keep the first few declarations.  The <tag>xsl:import</tag> is critical, since it will <q>pull in</q> all the basic code for the <pretext/> conversion to <latex/>.  You will be overriding and appending to that code (which <pretext/> has made straightforward).  You can start with an absolute path from your filesystem root, but once public a relative path will be necessary.  Remove all of the <tag>xsl:template</tag> elements, leaving a hollow shell to begin working with.</p>

        <p>What we are doing here is similar to the discussion of <q>thin <init>XSL</init> stylesheets</q> in the <url href="https://pretextbook.org/doc/author-guide/html/processing-thin-xsl.html">Author's Guide</url>, only thicker.  String parameters are also described in this guide, at <xref ref="processing-parameters"/>.</p>
    </section>

    <section>
        <title>Overview</title>

        <p>Some changes in style are effected by setting string parameters that exist for use at the command line.  However, the more flexible features come from the selection by <pretext/> of certain <latex/> packages.  These have been chosen for their flexibility, maturity, and stability.  They should be part of a full <latex/> installation, especially one based on TeXLive.  We presume each author has a similar installation.  Please let us know of any exceptions.  Please try to avoid requiring new packages as part of your style, and if necessary, be sure they are mainstream ones.  Start a discussion on the development forum if you think it is warranted or necessary.  It may be difficult and error-prone for you to employ and integrate an obscure package, and it will cause problems for authors who want to use your style.</p>

        <p>This is an incomplete list of the primary packages we employ, and their general purpose.  They, and their documentation, can be easily found at the <url href="https://ctan.org/">Comprehensive <tex/> Archive Network</url>, aka <init>CTAN</init>.</p>

        <table>
            <caption>Principal <latex/> packages used for styles</caption>

            <tabular>
                <row>
                    <cell><c>geometry</c></cell>
                    <cell>Specification of the sizes of paper, margins, headers and footers</cell>
                </row>
                <row>
                    <cell><c>titleps</c></cell>
                    <cell>Headers and footers (part of <c>titlesec</c>)</cell>
                </row>
                <row>
                    <cell><c>titlesec</c></cell>
                    <cell>Titles of divisions</cell>
                </row>
                <row>
                    <cell><c>tcolorbox</c></cell>
                    <cell>Boxes, colors, <etc/> for <tag>example</tag>, <tag>remark</tag>, <etc/></cell>
                </row>
            </tabular>
        </table>
    </section>

    <section xml:id="page-shape">
        <title>Page Shape</title>

        <p>Various dimensions of a printed page, including the page itself, may be adjusted using the <c>geometry</c> package, so study the documentation of this package to explore possibilities.  The options of this package may be also set on the command line.  To make options part of your style, place the <tag>xsl:param</tag> declaration in your stylesheet as follows (note the two sets of quotes):<cd>
            <cline>&lt;xsl:param name="latex.geometry" select="'foo'"/&gt;</cline>
        </cd>This will have the effect of placing the following line into the preamble of the resulting <latex/> output file, in the right place:<cd>
            <cline>\geometry{foo}</cline>
        </cd>Of course, you will want to use something meaningful, such as<cd>
            <cline>&lt;xsl:param name="latex.geometry" select="'a4paper,total={16cm,25cm}'"/&gt;</cline>
        </cd>to produce in the <latex/> output<cd>
            <cline>\geometry{a4paper,total={16cm,25cm}}</cline>
        </cd></p>

        <p>This is typical and illustrates two important universal points.  First, <pretext/> puts surrounding infrastructure in place.  In this case the <c>geometry</c> package is loaded, and in an order that does not cause conflicts, plus the <c>\geometry{}</c> command itself is placed and output by <pretext/>.  As a style writer, you simply provide the package options you desire.  Second, <q>garbage in, garbage out.</q>  It is very easy to make a typo in your style, and have the <latex/> compilation fail.  This is why we assume you are comfortable with <latex/> compilation and debugging, and not every author should be a style writer.</p>

        <p>Set the document font size first, for this will influence later choices.  The string parameter, <c>latex.font.size</c> (which has <c>pt</c> as part of the value) will set an optimal line width.  This line width should translate to about 75 characters per line, at the upper end of recommendations for an optimal width.  It will also match closely (but not exactly) to line lengths in <init>HTML</init> output.  You can look into teh <latex/> output before you experiment to see the value used when the stock <c>\geometry{}</c> command is issued.  You are certainly able to override this width, but read the next paragraph carefully.</p>

        <p>This raises two important more universal points.  You should expect to repeatedly examine the <latex/> output as you develop a style.  And most important<mdash/>are you tempted to use a small font, and <em>increase</em> the line width so as to cram more material onto the page, so your book is shorter, and sells via print-on-demand for $7 rather than $8?  Then you misunderstood that there are time-tested recommendations for the optimal number of characters per line for human readers, and we just counseled you that <pretext/> is <em>already at the high end of these recommendations</em>.  You have a certain freedom as a style writer.  Use it responsibly.  Enhance the content provided by authors, don't degrade it.</p>

        <p>This is the place to think about headers and footers on the page, since you will want to make room for them, and with spacing away from the primary content.  See <xref ref="style-headers-footers"/>.</p>
    </section>

    <section xml:id="style-headers-footers">
        <title>Headers and Footers</title>

        <p>The <c>titleps</c> package cooperates with <q>traditional</q> <latex/> divisions, such as <c>\chapter</c> and <c>\section</c>, and the <c>titlesec</c> package, to pick up the titles of divisions automatically and migrate them to headers and footers on a page.  The <c>ps</c> is short for <q>page style</q>, and the documentation is a <init>PDF</init> file <em>within</em> the distribution for the <c>titlesec</c> package.  Primarily, we let <latex/> manage the selection of its page styles: <c>empty</c>, <c>plain</c>, and <c>headings</c>.  (The <latex/> <c>myheadings</c> page style is ignored.)  <pretext/> does some management in the front matter.  As a style writer it is not your concern where these styles are employed, but you do influence what information they contain and were it is placed on a page.</p>

        <p>Add an <tag>xsl:template</tag> to your stylesheet that begins with<cd>
            <cline>&lt;xsl:template match="article" mode="titleps-plain"&gt;</cline>
        </cd>This would then set a style for a <c>plain</c> page within an <tag>article</tag>.  Perhaps just a page number centered in the footer?  The text produced by this template (see <xref ref="style-xsl-101"/>) will then be placed immediately after a <c>titlesec</c> command in the preamble to renew the page style.  More precisely, immediately after<cd>
            <cline>\renewpagestyle{plain}</cline>
        </cd>Note that this means the first and last characters of the text produced are a <tex/> group ({,}).</p>

        <p>The definition of this template will override (replace) the definition given in any imported stylesheet.  You can replace the value of the <attr>match</attr> attribute with <c>book</c> to make your style apply to a <pretext/> <tag>book</tag>.  If your style will be used for both books and articles, and you want the <c>plain</c> style to be identical for both, you can expand the <attr>match</attr> attribute to have the value <c>article|book</c>.  To have different <c>plain</c> styles for a book versus an article, make two separate templates.</p>

        <p>The <c>titleps</c> package allows at least twelve options per page style:  even-numbered page versus odd-numbered page with two-sided printing; left, center, right; header or footer.  There are semi-automatic customizable rules, variable widths allowing hanging styles, choices of marks (division at page-start versus division at page-end versus new-division-mid-page, including combinations at the same time), and more.  Note that the <latex/> system of <c>\markleft</c> and <c>\markboth</c> has been abandonded.  (Did I hear you say, <q>Good riddance!</q>?)</p>

        <p>
          Some care must be taken with using <c>\thechapter</c> to get the chapter number, since strange things happen in the frontmatter and backmatter, where chapters are numberless.   One solution is to use <c>\ifthechapter{}{}</c> which allows you to control the behavior dependent on whether there is a current chapter number.  For example, if you wanted the center of the even-numbered pages to contain <q>Chapter 3: Derivatives</q> you would use
            <cd>\sethead[][\ifthechapter{Chapter \thechapter: }{}\chaptertitle][]{}{}{}</cd>
          which would then just put <q>Index</q> in the index, and nothing at all in the preface.
        </p>

        <p>
          A similar approach could be used to deal with section numbers and titles in the case that the introduction of a chapter is multiple pages, using <c>\ifthesection{}{}</c>.
        </p>

        <p>2019-09-30: we have not tested one-sided versus two-sided very rigoursly.  Please report problems.</p>
    </section>

    <section>
        <title>Titles of Divisions</title>

        <p>The <c>titlesec</c> package cooperates with <q>traditional</q> <latex/> divisions, such as <c>\chapter</c> and <c>\section</c>, to style the start of each division, containing its <pretext/> <tag>title</tag> and in most instances, its number.  If a division is credited to (multiple) <tag>author</tag>, then that information can be styled, and there are plans (2018-09-30) for epigraphs.</p>

        <p><pretext/> manages numbered versus unnumbered divisions, the correct level for one-off divisions like a <tag>preface</tag> or <tag>appendix</tag>, and the specialized divisions such as <tag>exercises</tag> and <tag>references</tag>.  A style writer creates two styles at each level of the hierarchy, for a numbered variant, and an unnumbered variant.  <c>titlesec</c> uses a <c>numberless</c> key to indicate the latter.  A named template, such as<cd>
            <cline>&lt;xsl:template name="titlesec-section-style"&gt;</cline>
        </cd>would produce text containing complete <c>titlesec</c> commands <c>\titleformat</c> and <c>\titlespacing</c> in both numbered and unnumbered variants.</p>

        <p>There are five <latex/> macros created by <pretext/> at the start of each division.  For example, <c>\authorsptx</c> is a comma-separated list of the content of all the <tag>author</tag> elements for the division, in the order given.  Look in the <latex/>output to find the others nearby.  A robust style will include this information, even if the first use of the style may not have any divisions credited to others.</p>

        <p>The table of contents and the index are created by a single <latex/> macro.  This creates a small technical challenge, since <pretext/> never has a chance to write the contents of the heading and must take what it is given.  The upshot is that the <c>\titleptx</c> macro will be wrong or empty.  So instead, use the <c>titlesec</c> device of using the macro parameter <c>#1</c> for the title in the correct argument of <c>\titleformat</c>.  We have enabled this possibility through the package's <c>explicit</c> option.  We believe the <c>numberless</c> variant of a <tag>chapter</tag> of a <tag>book</tag>, and the <c>numberless</c> variant of a <tag>section</tag> of an <tag>article</tag>, are the only places this is necessary.  2019-09-30:  we will contemplate if this should be the rule and the <c>\titleptx</c> macro will go away.  Advise if you see a good answer, either way.</p>

        <p>2019-09-30:  these templates are highly likely to break into two modes (format and spacing), with a <attr>match</attr> that can react to <tag>chapter</tag>, <tag>section</tag>, <etc/>, perhaps differently for books versus articles.  The change will only imply some minor editing to achieve the same end result, so don't hold back waiting.</p>
    </section>

    <section>
        <title>Environments and Blocks</title>

        <p>Objects like <tag>example</tag> and <tag>remark</tag> are almost invariably children of a division, numbered, and work best with a <tag>title</tag>.  <c>tcolorbox</c> is a massive package, that we have taken to as a solution to many under-the-bonnet technical problems, such as a hanging indent for numbers of <tag>exercise</tag> or laying out the panels of a <tag>sidebyside</tag>.  But it also allows an incredible variety of styling options for these intermediate chunks of text.  Think of variable placements of numbers and titles, borders and boxes, and colored backgrounds.  With freedom comes responsibility!  With a light touch, you can <em>help</em> your reader navigate the inherent structure of your <pretext/> source.</p>

        <p>Whatever you call them: environments, blocks, or information objects, almost every one can be styled separately  (2019-09-30: not captioned items yet, such as <tag>figure</tag>).  For example,<cd>
            <cline>&lt;xsl:template match="example" mode="tcb-style"&gt;</cline>
            <cline>    &lt;xsl:text&gt;colback=pink,&lt;/xsl:text&gt;</cline>
            <cline>&lt;/xsl:template&gt;</cline>
        </cd>would cause the background of every <tag>example</tag> to be light red in color.  To make every <pretext/> element that is a variant of an <tag>example</tag> look identical, use one of the <term>entities</term> defined in <c>xsl/entities.ent</c>,<cd>
            <cline>&lt;xsl:template match="&amp;EXAMPLE-LIKE;" mode="tcb-style"&gt;</cline>
            <cline>    &lt;xsl:text&gt;colback=pink,&lt;/xsl:text&gt;</cline>
            <cline>&lt;/xsl:template&gt;</cline>
        </cd>.  This would affect <tag>example</tag>, <tag>question</tag>, and <tag>problem</tag>, and future-proof your style when there is a demand for <tag>illustration</tag> as a new kind of <q>example-like.</q></p>

        <p>There is only one mode, but it can handle a variety of <pretext/> elements in the <attr>match</attr>.  The text produced by the template will be supplied in a named <c>tcolorbox</c> style via a <c>\tcbset{}</c> command.  It is marginally more complicated than that.  <pretext/> will manage certain aspects of creating a <c>tcolorbox</c>, such as forming the <c>tcolorbox</c> <c>title</c> to be a string like <q>Example 4.5 The Chain Rule.</q>, or just <q>Example 4.6</q> when an author does not include a <pretext/> <tag>title</tag>.  As a style writer, you can change the font, color and placement of that string, but not the use of the type-name, the number, the title, or their order.  The text of your template is additive, meaning it is in addition to what the stock <pretext/> conversion provides.  Your options come last, so will be new and effective, or will replace what the base conversion to <latex/> does.  So in the example above, the base conversion to <latex/> has <c>colback=white</c> (rather than the default gray!), and this will be overridden since pink will come later.</p>
    </section>

    <section>
        <title>Fonts</title>

        <introduction>
            <p>Part of a book's style is the choice of fonts.  As of 2019-01-03 we have made some progress on understanding the use of fonts in <latex/> to the point where we can design interfaces that will make it simpler for you to experiment with different choices and preserve various features that <pretext/> enables.</p>

            <p>The first thing to understand is that the <c>xelatex</c> engine is much more capable of employing modern fonts.  <tex/> was built in the late 1970's when computer resources were at a premium, and the idea of mixing mathematics with non-Western languages and scripts may have been fanciful.  The <c>pdflatex</c> engine is rooted in this history.  We now have the Unicode standard, thoroughly integrated into web browsers, and companion scalable OpenType fonts.  In contrast to <tex/>, XeTeX was designed to work better with a multitude of fonts.  So we organize this section by this distinction.</p>
        </introduction>

        <subsection>
            <title>Processing with <c>pdflatex</c></title>

            <p>Fonts used by <latex/> come in <term>encodings</term>.  The original encoding is known as <c>OT1</c> and organizes glyphs (shapes of individual characters) 128 at a time.  Since this puts regular Latin letters in one group, and accented letters into another group, this makes automatic hyphenation impossible if accented letters are used (as in many European countries and much of the Americas).  The 1990 <tex/> Users Group (<acro>TUG</acro>) meeting in Cork, Ireland, formulated new and improved encodings.  The <c>T1</c> encoding is one result, and so it is known as the <term>Cork</term> encoding (and also as <c>EC</c>).  It groups 256 glyphs together at a time.  So you need only know that a <c>T1</c> encoding is better than an <c>OT1</c> encoding.  If you want to know more (much more), locate <articletitle><latex/> font encodings</articletitle> by Mittlebach, Fairbairns, &amp; Lemberg.</p>

            <p>The <latex/> Font Catalogue<fn><url href="http://www.tug.dk/FontCatalogue/"/></fn> is a great resource for locating different fonts.  The fonts and their packages are likely already installed (this information is provided), or there is enough information about how to install the package in a standard way.  Each gives exact directions on how to enable the font for a document.  For example, Iwona<fn><url href="http://www.tug.dk/FontCatalogue/iwona/"/></fn>, a sans-serif font with support for mathematics, can be employed as the document font simply by including the following in the preamble:<cd>
                <cline>\usepackage[math]{iwona}</cline>
                <cline>\usepackage[T1]{fontenc}</cline>
            </cd>This suggested use of <c>fontenc</c> package (not to be confused with the <c>fontspec</c> package) indicates the availability of a <c>T1</c> encoding.</p>
            <p>Note: when the <latex/> Font Catalogue says <q><init>OTF</init> or <init>TTF</init> available</q> then the font can also be used with <c>xelatex</c>.  When it says <q><init>OTF</init> or <init>TTF</init> only</q> then the font <em>cannot</em> be used via <c>pdflatex</c>.  Read on.</p>
        </subsection>

        <subsection>
            <title>Processing with <c>xelatex</c></title>

            <p>TrueType fonts (<init>TTF</init>, <c>*.ttf</c> files) have been improved upon by the creation of OpenType fonts (<init>OTF</init>, <c>*.otf</c> files).  The main difference is that <init>OTF</init> fonts have a variety of <term>features</term> which can be selected or not.  For the remainder, we will reference <init>OTF</init> fonts only, but nearly everything applies equally well to <init>TTF</init> fonts.</p>

            <p>The main difference with <c>xelatex</c> and <init>OTF</init> fonts is that <c>xelatex</c> expects the font files to be part of the system software and are managed by the operating system and its tools.  So, for example, in the example above installing the <c>iwona</c> package will place files into your <term>texmf</term> tree, where they remain unknown to your operating system.  So you will need to learn how to use your operating system to locate and install <init>OTF</init> files (or make them known to your operating system).  With luck, popular fonts may be easy to install using your system's package manager.</p>

            <p>So installing fonts into a system is a bit of a hurdle, and as a style writer, you are reliant on authors who use your style to understand this requirement.</p>

            <!-- https://askubuntu.com/questions/3697/how-do-i-install-fonts -->
            <paragraphs>
                <title>Locating an <init>OTF</init> font</title>

                <p>Since I have the <latex/> <c>iwona</c> package, I can expect the <init>OTF</init> version of the font to be somewhere.  I know I have the <latex/> package by using a TeXLive tool to search for the style file.<cd>
                    <cline>kpsewhich iwona.sty</cline>
                </cd>will return the full path to that file.</p>

                <p>On my Linux system, with TeXLive installed via a Debian/Ubuntu package, I can locate the main <init>OTF</init> file for the Iwona font by exploring the relevant directories (<c>fonts/opentype</c> looks promising), or I can use the system <c>find</c> utility to search for filenames with <c>iwona</c> or <c>Iwona</c> in the name.  There it is:<cd>
                    <cline>/usr/share/texlive/texmf-dist/fonts/opentype/nowacki/iwona/Iwona-Regular.otf</cline>
                </cd></p>
            </paragraphs>

            <paragraphs>
                <title>Making an <init>OTF</init> font known to the system</title>

                <p>On my Linux system,  I need to copy this file (and its companions) into the system directory<cd>
                    <cline>/usr/local/share/fonts</cline>
                </cd>and reboot, or rebuild the font cache with<cd>
                    <cline>fc-cache -f -v</cline>
                </cd>Finally, I can check that the font is known to the system with<cd>
                    <cline>fc-list</cline>
                </cd></p>

                <p>On a Mac, Mitch Keller reports on 2019-01-02 that <q>I opened the directory on my hard drive containing the <init>OTF</init> file, double clicked on the font (opens the macOS application Font Book, which comes with the OS), and then clicked the <c>Install Font</c> button.</q></p>
           </paragraphs>

            <paragraphs>
                <title>Information about an <init>OTF</init> font</title>

                <p>To learn more about this particular font TeXLive provides an executable, <c>otfinfo</c>, which I can use as (omitting the long directory path here for clarity)<cd>
                    <cline>otfinfo -i Iwona-Regular.otf</cline>
                </cd>  The first part of the output is
                <cd>
                Family:              Iwona
                Subfamily:           Regular
                Full name:           Iwona-Regular
                PostScript name:     Iwona-Regular
                </cd>  The critical piece of information here is the font's name: <c>Iwona-Regular</c>.  I can also learn which OpenType features are available
                <cd>
                $ otfinfo -f Iwona-Regular.otf

                aalt    Access All Alternates
                c2sc    Small Capitals From Capitals
                cpsp    Capital Spacing
                dlig    Discretionary Ligatures
                dnom    Denominators
                frac    Fractions
                hist    Historical Forms
                kern    Kerning
                liga    Standard Ligatures
                lnum    Lining Figures
                numr    Numerators
                onum    Oldstyle Figures
                ordn    Ordinals
                pnum    Proportional Figures
                sinf    Scientific Inferiors
                smcp    Small Capitals
                ss02    Stylistic Set 2
                sups    Superscript
                tnum    Tabular Figures
                zero    Slashed Zero
                </cd>This will all be useful shortly.</p>
            </paragraphs>

            <paragraphs>
                <title>Using an <init>OTF</init> font with <c>xelatex</c></title>

                <p>Depending on the package, now it can be as simple as simply including <c>\usepackage{}</c> in your preamble and the font can be used with different weights and shapes, and certain features are enabled.  However, sometimes you want more control, or you want to use more than one font in a document.  Now the <c>fontspec</c> package is your tool.</p>

                <p>The simplest example of using <c>fontspec</c> would be to recall the font name from above, and in your preamble use<cd>
                    <cline>\setmainfont{Iwona-Regular}</cline>
                </cd>This font name has the hyphen in lieu of a space, but names with spaces are just fine.  An optional argument will let you customize the use of the font, such as turning on some of the features.  Read the <c>fontspec</c> documenttion for all the finer points.  Hopefully this has given you a start.</p>

                <p>Note that <c>fontspec</c> has a <c>Path=</c> option.  A tempting shortcut is to just point to the <init>*.otf</init> file in your <c>texmf</c> tree.  But as a style writer, this is a really bad idea, since other authors who use your style may have their font files in a different location.  Better to employ the font <em>by name</em> and require authors to understand (or learn) their system software.</p>
            </paragraphs>

            <exercise>
                <p>Create a <latex/> file (from scratch) containing some Myanmar (Burmese) characters.  The <pubtitle>Kermit Project UTF-* Sampler</pubtitle><fn><url href="http://kermitproject.org/utf8.html"/></fn> is a great source for these sorts of experiments.  The Noto font is a project to make a huge collection of harmonious fonts for much of the world's languages.  Use what you have learned here to render your sample using a Noto font via both <c>pdflatex</c> and <c>xelatex</c>.  Extra credit if you can explain the name Noto.</p>
            </exercise>

            <paragraphs>
                <title>Plans, as of 2019-01-03</title>

                <p>We have recorded this information for style writers, but we have only begun to build procedures to make it easy to integrate new fonts.  We have long been using the <latex/> <c>polyglossia</c> package to manage multiple languages in one document, and will continue to do so.  This package relies heavily on <c>fontspec</c>, so learning <c>fontspec</c> will be necessary and valuable.  We intend to hide the details of <c>polyglossia</c> from authors and from style writers, relying on just the specification of <attr>xml:lang</attr> attributes to control font changes.</p>
            </paragraphs>
        </subsection>
    </section>

    <section xml:id="style-xsl-101">
        <title><init>XSL</init> 101</title>

        <p>If you have read this far, and read carefully, you have been exposed to several key principles of writing <c>XSL</c>.  Basically you are creating templates which the base <latex/> conversion will <q>call</q> in exactly the right place.  In a procedural language these might be called <term>hooks</term>.  Besides a smooth integration with the rest of <pretext/> there are several advantages:<ul>
            <li>A template using a <attr>match</attr> can apply narrowly or broadly.  Witness the example above for <tag>example</tag> versus <c>&amp;EXAMPLE-LIKE;</c>.  This attribute is similar to a <c>this</c> pointer in an object-oriented language and the modal template is not dissimilar to a method.</li>

            <li><pretext/> has a discovery phase when it constructs the <latex/> preamble.  If your <pretext/> source has no <tag>example</tag> in it, then there will be no associated <c>tcolorbox</c> style added to the preamble, and the <latex/> <c>example</c> environment will not be defined.  So the preamble is exactly what your document needs, and no more (mostly).  The <attr>match</attr> attribute makes this possible.</li>

            <li>You have seen named templates, which will feel familiar if you know procedural languages.  While perhaps comfortable, they are way less powerful, and we noted that we may get rid of them.</li>

            <li>The <tag>xsl:import</tag> mechanism allows us to keep base definitions and override others.  So as you develop your style, you do not need to start from scratch.</li>
        </ul></p>

        <p>Be aware that <em>every single character</em> that you put inside the <tag>xsl:text</tag> element will get copied literally into the preamble of your <latex/> output, including newlines and spaces you use to indent in your <init>XSL</init>.  Conversely, any <em>whitespace</em> inside your template, but <em>between</em> the <tag>xsl:text</tag> elements is ignored.  So we like to use multiple <tag>xsl:text</tag> elements (except we were a bit lazy getting this out the door initially<mdash/>do as we say, not as we do) and explicitly create newlines with the <c>&amp;#xa;</c> character.  Your goal is to have a <latex/> preamble with no blank lines and no unintended indentation.  We often create comment lines (with two leading <c>%</c> characters to aid with readability.</p>

        <p>See the <pretext/> website for recommendations for books on <init>XSL</init> if you are encouraged to learn more.</p>
    </section>

    <section>
        <title>Testing and Debugging</title>

        <p>The sample article tries to have one of everything, plus a few torture tests.  It is a good place to test initially, especially with the <c>tcb-style</c> templates.  The sample book is less haphazard, but does have most of the structure a typical book would have.  So if you are designing for a book it is a good place to test page styles, headers and footers, and division titles.  (2019-09-30: it is possible <tag>part</tag> has not been tested thorougly enough yet.)</p>

        <p>When things go bad, such as a non-obvious <latex/> compilation, it can help to stop working with <pretext/> source, and instead edit the generated <latex/> until the problem is understood.</p>

        <p>We do not expect to provide great support for this process.  First, because new code and basic support already keeps us busy, and second, because you have the freedom to really make a mess, and thus you should take responsibility for the problem.  When you are certain that <pretext/> has done something wrong or inadvisable, please, please do post in the development forum with a careful explanation and a (minimal) example.  It will happen.  Just don't use the forums as a replacement for this documentation or a bit of sleuthing through the <latex/> that <em>you</em> are now creating.  With freedom comes responsibilty.  Thanks.</p>
    </section>

    <section>
        <title>Planned Additions</title>

        <p>Some items to include, as of 2019-09-30:<ul>
            <li>Color schemes, so an author can use a style and just change the colors with a very simple stylesheet.</li>
            <li>Font control, so a style writer has simple instructions that navigate <latex/>'s procedures.</li>
            <li>Flexibility with the building blocks of a title page.</li>
            <li>Cover design and placement.</li>
        </ul></p>
    </section>
</chapter>