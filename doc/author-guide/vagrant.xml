<appendix xml:id="chapter-the-pretext-vagrant-box">
    <title>The <pretext /> Vagrant box</title>
    <p>In this appendix, we describe how to install and use the official
        <pretext/> <term>Vagrant box</term>. Vagrant is a tool that allows
        for the automatic provisioning and version control of <term>virtual
        machines</term>. What this means for the <pretext/> user is that
        there is a quick, simple installation process that is nearly guaranteed
        to result in a correctly functioning, up-to-date <pretext/> installation.
        Moreover, this installation simulates the behavior of a native Linux
        installation while providing access to important files directly to the
        host operating system.</p>
        <paragraphs><title>Installation</title>
        <p>You will need the following prerequisites before beginning the installation.
            <ul>
                <li>64-bit operating system (directions for determining this)</li>
                <li>VT-X enabled in your BIOS (Intel processors only)</li>
                <li>PuTTY or other SSH client (I recommend the portable install for PuTTY)</li>
            </ul>
        </p>
        <p>
            <list>
                <caption>Steps to install</caption>
                <ol>
                    <li><url href="https://www.virtualbox.org/wiki/Downloads">Download</url> and install Virtualbox</li>
                    <li><url href="https://www.vagrantup.com/downloads.html">Download</url> and install Vagrant</li>
                    <li>Open a console (Windows: press Windows key, type <c>cmd</c>)</li>
                    <li>
                        <p>Create a new directory <c>vagrant_quick_start</c> and change into it, using the command</p>
                        <sidebyside>
                            <console>
                                <prompt>$ </prompt>
                                <input>mkdir vagrant_quick_start</input>
                                <prompt>$ </prompt>
                                <input>cd vagrant_quick_start</input>
                            </console>
                        </sidebyside>
                    </li>
                    <li>
                        <p>Type the commands</p>
                        <sidebyside>
                            <console>
                                <prompt>$ </prompt>
                                <input>vagrant init daverosoff/pretext</input>
                                <prompt>$ </prompt>
                                <input>vagrant up</input>
                            </console>
                        </sidebyside>
                        <p>This step takes about half an hour to complete. There will be some interesting messages,
                            but once it gets going you don't have to watch.</p>
                        </li>
                        <li>Open PuTTY and connect to address 127.0.0.1, port 2200</li>
                        <li>Answer <q>Yes</q> to the authentication message</li>
                        <li>Login user/pass: <c>vagrant</c>/<c>vagrant</c></li>
                        <li>If you see the prompt <c>[vagrant@archlinux ~] $</c>, congratulations! You have successfully installed the <pretext/> Vagrant box.</li>
                        <li>Keep the PuTTY window open for use in the next section.</li>
                    </ol>
                </list>
            </p>
        </paragraphs>
        <paragraphs>
            <title>A first example</title>
            <p>Presumably, you already have a project underway. Use your usual
                file browser or command line to move or copy your project into the <c>vagrant_quick_start</c>
                directory you created earlier.</p>
                <p>In your PuTTY window, invoke the commands</p>
                <sidebyside>
                    <console>
                        <prompt>$ </prompt><input>cd /vagrant</input><output/>
                        <prompt>$ </prompt><input>ls</input><output/>
                    </console>
                </sidebyside>
                <p>and observe that your project is there, in your Vagrant box. The <c>/vagrant</c> directory in the
                Vagrant box is synced to the <c>vagrant_quick_start</c> directory you created earlier.</p>
                <p>Do your normal compilation dance, including steps to build images, HTML, and PDF output. For me it
                    might look like this:</p>
                    <sidebyside>
                        <console>
                            <prompt>$ </prompt><input>cd m101</input><output/>
                            <prompt>$ </prompt><input>mkdir -p output/images</input><output/>
                            <prompt>$ </prompt><input>~/mathbook/script/mbx -c latex-image -d output/images -f all src/index.mbx</input><output/>
                            <prompt>$ </prompt><input>xsltproc --xinclude --output output/ ~/mathbook/xsl/mathbook-html.xsl src/index.mbx</input><output/>
                            <prompt>$ </prompt><input>xsltproc --xinclude --output output/ ~/mathbook/xsl/mathbook-latex.xsl src/index.mbx</input><output/>
                            <prompt>$ </prompt><input>cd output</input><output/>
                            <prompt>$ </prompt><input>xelatex index.tex</input><output/>
                        </console>
                    </sidebyside>
                    <p>After compilation is done, use your normal file browser to locate the output tree you created. Find some output and preview it, marveling at the simplicity of what has befallen your project.</p>
                    <note>
                        <p>It is also possible to keep source in the <c>/home/vagrant</c> directory in the Vagrant box. Then the source will not be accessible from the Windows host. One possibility would be to use <c>git</c> to author in Windows and pull changes to the Vagrant box at compile time. I'm not sure why this would be better. Perhaps you don't want multiple copies of your source floating around your main disk drive.</p>
                    </note>
                </paragraphs>
                <paragraphs>
                    <title>Known issues</title>
                    <p>The current build of the Vagrant box includes Sage and Asymptote, but not <webwork/>. I have had some success installing <webwork/> via Docker as described <url href="https://github.com/openwebwork/webwork2/wiki/Docker-newbie-instructions">at the wiki</url>. Presumably, if your compilation dance requires a <webwork/> server, then you already have access to one and your normal compilation will still work.</p>
                    <p>It seems like many (most?) Intel-powered machines ship with VT-X disabled. You will need to go into the BIOS startup menu to enable it, and every menu is different. So there is no better help I can give here than <q>Go into the BIOS startup menu and look around for something that says <sq>Enable VT-X</sq>. Be very careful not to make any unwanted changes.</q></p>
                    <p>While I have tried to keep the virtual machine image as simple as possible, it is still fairly large, more than 5 GB, and
                        any virtualization will demand a substantial amount of machine memory. Vagrant will run best if you have at least 8 GB of ram. I am interested to hear how well it works on less high-powered systems.</p>
                        <p>The <c>jing-trang</c> validation suite is not included in the present version.</p>
                    </paragraphs>
                    <p>Thanks for your interest in the <pretext/> Vagrant box. If you encounter errors, or if you think something is missing, please <url href="https://github.com/daverosoff/pretext-vagrant/issues">open an issue on Github</url>.</p>
                </appendix>
