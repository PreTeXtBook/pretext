<?xml version="1.0" encoding="UTF-8" ?>

<!--********************************************************************
Copyright 2013 Robert A. Beezer

This file is part of MathBook XML.

MathBook XML is free software: you can redistribute it and/or modify
it under the terms of the GNU General Public License as published by
the Free Software Foundation, either version 2 or version 3 of the
License (at your option).

MathBook XML is distributed in the hope that it will be useful,
but WITHOUT ANY WARRANTY; without even the implied warranty of
MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
GNU General Public License for more details.

You should have received a copy of the GNU General Public License
along with MathBook XML.  If not, see <http://www.gnu.org/licenses/>.
*********************************************************************-->

<!--
To process this file, at the command-line issue:

xsltproc /path/to/mathbook/xsl/mathbook-html.xsl /path/to/mathbook/examples/sample-article.xml

then find  "derivatives.html"  in the current working directory
and use a web browser to view.  For PDF/print, issue:

xsltproc /path/to/mathbook/xsl/mathbook-latex.xsl /path/to/mathbook/examples/sample-article.xml

and apply  pdflatex  or  xelatex  to  "derivatives.tex"  in
the current working directory.

Ignore any warnings, they are part of testing the warning system.

To see images in your results, copy the examples/images directory
so that your working directory has the images subdirectory.  See
the  mathbook.pugetsound.edu  website for information on installing
the xsltproc executable.
-->

<!-- Overall element for a Mathbook XML document; mandatory, always  -->
<!-- Experiment with the "xml:lang" attribute to see localization    -->
<!-- changes, the  xsl/localizations  directory has more information -->
<mathbook>
<!-- <mathbook xml:lang="pt-BR"> -->
<!-- <mathbook xml:lang="fr-FR"> -->

    <!--
    "docinfo" is like metadata, it is necessary technical
    information which a reader mostly will never see.  LaTeX
    macros and Web analytics project numbers are good examples.
    If you are getting started, you do not need any of this initially.
    So on a first reading, skip ahead to the article tag.
    -->
    <docinfo>
        <!--
        In the HTML version there is room for a picture or logo
        in the upper left corner.  An image of a cover for a
        physical version is a good choice to go here.  We use
        16th Century Art Book Cover, 176x240 pixels, Public Domain, due to age
        http://commons.wikimedia.org/wiki/File:Book_Cover_-_Google_Art_Project.jpg
        -->
        <brandlogo url="http://mathbook.pugetsound.edu" source="images/book-cover-google-art-project.jpg" />
        <!--
        TeX/LaTeX macros can be written in the usual way.
        Whitespace and line breaks are irrelevant here.
        These are "write once, use everywhere".
        -->
        <macros>
        \newcommand{\definiteintegral}[4]{\int_{#1}^{#2}\,#3\,d#4} % this comment will be stripped
        % comments anywhere get stripped, with or without faux % comment \% characters
        \newcommand{\indefiniteintegral}[2]{\int#1\,d#2}
        \newcommand{\testingescapedpercent}{ \% } % just testing
        </macros>
        <!--
        Extra packages, package options, and package settings for latex-based images.
        Inserted in the preamble for LaTeX output.
        Inserted in the preamble to each standalone latex-based image for HMTL SVG output.
        -->
        <latex-image-preamble>
        \usepackage{pgfplots}               % loads tikz package
        \pgfplotsset{axis x line = middle,
                     axis y line = middle}
        \usetikzlibrary{backgrounds}
        \usetikzlibrary{arrows,matrix}
        </latex-image-preamble>
        <!--
        The Sage Notebook has its own interface and worksheet list.
        To use the sorting features optimally, it helps to have subdivisions
        begin with the same short prefix.  An "initialism" (nee acronym)
        here will be used for that purpose if present.  This is only employed
        for producing Sage notebook versions and in the title shown in the
        browser. (If not present, you will get a harmless warning just for
        Sage worksheet production.)
        -->
        <initialism>SA</initialism>
        <!--
        With a <feedback> element, in the HTML version, you get a button
        for reporting typos and errors.  You might link to a Google Docs
        spreadsheet or something similar.  Default is to get a button
        labeled "Feedback", which will be localized to your target language.
        You can override this with some text of your choosing, but then you
        lose the localization feature.
        -->
        <feedback>
            <url>not-implemented.html</url>
             <!-- <text>My Button Text</text>  -->
        </feedback>

        <!--
        "Names" for various parts of a document are determined exactly
        once for each language, ensuring consistency and saving you the
        bother of always typing them in.  These can be found in the
        files in the  xsl/localizations  directory.

        You can make a document-specific, global override.  Here we
        decide we have no need for any "proposition"s and repurpose
        that environment in US English as a "Conundrum."

        See the localization file for more on language codes, and realize
        that US English is the default if there is no "lang" attribute
        given on the document.
        -->
        <rename element="proposition" lang="en-US">Conundrum</rename>


    </docinfo>

    <!--
    The article element is top-level for anything short of a book.
    There is a book element, which is not demonstrated here.
    The "xml:id" attribute will be used for the filename of the
    HTML output.
    -->
    <article xml:id="derivatives">
        <title>Derivatives and Integrals</title>
        <subtitle>An Annotated Discourse</subtitle>

        <!--
        The frontmatter contains a variety of items that precede
        the actual content.  They should be placed in the proper order,
        here the title material should precede a table of contents.
        They differ from "docinfo" items in that they will be *content*
        that a reader will actually see.

        The xml:id string is used to form a filename for a webpage.
        Setting this one to "index" makes for a good default page
        when you host your project on a server.
        -->

        <frontmatter xml:id="index">
            <!--
            Items typically on the main title page of a book,
            but here as an article they are handled more compactly
             -->

            <titlepage>

               <!-- There can be several authors here -->
                <author>
                    <personname>Robert Beezer</personname>
                    <!-- department here is one line, so unstructured -->
                    <department>Department of Mathematics and Computer Science</department>
                    <!-- institution uses two lines, so structured as such -->
                    <institution>
                        <line>University of Puget Sound</line>
                        <line>Tacoma, Washington, USA</line>
                    </institution>
                    <email>beezer@pugetsound.edu</email>
                </author>

                <!-- Can set date manually or use the "today" element -->
                <date><today /></date>

            </titlepage>

            <abstract>
                <p>This is a sample of many of the things you can do with MathBook XML.  Sometimes the math makes sense, sometimes it seems to be written in the first person, sort of like this Abstract.</p>
            </abstract>
            <!--
            Acknowledgements, dedications, colophon (ISBN, copyright, etc)
            are supported in the book document type.  Such a diverse range
            is not yet available for articles.  Send requests.
             -->
        </frontmatter>

        <!--
        Articles have sections, which have subsections,
        which have subsubsections.These are all "containers"
        and so line breaks and extraneous whitespace gets
        scrubbed.  Use indentation and line breaks liberally
        within containers to make the structure of your
        source readable.
        -->

        <section>
            <title>Introduction</title>

            <!--
            URLs can be done in a traditional fashion, as in the
            abstract below. Or you can make an empty element and the URL in
            the href attribute will be the content you click on.  See the
            example near the discussion of Asymptote.
            -->

            <p>We consider definite integrals of functions <m>f(x)</m>.  For example, <me>\definiteintegral{0}{2}{\sin^2(x)}{x}</me> This is also a demonstration of the capabilities of <url href="http://mathbook.pugetsound.edu">MathBook XML</url>.<notation>
                <usage>\int_a^b\,f(x)\,dx</usage>
                <description>definite integral of <m>f(x)</m></description>
            </notation></p>

            <p>Generated: <today />, <timeofday /></p>

        </section>

        <!--
        Note above: Subdivisions always have titles, and these
        are not containers.  Line breaks and whitespace will
        bleed into output, which is especially a problem for TeX,
        since it may render as a blank line.  So keep the title
        element "tight" around the content.

        The "p" element is a paragraph, and also not a container,
        so keep it wrapped tight.  Lots can go on in a paragraph.
        -->

        <section xml:id="section-fundamental-theorem">
            <title>The Fundamental Theorem</title>

            <p>There is a remarkable theorem:<fn xml:id="footnote-fermat">And fortunately we do not need to try to write it in the margin!</fn></p>
            <!--
            Mathematics:  Wrap inline mathematics in the "m"
            element (short for "math").  You may use TeX, LaTeX,
            and/or AMSmath here.  You may also use any macro
            defined in docinfo/macros.
            If the "m" tag bothers you, you may use \(...\).
            Purposely, dollar signs will not function properly.
            The "me" element will create a displayed "math
            equation", which is unnumbered.
            -->
            <theorem xml:id="theorem-FTC">
                <title>The Fundamental Theorem of Calculus</title>
                <index>Fundamental Theorem of Calculus</index>
                <statement>
                    <p>If <m>f(x)</m> is continuous, and the derivative of <m>F(x)</m> is <m>f(x)</m>, then <me>\definiteintegral{a}{b}{f(x)}{x}=F(b)-F(a)</me><index>Buried in p/statement/theorem</index></p>
                </statement>
                <proof>
                    <p>Left to the reader.</p>
                </proof>
            </theorem>
            <!--
            Note above:  The "xml:id" attribute is like a LaTeX label.
            It is a target for cross-reference, an alias for the theorem
            so we can reference it later.  The "theorem" part of the alias
            is not necessary, but is a good habit.
            -->

            <!--
            Next paragraph has two citations.  These reference
            aliases given by "xml:id"'s in the bibliography.
            Citations render as knowls on web pages.
            -->
            <p>You will find almost nothing about all this in the article <xref ref="biblio-lay-article" />, nor in the book <xref ref="biblio-judson-AATA" />, since they belong in some other article, but we can cite them out-of-order for practice anyway.</p>

            <!--
            There are various tools for authors
            and we can process the source in order to
            make these visible, or not
            -->

            <p>When we are writing we do not always know what we want to cite, or just where subsequent material will end up.  For example, we might want a citation to <xref provisional="some textbook about the FTC" /> or we might want to reference a later<nbsp /><xref provisional="chapter about DiffEq's" />.</p>

            <p>We can also embed <q>todo</q>s in the source, and selectively display them, so you may not see the one here in the output you are looking at now.  Or maybe you do see it?</p>

<todo>Talk more about author's tools, such as todo's</todo>

            <p>Because a definite integral can be computed using an antiderivative, we have the following definition.</p>

            <!--
            Notation may be associated with a definition,
            or it can be placed standalone.  If associated
            with a definition, future work will reflect that
            association in the list of notation.
            -->

            <definition xml:id="definition-indefinite-integral">
                <statement>
                    <p>Suppose that <m>\frac{d}{dx}F(x)=f(x)</m>.  Then the <term>indefinite integral</term> of <m>f(x)</m> is <m>F(x)</m> and is written as <me>\int\,f(x)\,dx=F(x)</me></p>
                </statement>
                <notation>
                    <usage>\int\,f(x)\,dx</usage>
                    <description>indefinite integral of <m>f(x)</m></description>
                </notation>
            </definition>

        </section>

        <!--
        Sage Code: Next section has Sage code examples.
        For HTML it renders as Sage Cells, with no sample output.
        For LaTeX it renders as input/output, suggestively typeset.
        A separate XSL transform isolates code and produces a file
        for doctesting.

        Note: These small examples are wrapped "tight" in the
        input and output elements.  For multiline code snippets,
        the left margin is determined by the whitespace preceding
        the first non-trivial character.
        -->

        <section xml:id="section-sage-cells">
            <title>Computing Integrals with Sage (<m>\int</m>)</title>

            <index><main>Sage</main><sub>integration</sub></index>
            <index><main>Sage</main><sub>integration</sub><sub>cell</sub></index>
            <index><main>Sage</main><sub>integration</sub><sub>numerical</sub></index>
            <index><main>Numerical integration</main></index>
            <index><main>Numerical integration</main><sub>Sage</sub><sub>cell</sub></index>
            <index><main>Numerical integration</main><see>Sage integration</see></index>

            <p>Sage can compute definite integrals.  The output contains the approximate numerical value of the definite integral, followed by an upper bound  of the error in the approximation.</p>

            <sage xml:id="sage-numerical-integral">
                <input>numerical_integral(sin(x)^2, (0, 2))</input>
                <!-- need to use wildcard matching to make this doctestable -->
                <output>(1.189200623826982, 1.320277913471315e-14)</output>
            </sage>

            <p>Given the Fundamental Theorem, we would find the antiderivative useful.</p>

            <sage>
                <input>integral(sin(x)^2, x)</input>
                <output>1/2*x - 1/4*sin(2*x)</output>
            </sage>

            <p>The same command can be used to employ the antiderivative in the application of the Fundamental Theorem.  Notice that the answer is <em>exact</em> and any further manipulation is likely to be simply producing a numerical approximation.</p>

            <!-- The "full" type is the default, it is used here only for testing purposes -->
            <sage type="full">
                <input>integral(sin(x)^2, (x, 0, 2))</input>
                <output>-1/4*sin(4) + 1</output>
            </sage>

            <p>There are integrals you really do not want to evaluate, or you do not want your reader to evaluate.  A Sage cell can be configured for display purposes only <mdash /> you can look but you cannot touch.</p>

            <sage type="display">
                <input>integral(e^(x^2), x)</input>
                <output>-1/2*I*sqrt(pi)*erf(I*x)</output>
            </sage>

            <p>You can give a Sage element a <c>doctest</c> attribute, whose value mirrors the optional hash tags used in Sage doctests.  Possible values are <c>random</c>, <c>long time</c>, <c>not implemented</c>, <c>not tested</c>, <c>known bug</c>, <c>absolute</c>, <c>relative</c>, and <c>optional</c>.  The values <c>absolute</c> and <c>relative</c> refer to floating-point tolerances for equality and require a second attribute <c>tolerance</c> to specify a floating point value.  The value <c>optional</c> refers to the test requiring that an optional Sage package be present.  The name of that package should be provided in the <c>package</c> attribute.</p>

            <p>The next cell is marked in the source as <c>doctest="random"</c>, and so is specified as unpredictable and not tested.  But there is some <q>sample</q> output which will appear in the <latex /> version (and always be the same).</p>

            <sage doctest="random">
                <input>random()</input>
                <output>0.11736021338650582</output>
            </sage>

            <p>While the next cell is random, the returned value will never be more than <m>0.01</m> away from <m>12</m>, since the <c>random()</c> function stays between <m>0</m> and <m>1</m>.  So we provide <m>12.005</m> as the expected answer, but test with an absolute tolerance of <m>\epsilon=0.006</m>.</p>

            <sage doctest="absolute" tolerance="0.006">
                <input>12 + 0.01*random()</input>
                <output>12.005</output>
            </sage>

            <p>Sage, and by extension, the Sage Cell Server, can interpret several languages.  The next example has code in the <c>R</c> language, a popular open source language for statistics.  As an author, you add the attribute <c>language="r"</c> to your <c>sage</c> element.  (The default language is Sage, so you do not need to indicate that repeatedly.)  Note that a language like <c>R</c> likes to use a <q>less than</q> character, the second most-dangerous special character in XML.  You need to escape it by writing <c>&amp;lt;</c> as we have done in the source for this example.  (See the discussion and summary in <xref ref="subsection-reserved-characters" autoname="yes" />.)</p>

            <p>As a reader you learn that the <q>Evaluate</q> button for a pre-loaded Sage cell will indicate the language in use.</p>

            <sage doctest="not tested" language="r">
                <input>
                ruth &lt;- c(22, 25, 34, 35, 41, 41, 46, 46, 46, 47, 49, 54, 54, 59, 60)
                bonds &lt;- c(16, 25, 24, 19, 33, 25, 34, 46, 37, 33, 42, 40, 37, 34, 49, 73, 46, 45, 45, 5, 26, 28)
                dimaggio &lt;- c(12, 14, 20, 21, 25, 29, 30, 30, 31, 32, 32, 39, 46)
                summary(ruth)
                summary(bonds)
                summary(dimaggio)
                boxplot(ruth, bonds, dimaggio)
                </input>
            </sage>

            <p>The Sage Cell Server supports the following languages:  <c>sage</c>, <c>gap</c>, <c>gp</c>, <c>html</c>, <c>maxima</c>, <c>octave</c>, <c>python</c>, <c>r</c>, and <c>singular</c>.</p>

            <p>Here is another <c>R</c> cell.  Unfortunately, it seems Sage's <c>doctest</c> facility cannot be used easily with code from other languages.  In the source for this example, we have employed a <c>CDATA</c> element to protect all the characters from the XML processor.</p>

            <sage language="r">
                <input>
                <![CDATA[
                age <- c(25, 30, 56)
                gender <- c("male", "female", "male")
                weight <- c(160, 110, 220)
                mydata <- data.frame(age,gender,weight)
                summary(mydata)
                cor(mydata$age,mydata$weight)
                mean(mydata$age)
                sd(mydata$age)
                plot(mydata$age,mydata$weight)
                ]]>
                </input>
            </sage>

            <p>Here is a blank Sage cell that you may use for practice and experimentation with the commands above.  Note that this cell allows a choice of languages, and is not linked with any of the previous cells, so a reader would need to start fresh, or cut/paste definitioons from other cells.</p>

            <sage type="practice" />

            <p>On the other hand a <c>&lt;sage&gt;</c> element with no content will also create an empty Sage cell for the reader's use, but now it will be specific to a particular language and linked to others of the same language.  Run the <c>R</c> cell above that defines the variable <c>ruth</c> and then try typing <c>summary(ruth)</c> in the cell below.  (The linking seems a bit buggy, as it repeats the boxplot in the output, as of 2016-06-13).</p>

            <sage language="r" />

            <p>You can make Sage blocks which are of <c>type="invisible"</c>, which will never be shown to a reader, but which get doctested.  Why do this?  If some code produces an error, and you hope it is fixed someday, use an invisible block to raise the error.  Once fixed, the doctest will fail, and you can adjust your commentary to suit.  There is such a block right now, <em>but</em> you will need to go to the source to see it.</p>

            <!--
            This code raises a "not implemented" error.
            Maybe it'll never change? It is not important -
            but let me know if it changes.
            -->
            <sage type="invisible">
                <input>graphs(augment='vertices').next()</input>
                <output>
                Traceback (most recent call last):
                ...
                NotImplementedError
                </output>
            </sage>

            <p>Our maximum width for text, designed for readability, suggests you should format your Sage code with a maximum of about 54 characters. On a mobile device, the number of displayed characters might be as low as 28 in portrait orintation, and again around 50 in landscape.  You can use a variety of techniques to shorten long lines, such as using intermediate variables.  Since Sage is just a huge Python library, you can use any of Python's facilities for handling long lines.  These include a continuation character (which I try to avoid using) or natural places where you can break long lines, such as between entries of a list.  Also, if writing loops or functions, you may wish to have your indentation be only two characters wide (rather than, say, four).</p>

            <p>Sage output can sometimes be quite long, though this has improved with some changes in Sage's output routines.  Output code should be included primarily for doctesting purposes, and in this use, you may break at almost whitespace character and the doctesting framework will adjust accordingly.  You may wish to show sample output in a static format, like a PDF, so you can consider formatting your output to fit the width constraints of that medium.  Or you may even adjust exactly what is output, to keep it from being too verbose.  Sage doctesting also allows for a wild-card style syntax which allows you to skip over huge chunks of meaningless or unpredictable output, such as tracebacks on error messages.</p>

        </section>

        <!--
        Next section illustrates more involved presentation of
        mathematics.  The "mdn" element is shorthand for
        "mathematics display, numbered".  There is a "men"
        element for "math equation, numbered" and a "md" for
        "math display" (with no numbers).  Numbering may be
        selectively suppressed or enabled, per line (shown
        here once).  An "xml:id" alias may be used on any
        numbered line.

        Multi-line displays ("md", "mdn") require that lines
        be delimited as "math rows" with the "mrow" element.
        These displays are implemented with the AMSMath align
        environment, which uses ampersands (&) for formatting
        control.  This is an evil situation, but the (easy) way
        around it is to use "&amp;" in this situation.

        The previous sections were sequences of paragraphs, along with
        theorems, Sage code, etc.  The next section has subsections, so
        the structure must look like *only* subsections, excepting a
        brief introduction and conclusion (that are sequences of
        paragraphs and other blocks.)
        -->

        <section xml:id="interesting-corollary">
            <title>An Interesting Corollary</title>

            <introduction>
                <p>The Fundamental Theorem comes in two flavors, where usually one is a corollary of the other.</p>
            </introduction>

            <subsection>
                <title>Second Version of <acro>FTC</acro></title>

                <todo>Should equation references come with parentheses?</todo>

                <corollary xml:id="corollary-FTC-derivative">
                    <statement>
                        <p>Suppose <m>f(x)</m> is a continuous function.  Then <men xml:id="equation-alternate-FTC">\frac{d}{dx}\definiteintegral{a}{x}{f(t)}{t}=f(x)</men></p>
                    </statement>
                    <proof xml:id="proof-FTC-corollary">
                        <p>We simply take the indicated derivative, applying Theorem<nbsp /><xref ref="theorem-FTC" /> at <xref ref="equation-use-FTC" />.<mdn>
                            <mrow xml:id="equation-use-FTC">\frac{d}{dx}\definiteintegral{a}{x}{f(t)}{t}&amp;=\frac{d}{dx}\left(F(x)-F(a)\right)</mrow>
                            <mrow number="no">&amp;=\frac{d}{dx}F(x)-\frac{d}{dx}F(a)</mrow>
                            <mrow>&amp;=f(x)-0 = f(x)</mrow>
                        </mdn></p>
                    </proof>
                </corollary>

                <p>The alternative version of the Fundamental Theorem (<acro>FTC</acro>) in <xref ref="equation-alternate-FTC" /> is a compact way to express the result.</p>

                <p>For testing purposes, there is a temporary simple Sage Cell here.</p>
                <sage>
                    <input>2+2</input>
                </sage>

                <example xml:id="example-mysterious">
                    <title>A Mysterious Derivative</title>
                    <p>So if we define a function with its variable employed as a limit of integration, like so <me>K(z)=\definiteintegral{345}{z}{x^4\sin(x^2)}{x}</me> then we get the derivative of that function so easily it seems like a mystery, <me>\frac{d}{dz}K(z)=z^4\sin(z^2)</me>  That's it.</p>

                    <p>For testing purposes, there is a temporary simple Sage Cell here.</p>

                    <sage>
                        <input>2+2</input>
                    </sage>
                </example>

                <claim>
                    <title>An Equivalent Claim</title>
                    <statement>
                        <p>This claim is an equivalence: it is true if and only if it is correct.</p>
                    </statement>
                    <proof>
                        <p>Our only purpose here is to show a proof of an equivalence structured with the arrows typically used to demonstrate the two <q>directions</q> involved in the proof.</p>

                        <case direction="forward">
                            <p> Nulla non lectus suscipit, bibendum leo quis, dignissim justo. In urna turpis, tincidunt id elementum id, faucibus ac tellus. Donec eget nulla id urna auctor sollicitudin. Suspendisse ut odio suscipit, aliquet tortor ut, consectetur risus. Curabitur at congue felis. Nunc condimentum enim sit amet libero mollis egestas. In tortor ex, interdum a nibh quis, bibendum accumsan orci. Ut convallis lacus a maximus pulvinar.</p>
                        </case>

                        <case direction="backward">
                            <p>Quisque auctor ligula turpis, ut aliquam urna consectetur hendrerit. Aenean porta dolor et justo facilisis feugiat in sed sapien. Nullam porta ex et commodo semper. Nulla a arcu hendrerit, sodales massa id, sagittis ex. Aliquam dapibus magna eget luctus ullamcorper. Curabitur nec lorem in elit laoreet volutpat ac ut eros. Aenean iaculis fermentum nisl, non pharetra libero scelerisque a. Vivamus viverra nulla in felis aliquet malesuada. Nullam dapibus lacus eget diam sodales bibendum.</p>
                        </case>
                    </proof>
                </claim>
            </subsection>

            <!--
            Articles can be sectioned further, into subsections
            and subsubsections.  Books have a large subdivision,
            chapters, which can be collections of sections.  A
            further subdivision is a "paragraph," which mimics
            the structure of the same name in LaTeX.
            -->

            <subsection>
                <title>A Pedagogical Note</title>

                <subsubsection xml:id="subsubsection-different-integrals">
                    <title>Symbolic and Numerical Integrals</title>

                    <p>The Fundamental Theorem explains why we use the same notation for a definite integral, which is a numerical calculation,<fn>Which I think sometimes students lose sight of.</fn> and an antiderivative, which is a symbolic expression.</p>

                    <exercise xml:id="exercise-essay">
                        <title>Essay Question: Compare and Contrast</title>
                        <statement>
                            <p>Write a short paragraph which compares, and contrasts, the definite and indefinite integral. This is an exercise which sits in the midst of the narrative, so is formatted more like an example or a remark.  It can have a hint and a solution, but this one does not.  It can have a title, which this one does.</p>
                        </statement>
                        <hint>
                            <p>Start writing!</p>
                        </hint>
                    </exercise>
                </subsubsection>

                <subsubsection>
                    <title></title>

                    <p>This subsubsection has a title in the source, but it is empty.  That's OK, but not advisable since titles get used lots of places (such as page headers and the table of contents).</p>
                </subsubsection>

                <subsubsection>
                    <title>Advice</title>

                    <p>Using an <q>integral sign</q> for an antiderivative (aka indefinite integral) would seem to make the Fundamental Theorem a <foreign>fait accompli</foreign>.  So I would suggest not conflating the notation for two very different things until the Fundamental Theorem exposes them as being highly related.</p>

                    <example xml:id="example-structured">
                        <title>An Example of Structure</title>
                        <statement>
                            <p>This is an example of an example with a bit more structure.  Specifically, the example has a <c>title</c>, as usual, but then has a <c>statement</c>, which is separate from the <c>solution</c>.  Why did we implement an example in two ways?</p>
                        </statement>
                        <solution>
                            <p>Authors asked for it and it seemed a very natural thing to do, even if we only had an unstructured version for a long time.</p>
                        </solution>
                    </example>

                    <question xml:id="sample-question">
                        <title>An Example of a Question</title>
                        <statement>
                            <p>Any kind of question can be marked as such with <c>&lt;question&gt;</c>.  Or similarly, as a <c>&lt;problem&gt;</c>.  They behave identically to <c>example</c>s, such as the one preceding and are numbered along with theorems, examples. etc.</p>
                        </statement>
                        <solution>
                            <p>You can have a solution. Or several, even if you don't ask a question.</p>
                        </solution>
                        <solution>
                            <p>See?</p>
                        </solution>
                    </question>

                    <p>There are many different blocks you can employ, and they mostly behave the same way.  A <c>&lt;project&gt;</c> is very similar to a <c>&lt;question&gt;</c> or <c>&lt;problem&gt;</c></p>

                    <project>
                        <title>Start Exploring MathBook XML</title>

                        <p>You could grab the <c>minimal.xml</c> file from the <c>examples/minimal</c> directory and experiment with that.</p>

                        <p>Projects get their own independent numbering scheme, since they may be central to your textbook, workbook, or lab manual.  If you process this sample article with <c>--stringparam numbering.projects.level 0</c> then you will get consecutive numbers from the beginning of your book, starting with 1.</p>
                    </project>


                    <exploration>
                        <title>Exploring Explorations</title>

                        <statement>
                            <p>This is an <c>&lt;exploration&gt;</c>.  Two similar possibilities are <c>&lt;activity&gt;</c> and <c>&lt;task&gt;</c>.</p>

                            <p>Note that projects, activities, explorations, and tasks <em>share</em> the independent numbering scheme, so it is really only intended you use one of these.  If you want a variant of the name (<eg /> <q>Directed Activity</q>) you can use the <c>&lt;rename&gt;</c> facility (<xref ref="rename-facility" autoname="yes" />).</p>
                        </statement>

                        <solution>
                            <p>This is a <q>solution</q> to the exploration.  In practice, you might choose to not make this visible for students, but instead include it as part of some guidance you might provide to instructors (<eg /> an <booktitle>Instructor's Manual</booktitle>).</p>
                        </solution>
                    </exploration>

                    <note xml:id="note-remark">
                        <title>A Note on Remarks</title>

                        <p><c>&lt;remark&gt;</c>, <c>&lt;convention&gt;</c>, <c>&lt;note&gt;</c>, <c>&lt;observation&gt;</c> and <c>&lt;warning&gt;</c> are designed to hold very simple contents, with no additional structure (no proofs, no solutions, <etc />).</p>

                        <p>But they do carry a title and a number, can be the target of a cross-reference, and may be optionally knowlized in HTML with the <c>html.knowl.remark</c> processing switch.</p>
                    </note>

                </subsubsection>

                <exercises>

                    <exercise xml:id="exercise-test-number">
                        <statement>
                            <p>This is an exercise in an <q>Exercises</q> subdivision at the level of a subsubsection.  There is no question other than if the numbering is appropriate.  Here is a self-referential link: Exercise<nbsp /><xref ref="exercise-test-number" />.</p>

                            <p>The subsubsection has no title in the source, so one is provided automatically, and will adjust according to the language of the document.</p>
                        </statement>
                    </exercise>
                </exercises>

            </subsection>

            <subsection>
                <title>Theorem-Like Environments</title>

                <p>There are a variety of pre-defined environments in MathBook XML.  All take a title, and must have a statement.  Some have proofs (theorems, corollaries, <etc />), while some do not have proofs (conjectures, axioms, principles).</p>

                <principle xml:id="principle-principle">
                    <title>The Title Principle</title>

                    <statement>
                        <p>It is a fundamental principle that many elements can have a title.  Try it and see. If you get better formatting, then it is being recognized.  If it looks very plain, check the documentation and perhaps make a feature request.</p>
                    </statement>
                </principle>

                <p>More precisely, <c>&lt;theorem&gt;</c>, <c>&lt;corollary&gt;</c>, <c>&lt;lemma&gt;</c>, <c>&lt;algorithm&gt;</c>, <c>&lt;proposition&gt;</c>, <c>&lt;claim&gt;</c>, <c>&lt;fact&gt;</c>, and <c>&lt;identity&gt;</c>, all behave exactly the same, requiring a statement (as a sequence of paragraphs) followed by an optional proof, and may have an optional title.  The elements <c>&lt;axiom&gt;</c>, <c>&lt;conjecture&gt;</c>, <c>&lt;principle&gt;</c>, <c>&lt;heuristic&gt;</c>, <c>&lt;hypothesis&gt;</c>, and <c>&lt;assumption&gt;</c> are functionally the same, barring a proof (since they would never have one!).  Definitions are an exception, as it is natural to place <c>&lt;notation&gt;</c> within<mdash />see the source for Definition<nbsp /><xref ref="definition-indefinite-integral" /> for an example.</p>
            </subsection>

            <subsection>
                <title>Linking Sage Cells</title>

                <p>Sage cells share their results on a per-webpage basis, so if you move to a new chapter, section, or subsection that happens to be on another webpage, your Sage computations are gone and you start fresh.  But maybe you need some results from elsewhere.  As an author, you can make an exact copy of a cell in another location.  As a reader you are suggested to <q>replay</q> the cell.  You have seen the next cell before.  More typically such a cell might define a function or set some values of a variable.</p>

                <sage copy="sage-numerical-integral" />
            </subsection>

            <subsection>
                <title>Hierarchy</title>

                <paragraphs>
                    <title>Structure</title>

                    <p>This section of this article has subsections and subsubsections.  In a book you can have chapters enclosing multiple sections.  There is one finer subdivision, it is achieved with the <c>paragraphs</c> element.</p>

                    <p>It is basically a sequence of paragraphs, where the first one gets an inline title.  You are reading the second, and final, paragraph of one right now. It is useful for organizing very short documents, where numbered subdivisions might be overkill.</p>
                </paragraphs>

                <assemblage xml:id="assemblage-basics">
                    <title>Assemblages: Collections and Summaries</title>

                    <p>An <c>&lt;assemblage&gt;</c> is a collection, or summary, that does not have much structure to it.  So you are limited to paragraphs (<c>p</c>), which by extension can contain lists (<c>ol</c>, <c>ul</c>, <c>dl</c>).  But its presentation should draw attention to it, because the contents should be seen as more important in some way.  It should be <q>highlighted</q> in some manner.  If you need to connect with material elsewhere, you can do that with the usual <c>xref/xml:id</c> mechanism.</p>

                    <p>What have we seen so far in this (disorganized) sample?<ul>
                        <li><p>Theorems, definitions and corollaries. (<xref ref="section-fundamental-theorem" autoname="yes" />)</p></li>
                        <li><p>Sage cells, including with R. (<xref ref="section-sage-cells" autoname="yes" />)</p></li>
                        <li><p>Lots of document structure, like introductions and conclusions (next). (<xref ref="interesting-corollary" autoname="yes" />)</p></li>
                    </ul></p>
                </assemblage>
            </subsection>

            <subsection xml:id="subsection-intro-conclude">
                <title>Introductions and Conclusions</title>

                <introduction>
                    <title>An Introductory Introduction</title>

                    <p>Any subdivision may have a sequence of paragraphs within an <c>&lt;introduction&gt;</c> that precedes subsequent further subdivisions.  You are reading one now.  They are always leaves of the document structure, so are rendered on some pages that reference the following subdivisions.</p>

                    <p>An introduction or conclusion is an extremely restrictive container with simple presentation.  A title is optional (and probably not advisable).  Content is meant to be short and unstructured, in particular, nothing that can be numbered is allowed.  If this feels <em>too</em> restrictive, then place your content in an initial numbered subdivision and perhaps title it <q>Introduction</q>.  Or make your entire subdivion unstructured and place whatever you want into it.</p>

                    <p>This ends this introduction to introductions.</p>
                </introduction>

                <subsubsection>
                    <title>Test One</title>

                    <p>An intervening subsubsection just after an introduction.</p>
                </subsubsection> 

                <subsubsection>
                    <title>Test Two</title>

                    <p>An intervening subsubsection just before a conclusion.</p>
                </subsubsection> 

                <conclusion>
                    <p>Entirely analogous to introductions are conclusions.  Any subdivision may have a sequence of paragraphs within a <c>&lt;conclusion&gt;</c> that follows previous further subdivisions.  You are reading one now.  They are always leaves of the document structure, so are rendered on some pages that reference the preceding subdivisions.</p>

                   <p>This concludes this conclusion (and this subsection and this section).</p>
                </conclusion>
            </subsection>

            <subsection xml:id="subsection-paragraph-markup">
                <title>Some Paragraph-Level Markup</title>

                <p>Text within a paragraph may be <em>emphasized</em> with <c>&lt;em&gt;</c> or if you want to take it to the next level you can identify the text as an <alert>alert</alert> with <c>&lt;alert&gt;</c>.</p>

                <p>Similarly, within a paragraph, you can identify edits between versions as <insert>inserted text that has been added</insert> with <c>&lt;insert&gt;</c> or as <delete>deleted text that has been removed</delete> with <c>&lt;delete&gt;</c>.  Note that these identified edits are slightly different than <stale>stale text that you want to retain, but which is no longer relevant</stale>, which is accomplished with <c>&lt;stale&gt;</c>.  The original request for stale text came from an instructor with an online list of student topics for presentations, and as students claimed topics they were marked as no longer available for other students.</p>

                <p>If you need a <q>fill-in blank</q>, like this<fillin />, it can be obtained with an empty <c>&lt;fillin&gt;</c> element that defaults to roughly a 10-character width.  You can use the <c>&lt;characters&gt;</c> attribute to make the rule longer or shorter, such as a 40-character blank: <fillin characters="40" />.  The character count is approximate, based on typical character widths within a proportional font carrying English language text.  Adjust to suit, or request a language-specific adjustment if it is critical.</p>
            </subsection>
        </section>

        <!--
        The section below illustrates ordered and unordered lists,
        with the same syntax as HTML.  They can be nested.
        Basic raster images are supported, inside of figures.
        Note that the caption is rendered below the graphic,
        even though it is given first in the source.
        Support for TikZ graphics is available for LaTeX output,
        and perhaps figures will be automatically generated from Sage code.
        The scale for graphics is points in LaTeX, pixels
        in HTML, which are similar, but not identical.
        -->

        <section>
            <title>Some Facts and Figures</title>

            <!-- This is not implemented
            This Sage code will be (a) hidden and (b) automatically executed
            <sage type="init">
                <input>
                def square(m):
                    return m*m

                aaa= 78
                print aaa
                </input>
            </sage>
            -->

            <p>Because of the Fundamental Theorem, for every derivative we know, there is an antiderivative we might find useful.  Because of the Fundamental Theorem of Calculus, we recycle the <q><m>\int</m></q> symbol as notation for an antiderivative.</p>

            <ul cols="2">
                <li>
                    <p>Derivatives</p>
                    <ol label="(a)">
                        <li><p><m>\frac{d}{dx}x^n = nx^{n-1}</m></p></li>
                        <li><p><m>\frac{d}{dx}e^x = e^x</m></p></li>
                        <li><p><m>\frac{d}{dx}\cos(x) = -\sin(x)</m></p></li>
                    </ol>
                </li>
                <li><p>Antiderivatives</p>
                    <ol label="i)">
                        <li><p><m>\indefiniteintegral{x^n}{x} = \displaystyle\frac{x^{n-1}}{n+1}\text{ if }n\neq -1</m></p></li>
                        <li><p><m>\indefiniteintegral{e^x}{x} = e^x</m></p></li>
                        <li><p><m>\indefiniteintegral{\sin(x)}{x} = -\cos(x)</m></p></li>
                    </ol>
                </li>
            </ul>

            <remark>
                <p>You can gain a greater understanding of derivatives by studying the graphs of functions with their derivatives.  Can you discern the derivative<ndash />antiderivative relationship in Figure<nbsp /><xref ref="figure-function-derivative" />?</p>
            </remark>

            <!--
            Sage Source;
            f(x)=(x-3)*(x-1)*(x+2)
            orig = plot( f(x), (x,-3,4), color='blue', thickness=3)
            diff = f.derivative()
            slope = plot(diff, (x,-3,4), color='red', thickness=3)
            orig+slope
            -->

            <figure xml:id="figure-function-derivative">
                <caption>A function and its derivative</caption>
                <image width="50%" source="images/cubic-function.png">
                    <description>A third degree polynomial with a local max and a local min, along with its second degree derivative plotted on the same axes</description>
                </image>
            </figure>

            <p>Lists can have multiple columns.  With <init>HTML</init> items displayed in row-major order (horizontally first) and with <latex /> items are displayed in column-major order (vertically first).  When one order, or the other, becomes workable in both variants, maybe we will be consistent in presentation.  (Note that with just one row, it makes no difference.)  We used it above for the two items <mdash /> derivatives and integrals <mdash /> where each item was a list of its own.  Here are two more examples, one with short snippets and lots of columns, the other with lots of text in paragraphs.<index xml:id="index-start-multicolumn" finish="index-finish-multicolumn"><main>Lists</main><sub>multicolumn</sub></index></p>

            <ol cols="5">
                <li><p>Red</p></li>
                <li><p>Blue</p></li>
                <li><p>Green</p></li>
                <li><p>Purple</p></li>
                <li><p>Yellow</p></li>
                <li><p>Black</p></li>
                <li><p>Orange</p></li>
                <li><p>Pink</p></li>
                <li><p>Salmon<index>Strange Colors</index></p></li>
                <li><p>Aqua</p></li>
                <li><p>Cyan</p></li>
                <li><p>Puce<index>Strange Colors</index></p></li>
            </ol>

            <ul cols="2">
                <li>
                    <p>Lorem ipsum dolor sit amet, consectetur adipiscing elit. Proin lorem diam, convallis in nulla sed, accumsan fermentum urna. Pellentesque aliquet leo elit, ut consequat nunc dapibus ac. Sed lobortis leo tincidunt, vulputate nunc at, ultricies leo. Vivamus purus diam, tristique laoreet purus eget, mollis gravida sapien. Nunc vulputate nisl ac mauris hendrerit cursus. Sed vel molestie velit. Suspendisse sem sem, elementum at vehicula id, volutpat ac mi. Nullam ullamcorper fringilla purus in accumsan. Mauris at nunc accumsan orci dictum vulputate id id augue. Suspendisse at dignissim elit, non euismod nunc. Aliquam faucibus magna ac molestie semper. Aliquam hendrerit sem sit amet metus congue tempor. Donec laoreet laoreet metus, id interdum purus mattis vulputate. Proin condimentum vitae erat varius mollis. Donec venenatis libero sed turpis pretium tempor.</p>

                    <p>Praesent rutrum scelerisque felis sit amet adipiscing. Phasellus in mollis velit. Nunc malesuada felis sit amet massa cursus, eget elementum neque viverra. Integer sagittis dictum turpis vel aliquet. Fusce ut suscipit dolor, nec tristique nisl. Aenean luctus, leo et ornare fermentum, nibh dui vulputate leo, nec tincidunt augue ipsum sed odio. Nunc non erat sollicitudin, iaculis eros consequat, dapibus eros.</p>
                </li>

                <li>
                    <p>Donec vestibulum auctor nisl. Nullam placerat interdum dui. Quisque lobortis scelerisque augue imperdiet placerat. Maecenas ultricies massa tempor, laoreet urna a, eleifend enim. Integer sed suscipit odio. Pellentesque non dapibus diam, eget tempus dui. Maecenas sollicitudin magna viverra, egestas velit nec, tristique sem. Cras iaculis mattis dui ac cursus. Integer volutpat, urna vel tempus convallis, erat nisi consectetur turpis, id varius dolor lorem vitae mauris. Phasellus erat orci, laoreet commodo gravida quis, congue in lacus. Cum sociis natoque penatibus et magnis dis parturient montes, nascetur ridiculus mus. Praesent at bibendum turpis. Pellentesque est nisl, dapibus at sagittis non, ultricies in nunc. Etiam ipsum arcu, porta sed feugiat eget, facilisis nec libero. Mauris tempor convallis felis.</p>

                    <p>Cras iaculis sapien elit, at convallis ligula convallis nec. Duis ante tortor, euismod a libero vitae, ornare viverra purus. Pellentesque facilisis urna a velit volutpat, in malesuada tortor porttitor. Sed vehicula mauris id lectus dignissim, eget consectetur dui pellentesque. Sed vel quam molestie, euismod ligula ac, venenatis arcu. Fusce sit amet sapien non urna dignissim tempus in vitae metus. Aliquam arcu turpis, mattis non libero eu, lacinia feugiat turpis. Phasellus rhoncus lacinia lacus facilisis ullamcorper. Praesent hendrerit accumsan neque, eu dignissim est consequat sed. Nulla facilisi. Proin at mi scelerisque, scelerisque felis ut, tristique diam. Proin in leo in lorem porttitor varius. Praesent condimentum in dui sit amet blandit. In imperdiet blandit congue.</p>
                </li>

                <li>
                    <p>Ut nec sem vitae ipsum interdum vestibulum sit amet sed velit. Aliquam tempor nibh vitae augue pulvinar, at ultricies urna commodo. Donec in porta lectus, ac sagittis felis. Vestibulum tincidunt quis metus facilisis luctus. In lobortis lacus vel ornare vehicula. Duis aliquet, ligula semper sodales adipiscing, augue nibh ornare ante, quis pulvinar justo mi eget mi. Mauris varius imperdiet vehicula. Duis dignissim magna quis velit mattis, in cursus lectus vehicula. Morbi quis tempus felis, ut gravida nisi.</p>

                    <p>Vivamus eu commodo est, pretium fringilla dolor. Curabitur vel sollicitudin libero. Integer sit amet auctor felis. Maecenas sagittis erat at ante feugiat, in tincidunt ligula pretium. Integer eget auctor ipsum, quis volutpat felis. Morbi id dignissim eros. Suspendisse aliquet pulvinar lorem gravida egestas. Cum sociis natoque penatibus et magnis dis parturient montes, nascetur ridiculus mus. Praesent nec massa dui. Suspendisse convallis lacus sit amet adipiscing varius. Suspendisse tempus diam vitae justo ornare, in condimentum metus pharetra. Curabitur sem dolor, auctor vitae sagittis vestibulum, posuere imperdiet metus. Etiam pretium lacus urna, vel auctor diam tincidunt non. Etiam viverra sodales iaculis.</p>
                </li>

                <li>
                    <p> Sed varius leo urna. Phasellus tempus mollis ultricies. Curabitur non neque aliquet, facilisis tortor in, sodales dui. Donec hendrerit ultricies nulla mollis rhoncus. In vel lobortis est. Vestibulum consectetur lacus vel sem dignissim vestibulum. Etiam sed elementum ligula, vel congue turpis. Morbi nec diam mattis, venenatis eros et, elementum tellus. Integer sed orci ornare, elementum elit id, lacinia augue. Vestibulum ante ipsum primis in faucibus orci luctus et ultrices posuere cubilia Curae; In et libero id turpis pharetra faucibus. Integer consequat dignissim semper. Donec pretium magna at ullamcorper ultricies. Nam quis suscipit elit. Donec cursus tellus et venenatis feugiat. Mauris dictum molestie leo, vitae aliquet metus luctus vitae.</p>

                    <p>Ut id iaculis leo. Sed nec vestibulum mi. Mauris est mauris, porta in nulla eget, bibendum luctus nisl. Praesent et posuere felis, molestie vehicula velit. Nulla a nunc venenatis, aliquam orci nec, congue felis. Vestibulum a dolor nisi. Morbi sed nisi nulla. Nam iaculis felis a enim blandit, at venenatis diam congue. Nulla augue diam, egestas eget fermentum nec, posuere eget risus. Praesent egestas nulla eros, eget accumsan augue euismod vel. Pellentesque pellentesque non erat vitae posuere. Curabitur lacus arcu, varius sed risus ut, ullamcorper tincidunt lorem. Sed et lacus dignissim, tincidunt nisl ac, porttitor sapien.</p>
                </li>
            </ul>

            <!-- This is not implemented
            <subsection>
                <title>Automatically Defining Sage Code</title>

                <p>There is a bit of Sage code in the source for this section, defined at the beginning.  It is both (a) hidden, and (b) automatically evaluated.  It's effect is to define a function <c>square()</c>, which  will square a number.  The next (visible) cell will demonstrate the effect.  This will work as along as the initialization code and it's use are on the same webpage (which will depend on how you decide to break up your document into pages).</p>

                <sage>
                    <input>square(13)</input>
                    <output>169</output>
                </sage>

            </subsection>
            -->

        </section>

        <!--
        Displayed rows of equations format with
        alignment or not.  The employment of the
        amsmath align or gather environments depends
        on the presence of ampersands, or not, respectively.
        -->

        <section>
            <title>Some Advanced Ideas</title>

            <todo>Move index-finish marker back once it is allowed other places</todo>

            <p><index xml:id="index-finish-multicolumn" start="index-start-multicolumn" />The multi-row displayed mathematics in the proof of the Fundamental Theorem had equations aligned on the equals signs via the <ampersand /> character.  Sometimes you don't want that.  Here is an example with some differential equations, with each equation centered and unnumbered,<md>
                <mrow>{\mathcal L}(y')(s) = s {\mathcal L}(y)(s) - y(0) = s Y(s) - y(0)</mrow>
                <mrow>{\mathcal L}(y'')(s) = s^2 {\mathcal L}(y)(s) - sy(0) - y'(0)= s^2 Y(s) - sy(0) - y'(0).</mrow>
            </md></p>

            <p><latex /> has a device where you can interrupt a sequence of equations with a small amout of text and preserve the equation alignment on eithr side.  Here are two tests of that device, with aligned equations and non-aligned equations.  Study the source to see use and differences.  (The math does not make sense.)  Aligned and numbered first.</p>

            <p><mdn>
                <mrow>{\mathcal L}(y')(s)  &amp;= s {\mathcal L}(y)(s) - y(0) = s Y(s) - y(0)</mrow>
                <mrow>{\mathcal L}(y'')(s) &amp;= s^2 {\mathcal L}(y)(s) - sy(0) - y'(0)= s^2 Y(s) - sy(0) - y'(0).</mrow>
                <intertext>And so it follows that,</intertext>
                <mrow>{\mathcal L}(y')(s)^{++}  &amp;= s {\mathcal L}(y)(s) - y(0) = s Y(s) - y(0)</mrow>
                <mrow>{\mathcal L}(y'')(s)^{5} &amp;= s^2 {\mathcal L}(y)(s) - sy(0) - y'(0)= s^2 Y(s) - sy(0) - y'(0).</mrow>
            </mdn></p>

            <p>Now with no numbers and no alignment.</p>

            <p><md>
                <mrow>{\mathcal L}(y')(s)  = s {\mathcal L}(y)(s) - y(0) = s Y(s) - y(0)</mrow>
                <mrow>{\mathcal L}(y'')(s) = s^2 {\mathcal L}(y)(s) - sy(0) - y'(0)= s^2 Y(s) - sy(0) - y'(0).</mrow>
                <intertext>And so it follows that,</intertext>
                <mrow>{\mathcal L}(y')(s)^{++} = s {\mathcal L}(y)(s) - y(0) = s Y(s) - y(0)</mrow>
                <mrow>{\mathcal L}(y'')(s)^{5} = s^2 {\mathcal L}(y)(s) - sy(0) - y'(0)= s^2 Y(s) - sy(0) - y'(0).</mrow>
            </md></p>

            <p>Tables can get quite complex.  Simple ones are simpler, such as this example of numerical computations for Euler's method.</p>

            <table xml:id="table-euler1">
                <caption>Euler's approximation for Duffing's Equation with <m>h = 0.2</m></caption>
                <tabular top="major" halign="center">
                    <row bottom="minor">
                        <cell>  <m>i</m></cell>
                        <cell><m>t_i</m></cell>
                        <cell><m>x_i</m></cell>
                        <cell><m>y_i</m></cell>
                    </row>
                    <row> <cell>0</cell><cell>0.00</cell><cell>0.0000</cell><cell>0.5000</cell></row>
                    <row> <cell>1</cell><cell>0.20</cell><cell>0.1000</cell><cell>0.4800</cell></row>
                    <row> <cell>2</cell><cell>0.40</cell><cell>0.1960</cell><cell>0.4560</cell></row>
                    <row> <cell>3</cell><cell>0.60</cell><cell>0.2872</cell><cell>0.4295</cell></row>
                    <row> <cell>4</cell><cell>0.80</cell><cell>0.3731</cell><cell>0.4027</cell></row>
                    <row> <cell>5</cell><cell>1.00</cell><cell>0.4536</cell><cell>0.3783</cell></row>
                    <row> <cell>6</cell><cell>1.20</cell><cell>0.5293</cell><cell>0.3591</cell></row>
                    <row> <cell>7</cell><cell>1.40</cell><cell>0.6011</cell><cell>0.3480</cell></row>
                    <row> <cell>8</cell><cell>1.60</cell><cell>0.6707</cell><cell>0.3474</cell></row>
                    <row> <cell>9</cell><cell>1.80</cell><cell>0.7402</cell><cell>0.3603</cell></row>
                    <row bottom="medium">
                          <cell>10</cell><cell>2.00</cell><cell>0.8123</cell><cell>0.3900</cell></row>
                </tabular>
            </table>

        </section>

        <section>
            <title>Mathematics</title>

            <p>To be able to create both <latex /> and HTML output (plus variations), we rely on MathJax, which in turn supports an extensive subset of the mathematical symbols normally available.  The AMSMath symbol set is a good approximation.  For a complete list, see the <url href="http://docs.mathjax.org/en/latest/tex.html#supported-latex-commands">MathJax Supported LaTeX commands</url>.  We load the <c>AMSsymbols</c> library and the library for extensible arrows, <c>extpfeil</c>.</p>

            <p>The following is from the MathJax <url href="http://www.mathjax.org/demos/tex-samples/">demonstration page</url>, an identity due to Ramanujan:<me>\frac{1}{\Bigl(\sqrt{\phi \sqrt{5}}-\phi\Bigr) e^{\frac25 \pi}} = 1+\frac{e^{-2\pi}} {1+\frac{e^{-4\pi}} {1+\frac{e^{-6\pi}} {1+\frac{e^{-8\pi}} {1+\ldots} } } }</me></p>

            <p>And again, from the MathJax demonstration page, Maxwell's equations:<md>
                <mrow>\nabla \times \vec{\mathbf{B}} -\, \frac1c\, \frac{\partial\vec{\mathbf{E}}}{\partial t} &amp; = \frac{4\pi}{c}\vec{\mathbf{j}}</mrow>
                <mrow>\nabla \cdot \vec{\mathbf{E}} &amp; = 4 \pi \rho</mrow>
                <mrow>\nabla \times \vec{\mathbf{E}}\, +\, \frac1c\, \frac{\partial\vec{\mathbf{B}}}{\partial t} &amp; = \vec{\mathbf{0}}</mrow>
                <mrow>\nabla \cdot \vec{\mathbf{B}} &amp; = 0</mrow>
            </md></p>

            <notation>
                <usage>\nabla</usage>
                <description>gradient operator</description>
            </notation>

            <p>A small test that the extensible arrows library is included properly:<me>A\xmapsto[\text{bijection}]{\Phi+\Psi+\Theta}B</me></p>

            <p>Look back at the top of the source file of this document to see how to include your <tex /> macros just once.  For best results keep your macros simple and semantic.</p>

            <p>Chris Hughes has made available <q>slanted</q>, or <q>beveled</q>, or <q>nice</q> fractions.  To wit, we mean fractions such as: <m>\sfrac{3}{8}</m>.  Use the built-in <c>\sfrac{}{}</c> macro in your mathematics to achieve this presentation.</p>

            <p>We consider a system of equations.  We number the first and last equation (there are just two) and include an <c>xml:id</c> on each.  We reference the whole system later as the range of equations from the first to the last.<mdn>
                <mrow xml:id="equation-system-begin">\frac{dx}{dt} \amp = x^2 - 4x - y + 4</mrow>
                <mrow xml:id="equation-system-end">\frac{dy}{dt} \amp = x^3 - y.</mrow>
            </mdn></p>
        </section>

        <section>
            <title>Special, Reserved, and Escape Characters</title>

            <subsection xml:id="subsection-reserved-characters">
                <title>Reserved Characters</title>

                <p>One of the goals of MathBook XML is to relieve an author of managing the numerous conflicts when mixing languages that use different characters for special purposes.  But, of course, XML has its own special characters.</p>

                <p>Everybody wants the ampersand, it is the most-dangerous character.  It is <em>the</em> escape character for XML, and <latex /> uses it to organize tables and arrays, and for aligning equations.  Consistently use the element <c>&lt;ampersand /&gt;</c> to make a literal ampersand in normal text, such as in <q>A<ampersand />P.</q>  In mathematics, and other places where you are using <latex /> syntax, use the pre-defined <c>\amp</c> macro.  For code listings and other verbatim text, use the escaped XML entity <c>&amp;amp;</c>.</p>

                <p>The left angle bracket (<c>&lt;</c>) is the second most-dangerous character in your source, since it looks to the XML processor like the start of a new XML element.  The right angle bracket (<c>&gt;</c>) is less dangerous, but for symmetry we treat it the same as the left.  Consistently use the elements <c>&lt;less /&gt;</c> and <c>&lt;greater /&gt;</c> to make left and right angle brackets in normal text.  In mathematics, and other places where you are using <latex /> syntax, use the pre-defined <c>\lt</c> and <c>\gt</c> macros.  For code listings and other verbatim text, use the XML entities <c>&amp;lt;</c> and <c>&amp;gt;</c>.</p>

                <p>Sage defines generators of algebraic structures with a syntax that might remind one of common notation for all <q>combinations</q> of some generators.  It is non-standard Python, but is instead pre-parsed by Sage.  No matter, at issue here is the left angle bracket used to specify generators.  Here is an example, which can be doctested by Sage to verify the example behaves correctly.  Look at the source to see how the generator syntax is created with the XML entities.</p>

                <sage>
                    <input>
                    P.&lt;t&gt; = ZZ[]
                    P
                    </input>
                    <output>Univariate Polynomial Ring in t over Integer Ring</output>
                </sage>

                <p>There is an alternate Sage syntax, which avoids the angle brackets.</p>

                <sage>
                    <input>
                    R = ZZ['u']
                    u = R.gen(0)
                    (u, R)
                    </input>
                    <output>(u, Univariate Polynomial Ring in u over Integer Ring)</output>
                </sage>

                <p>Ampersands and angle brackets are likely to be necessary in source code, such as Sage code (think generators of field extensions) or TikZ code (think arrowheads), and in matrices (think separating entries).  If you have a big matrix, or a huge chunk of TikZ code, you can protect it all at once from the XML processor by wrapping it in <q><c>&lt;![CDATA[</c><nbsp /><nbsp /><nbsp /><c>]]&gt;</c>.</q>  It should be possible to write without ever using the <q>CDATA</q> mechanism, but it might get tedious in places to use the supplied macros or XML entities.</p>

                <p>The other XML reserved characters are the quotation marks, single and double, <c>'</c> and <c>"</c>.  Their use is only constrained in attributes and so do not present a problem elsewhere.  Here are the three XML reserved characters rendered as normal text, see the source to see how they were authored.</p>

                <p><ampersand /><nbsp /><nbsp />
                <less /><nbsp /><nbsp />
                <greater /><nbsp /><nbsp /></p>

                <p>We test the three <latex /> macros for these characters with a pair of aligned equations:<md>
                    <mrow>a^2 + b^2\amp\lt c^2</mrow>
                    <mrow>c^2\amp\gt a^2 + b^2</mrow>
                </md></p>

                <p>So as a summary of how to avoid conflicts with XML's reserved characters:</p>

                <dl>
                    <li>
                        <title><q>Normal</q> Text</title>
                        <p>Use <c>&lt;ampersand /&gt;</c>, <c>&lt;less /&gt;</c>, <c>&lt;greater /&gt;</c>.</p>
                    </li>
                    <li>
                        <title>Mathematics</title>
                        <p>Within <c>m</c>, <c>me</c>, <c>men</c>, and <c>mrow</c> elements, use <c>\amp</c>, <c>\lt</c>, <c>\gt</c>.  Or use <c>CDATA</c> to enclose a large chunk of <latex /> with many of these characters.</p>
                    </li>
                    <li>
                        <title>Verbatim, Code</title>
                        <p>Within verbatim text (<c>c</c> and <c>pre</c> elements), Sage code, program listings, and console sessions, use the XML entitites <c>&amp;amp;</c>, <c>&amp;lt;</c>, <c>&amp;gt;</c> to get exactly the characters desired.</p>
                    </li>
                </dl>

                <p>It might be instructive to see how the paragraphs above about escape characters were written without inadvertently using an escape character improperly.</p>



                <p>There are a handful of characters that might render just fine in HTML, but <latex /> reserves them for special purposes.  So if they appear unadorned in your source, they will wreak havoc with the <latex /> processing.  And if you escape them with backslashes to migrate to the <latex /> output, then you will see those backslashes in your HTML.  And the backslash is the escape character for Markdown and JSON.  You can't win.  Thus, you need to be aware of these symbols and use the provided MathBook XML elements for each in order to get the right behavior in each type of output.  Here are the outputs, look at the source of this document to see the input elements.</p>

                <!-- Carriage returns are unwise, but this is impossible to read otherwise -->
                <p><hash /><nbsp /><nbsp />
                <dollar /><nbsp /><nbsp />
                <percent /><nbsp /><nbsp />
                <circumflex /><nbsp /><nbsp />
                <ampersand /><nbsp /><nbsp />
                <underscore /><nbsp /><nbsp />
                <lbrace /><nbsp /><nbsp />
                <rbrace /><nbsp /><nbsp />
                <tilde /><nbsp /><nbsp />
                <backslash /><nbsp /><nbsp />
                <asterisk /><nbsp /><nbsp /></p>
            </subsection>

            <subsection>
                <title>Pseudo-Characters and Constructions</title>

                <p>There are a few other very common abbreviations of Latin phrases that can be achieved in HTML one way, and in <latex /> with a slightly different mechanism.  These are due to <latex />'s treatment of a period (full stop), depending on its surroundings.  So not reserved characters, but just divergent treatment.  Again, outputs here, see the source for inputs.  Using these will lead to the best quality in all your outputs.  See Will Robertson's informative and arcane <url href="http://latex-alive.tumblr.com/post/827168808/correct-punctuation-spaces">blog post</url> on the topic if you want the full story for the treatment of a full stop in <latex />.</p>

                <p><eg /><nbsp /><nbsp />
                <ie /><nbsp /><nbsp />
                <etc /><nbsp /><nbsp />
                <circa /></p>


                <p>There are a few other characters and marks that get special treatment.  Some do not appear on your keyboard, such as the symbol for copright (and similar business or legal marks in common use).  Then there are some characters that do not appear on your keyboard but frequently a keyboard character is used as a substitute.  For example, a fraction bar and a forward slash (<c>solidus</c> and <c>slash</c>, respectively) have slightly different slopes.  Also, compare a <c>tilde</c> and a <c>swungdash</c>.  You can fake a <c>midpoint</c> in <latex /> by going to math mode, but the midpoint is really a text character. Again, outputs here, see the source for inputs.  Using these uniformly will lead to the best quality in all your outputs, though some of these are very infrequent, or the distinctions are not always that important.</p>

                <!-- Carriage returns are unwise, but this is impossible to read otherwise -->
                <p><copyright /><nbsp /><nbsp />
                <registered /><nbsp /><nbsp />
                <trademark /><nbsp /><nbsp />
                <ellipsis /><nbsp /><nbsp />
                <midpoint /><nbsp /><nbsp />
                <swungdash /><nbsp /><nbsp />
                <permille /><nbsp /><nbsp />
                <pilcrow /><nbsp /><nbsp />
                <section-mark /><nbsp /><nbsp />
                <times /><nbsp /><nbsp />
                <slash /><nbsp /><nbsp />
                <solidus /></p>

                <p>We also distinguish between abbreviations (<abbr>vs.</abbr>), acronyms (<acro>SCUBA</acro>) and initialisms (<init>XML</init>).</p>
            </subsection>

            <subsection xml:id="section-urls">
                <title>URLs</title>

                <p>An internet <init>URL</init> can very well contain some of the characters that <latex /> needs to escape.  But the packages we use for embedded links should be smart about this.  So we include a long <init>URL</init> for testing <latex /> output, with one reserved character, though maybe someday it will become stale and we need to change it out:  <url href="http://www.pcc.edu/enroll/registration/dropping.html#withdraw">www.pcc.edu/enroll/registration/dropping.html<hash />withdraw</url>.  Notice in the source that you <em>cannot</em> put a tag inside the <c>href</c> attribute, and do need to use an element within the content (unless you like to wrap the content in a <c>c</c> element).  Here is a totally bogus <init>URL</init>, which contains every possible legal character, so if this fails to convert there is some problematic character.  Four combinations: with the content as normal text versus with the characters as verbatim text, and as a <init>URL</init> versus not.</p>

                <blockquote>

                    <p>ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-.<underscore /><tilde />:/?<hash />[]@!<dollar /><ampersand />'()*+,;=</p>

                    <p><c latexsep="|">ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-._~:/?#[]@!$&amp;'()*+,;=</c></p>

                    <p><url href="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-._~:/?#[]@!$&amp;'()*+,;=">ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-.<underscore /><tilde />:/?<hash />[]@!<dollar /><ampersand />'()*+,;=</url></p>

                    <p><url href="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-._~:/?#[]@!$&amp;'()*+,;="><c latexsep="|">ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-._~:/?#[]@!$&amp;'()*+,;=</c></url></p>
                </blockquote>

                <p>The source of the four above examples can be instructive.<ul>
                    <li><p>Four ampersands need to be authored as <c>&amp;amp;</c>: two <c>href</c> attributes and two strings of verbatim text.</p></li>

                    <li><p>Two ampersands are authored as <c>&lt;ampersand /&gt;</c>: two strings of normal text.</p></li>

                    <li><p>For <latex /> output, the verbatim <c>c</c> element will be automatically delimited by a character that is not in the string.  The fault is a question mark, which you see here in the string.  So we have twice used the <c>latexsep</c> attribute with the value <c>|</c> (the <term>pipe</term> character) which cannot ever appear in a <init>URL</init>.</p></li>

                </ul></p>


                <p>When a <c>url</c> has no content, then its <c>href</c> attribute is displayed as the text, automatically in a verbatim font (so no need to consider the <c>latexsep</c> attribute in any way).</p>

                <blockquote>
                    <p><url href="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-._~:/?#[]@!$&amp;'()*+,;="></url></p>
                </blockquote>
            </subsection>

            <subsection>
                <title>Quotations</title>

                <p>The <c>q</c> tag will provide beginning and ending double quotations, while the <c>sq</c> tag will behave similarly but provide single quotes.</p>

                <p><q>The roots of education are bitter, but the fruit is sweet.</q> (Aristotle)</p>

                <p><sq>It is always wise to look ahead, but difficult to look further than you can see.</sq> (Winston Churchill)</p>

                <p>A large quote can be accomodated with the <c>blockquote</c> tag, which can carry within itself an <c>attribution</c> element.</p>

                <blockquote>
                    <p>The problem with writing a book in verse is, to be successful, it has to sound like you knocked it off on a rainy Friday afternoon. It has to sound easy. When you can do it, it helps tremendously because it's a thing that forces kids to read on. You have this unconsummated feeling if you stop.</p>
                    <attribution>Dr. Seuss</attribution>
                </blockquote>

                <p>We say that again, to test a multiline attribution of a block quotation.  Notice how the dash appears automatically, and that it is a <term>quotation dash</term> in HTML, distinct from other sorts of dashes.</p>

                <blockquote>
                    <p>The problem with writing a book in verse is, to be successful, it has to sound like you knocked it off on a rainy Friday afternoon. It has to sound easy. When you can do it, it helps tremendously because it's a thing that forces kids to read on. You have this unconsummated feeling if you stop.</p>
                    <attribution>
                        <line>Dr. Seuss</line>
                        <line>Children's Author</line>
                    </attribution>
                </blockquote>

                <p>Sometimes a quote may extend across several paragraphs.  Or a balanced pair of quotations marks crosses an XML boundary, so we need left, right, single and double versions.  (For example, see Section<nbsp /><xref ref="poetry" /> on poetry.)  Here are all four in a haphazard order: <rq />, <lsq />, <lq />, <rsq />.  These should be a last resort, and <em>not</em> a replacement for the <c>q</c> and <c>sq</c> tags.  The left/right versions are used for the following quote from Abraham Lincoln, which we have edited into two paragraphs.</p>

                <p><lq />I am not bound to win, but I am bound to be true. I am not bound to succeed, but I am bound to live by the light that I have.</p>

                <p>I must stand with anybody that stands right, and stand with him while he is right, and part with him when he goes wrong.<rq /></p>

                <p>And as a tests, we try some crazy combinations of quotes, which would normally give <latex /> some trouble where the quotation marks are adjacent.</p>
                <ul>
                    <li><p><q>we use <sq>single quotes inside of double quotes</sq></q></p></li>
                    <li><p><sq><q>double quotes inside of single quotes</q> with more</sq></p></li>
                    <li><p><q><sq>single quotes tight inside of double quotes</sq></q></p></li>
                    <li><p><sq><q>double quotes tight inside of single quotes</q></sq></p></li>
                    <li><p>An <q><sq><sq><q>absurd test</q></sq></sq></q> of two adjacent single quotes inside a pair of double quotes</p></li>
                    <li><p>you would never do this, but a <sq><sq>pair of single quotes</sq></sq></p></li>
                </ul>

                <p><abbr>N.B.</abbr> We have taken no special care to protect against interactions of the actual quote characters (described above) in <latex /> with themselves, or with the grouping tags.</p>
            </subsection>

            <subsection>
                <title>Groupings</title>

                <p>It is possible to make some other groupings like quotations, such as <braces>some <em>emphasized text</em> grouped within braces</braces>, or <brackets>a <booktitle>Book Title</booktitle> inside brackets</brackets>, <angles>some <foreign>foreign words</foreign> inside angle brackets</angles>, or <dblbrackets>just a bit of text within double brackets</dblbrackets>.  Some of these are used extensively by scholars who study texts to note various restorations or deletions.</p>
            </subsection>

        </section>


        <section>
            <title>Graphics</title>

            <introduction>
                <p>Mathbook XML supports several languages for describing diagrams and pictures with human-readable source code (<ie /> plain text), rather than using a <q>paint</q> program.  Any <latex /> macros used in the rest of your document may be employed in the <latex/>-standalone or Asymptote diagrams (with Sage graphics coming next?).</p>
            </introduction>

            <subsection>
                <title><latex /> images</title>

                <p>There are several graphics engine packages that a <latex /> document can employ. Code from these packages renders diagrams automatically as part of normal processing of <latex /> files.  For HTML output the <c>mbx</c> script produces SVG versions of the pictures.  The script can also produce standalone TEX source files, PDFs, PNGs, and EPSs. The packages should be loaded in <c>docinfo/latex-image-preamble</c>, which is also where global package settings should be made. As mentioned in Subsection <xref ref="subsection-reserved-characters"/>, if any ampersands occur in your <latex /> code you should use the <c>\amp</c> macro. These first examples are from the <url href="http://www.texample.net/tikz/examples/">TeXample.net</url> site.</p>

                <!-- http://www.texample.net/media/tikz/examples/TEX/noise-shaper.tex -->
                <figure xml:id="figure-tikz-electronics">
                    <caption>TikZ Electronics Diagram</caption>
                    <image xml:id="tikz-electronics">
                        <description>A pile of electronic components wired together</description>
                        <latex-image-code>
                        <!-- CDATA prevents certain LaTeX code from being interpreted as xml -->
                        <![CDATA[\tikzset{%
                          block/.style    = {draw, thick, rectangle, minimum height = 3em,
                            minimum width = 3em},
                          sum/.style      = {draw, circle, node distance = 2cm}, % Adder
                          input/.style    = {coordinate}, % Input
                          output/.style   = {coordinate} % Output
                        }
                        % Defining string as labels of certain blocks.
                        \newcommand{\suma}{\Large$+$}
                        \newcommand{\inte}{$\displaystyle \int$}
                        \newcommand{\derv}{\huge$\frac{d}{dt}$}

                        \begin{tikzpicture}[auto, thick, node distance=2cm, >=triangle 45]
                        \draw
                            % Drawing the blocks of first filter :
                            node at (0,0)[right=-3mm]{\Large \textbullet}
                            node [input, name=input1] {}
                            node [sum, right of=input1] (suma1) {\suma}
                            node [block, right of=suma1] (inte1) {\inte}
                                 node at (6.8,0)[block] (Q1) {\Large $Q_1$}
                                 node [block, below of=inte1] (ret1) {\Large$T_1$};
                            % Joining blocks.
                            % Commands \draw with options like [->] must be written individually
                            \draw[->](input1) -- node {$X(Z)$}(suma1);
                            \draw[->](suma1) -- node {} (inte1);
                            \draw[->](inte1) -- node {} (Q1);
                            \draw[->](ret1) -| node[near end]{} (suma1);
                            % Adder
                        \draw
                            node at (5.4,-4) [sum, name=suma2] {\suma}
                                % Second stage of filter
                            node at  (1,-6) [sum, name=suma3] {\suma}
                            node [block, right of=suma3] (inte2) {\inte}
                            node [sum, right of=inte2] (suma4) {\suma}
                            node [block, right of=suma4] (inte3) {\inte}
                            node [block, right of=inte3] (Q2) {\Large$Q_2$}
                            node at (9,-8) [block, name=ret2] {\Large$T_2$}
                        ;
                            % Joining the blocks of second filter
                            \draw[->] (suma3) -- node {} (inte2);
                            \draw[->] (inte2) -- node {} (suma4);
                            \draw[->] (suma4) -- node {} (inte3);
                            \draw[->] (inte3) -- node {} (Q2);
                            \draw[->] (ret2) -| (suma3);
                            \draw[->] (ret2) -| (suma4);
                                 % Third stage of filter:
                            % Defining nodes:
                        \draw
                            node at (11.5, 0) [sum, name=suma5]{\suma}
                            node [output, right of=suma5]{}
                            node [block, below of=suma5] (deriv1){\derv}
                            node [output, right of=suma5] (sal2){}
                        ;
                            % Joining the blocks:
                            \draw[->] (suma2) -| node {}(suma3);
                            \draw[->] (Q1) -- (8,0) |- node {}(ret1);
                            \draw[->] (8,0) |- (suma2);
                            \draw[->] (5.4,0) -- (suma2);
                            \draw[->] (Q1) -- node {}(suma5);
                            \draw[->] (deriv1) -- node {}(suma5);
                            \draw[->] (Q2) -| node {}(deriv1);
                                \draw[<->] (ret2) -| node {}(deriv1);
                                \draw[->] (suma5) -- node {$Y(Z)$}(sal2);
                                % Drawing nodes with \textbullet
                        \draw
                            node at (8,0) {\textbullet}
                            node at (8,-2){\textbullet}
                            node at (5.4,0){\textbullet}
                                node at (5,-8){\textbullet}
                                node at (11.5,-6){\textbullet}
                                ;
                            % Boxing and labelling noise shapers
                            \draw [color=gray,thick](-0.5,-3) rectangle (9,1);
                            \node at (-0.5,1) [above=5mm, right=0mm] {\textsc{first-order noise shaper}};
                            \draw [color=gray,thick](-0.5,-9) rectangle (12.5,-5);
                            \node at (-0.5,-9) [below=5mm, right=0mm] {\textsc{second-order noise shaper}};
                        \end{tikzpicture}]]>
                        </latex-image-code>
                    </image>
                </figure>

                <p>The next example began life in <url href="http://www.frontiernet.net/~eugene.ressler/">Sketch</url>, which will output TikZ code (though the code has been edited by hand for readability).</p>

                <!-- http://www.texample.net/media/tikz/examples/TEX/3d-cone.tex -->
                <figure xml:id="figure-tikz-cone3D">
                    <caption>TikZ Cone Drawing</caption>
                    <image xml:id="tikz-cone" width="70%">
                        <latex-image-code>
                        <!-- CDATA prevents certain LaTeX code from being interpreted as xml -->
                        <![CDATA[\begin{tikzpicture}[join=round]
                        \tikzstyle{conefill} = [fill=blue!20,fill opacity=0.8]
                        \tikzstyle{ann} = [fill=white,font=\footnotesize,inner sep=1pt]
                        \tikzstyle{ghostfill} = [fill=white]
                             \tikzstyle{ghostdraw} = [draw=black!50]
                        \filldraw[conefill](-.775,1.922)--(-1.162,.283)--(-.274,.5)
                                            --(-.183,2.067)--cycle;
                        \filldraw[conefill](-.183,2.067)--(-.274,.5)--(.775,.424)
                                            --(.516,2.016)--cycle;
                        \filldraw[conefill](.516,2.016)--(.775,.424)--(1.369,.1)
                                            --(.913,1.8)--cycle;
                        \filldraw[conefill](-.913,1.667)--(-1.369,-.1)--(-1.162,.283)
                                            --(-.775,1.922)--cycle;
                        \draw(1.461,.107)--(1.734,.127);
                        \draw[arrows=<->](1.643,1.853)--(1.643,.12);
                        \filldraw[conefill](.913,1.8)--(1.369,.1)--(1.162,-.283)
                                            --(.775,1.545)--cycle;
                        \draw[arrows=->,line width=.4pt](.274,-.5)--(0,0)--(0,2.86);
                        \draw[arrows=-,line width=.4pt](0,0)--(-1.369,-.1);
                        \draw[arrows=->,line width=.4pt](-1.369,-.1)--(-2.1,-.153);
                        \filldraw[conefill](-.516,1.45)--(-.775,-.424)--(-1.369,-.1)
                                            --(-.913,1.667)--cycle;
                        \draw(-1.369,.073)--(-1.369,2.76);
                        \draw(1.004,1.807)--(1.734,1.86);
                        \filldraw[conefill](.775,1.545)--(1.162,-.283)--(.274,-.5)
                                            --(.183,1.4)--cycle;
                        \draw[arrows=<->](0,2.34)--(-.913,2.273);
                        \draw(-.913,1.84)--(-.913,2.447);
                        \draw[arrows=<->](0,2.687)--(-1.369,2.587);
                        \filldraw[conefill](.183,1.4)--(.274,-.5)--(-.775,-.424)
                                            --(-.516,1.45)--cycle;
                        \draw[arrows=<-,line width=.4pt](.42,-.767)--(.274,-.5);
                        \node[ann] at (-.456,2.307) {$r_0$};
                        \node[ann] at (-.685,2.637) {$r_1$};
                        \node[ann] at (1.643,.987) {$h$};
                        \path (.42,-.767) node[below] {$x$}
                            (0,2.86) node[above] {$y$}
                            (-2.1,-.153) node[left] {$z$};
                        % Second version of the cone
                        \begin{scope}[xshift=3.5cm]
                        \filldraw[ghostdraw,ghostfill](-.775,1.922)--(-1.162,.283)--(-.274,.5)
                                                       --(-.183,2.067)--cycle;
                        \filldraw[ghostdraw,ghostfill](-.183,2.067)--(-.274,.5)--(.775,.424)
                                                       --(.516,2.016)--cycle;
                        \filldraw[ghostdraw,ghostfill](.516,2.016)--(.775,.424)--(1.369,.1)
                                                       --(.913,1.8)--cycle;
                        \filldraw[ghostdraw,ghostfill](-.913,1.667)--(-1.369,-.1)--(-1.162,.283)
                                                       --(-.775,1.922)--cycle;
                        \filldraw[ghostdraw,ghostfill](.913,1.8)--(1.369,.1)--(1.162,-.283)
                                                       --(.775,1.545)--cycle;
                        \filldraw[ghostdraw,ghostfill](-.516,1.45)--(-.775,-.424)--(-1.369,-.1)
                                                       --(-.913,1.667)--cycle;
                        \filldraw[ghostdraw,ghostfill](.775,1.545)--(1.162,-.283)--(.274,-.5)
                                                       --(.183,1.4)--cycle;
                        \filldraw[fill=red,fill opacity=0.5](-.516,1.45)--(-.775,-.424)--(.274,-.5)
                                                             --(.183,1.4)--cycle;
                        \fill(-.775,-.424) circle (2pt);
                        \fill(.274,-.5) circle (2pt);
                        \fill(-.516,1.45) circle (2pt);
                        \fill(.183,1.4) circle (2pt);
                        \path[font=\footnotesize]
                                (.913,1.8) node[right] {$i\hbox{$=$}0$}
                                (1.369,.1) node[right] {$i\hbox{$=$}1$};
                        \path[font=\footnotesize]
                                (-.645,.513) node[left] {$j$}
                                (.228,.45) node[right] {$j\hbox{$+$}1$};
                        \draw (-.209,.482)+(-60:.25) [yscale=1.3,->] arc(-60:240:.25);
                        \fill[black,font=\footnotesize]
                                        (-.516,1.45) node [above] {$P_{00}$}
                                        (-.775,-.424) node [below] {$P_{10}$}
                                        (.183,1.4) node [above] {$P_{01}$}
                                        (.274,-.5) node [below] {$P_{11}$};
                        \end{scope}
                        \end{tikzpicture}]]>
                        </latex-image-code>
                    </image>
                </figure>

        <p>The pgfplots package was included in <c>docinfo/latex-image-preamble</c>. Here, it is used. Also, here we demonstrate using <c>\amp</c> where you would normally use an ampersand in <latex />. There are known issues with <c>xelatex</c> processing any gradient shading in <c>tikz</c>. To (successfully) create the gradient shading in the 3D image here, you may need to use <c>pdflatex</c> until <latex /> developers resolve this issue.</p>

                <figure xml:id="figure-pgfplots-demo">
                    <caption>Sample pgfplots plot</caption>
                    <image xml:id="pgfplots-demo">
                        <description>A pgfplots example, with a function, a parametric curve, and some points plotted.</description>
                        <latex-image-code>
                        <!-- CDATA prevents certain LaTeX code from being interpreted as xml -->
                        <![CDATA[\begin{tikzpicture}
                        \matrix{
                            \begin{axis}[width = 0.5\linewidth]
                                \addplot[
                                    domain = 0.1:10,
                                    <->,
                                    smooth,
                                    thin,
                                    color = blue,
                                ]{4*ln(x)/ln(10)};
                                \addplot[
                                    only marks,
                                ]coordinates{
                                    (0,2)
                                    (4,3)
                                    (2,4)
                                    (3,4)};
                                \addplot[
                                    variable = \t,
                                    domain = 0:360,
                                    samples = 200,
                                    color = orange,
                                ]({3*sin(2*t)}, {2*cos(5*t)});
                            \end{axis}
                            \amp
                            \begin{axis}[axis lines = box, width = 0.5\linewidth]
                                \addplot3[
                                    surf,
                                    faceted color = blue,
                                    samples = 15,
                                    domain = 0:1,
                                    y domain = -1:1
                                ]{x^2 - y^2};
                            \end{axis}\\
                        };
                        \end{tikzpicture}]]>

                        </latex-image-code>
                    </image>
                </figure>

                <p>A plot might use a graphics language to draw the axes and grid, but the data might be from an experiment and live in an external file that you do not wish to place in your source.  Place such a file in a subdirectory directly below the directory where your master source file resides.  In the example below <c>data</c> is the directory and <c>hodgkin-huxley-data.dat</c> is the file with the data points.  You <em>must</em> place the file in a subdirectory (it cannot reside next to your source file), but that directory may have subdirectories if you have many such files and want to organize them that way.  Then the <c>--include</c> command-line argument to the <c>mbx</c> script will manage the external files properly as it creates individual image files.</p>

                <p>It is still your responsibility to be sure this directory of external data files follows your <latex /> output to whatever directory you use to convert to a PDF and is in the right location for the relative path given in the XML source.  The discussion above only applies to generating individual image files, such as you would need for the HTML output.</p>

                <figure xml:id="figure-pgfplots-data-demo">
                    <caption>External data in a pgfplots plot</caption>
                    <image xml:id="pgfplots-data-demo">
                        <description>A pgfplots example, with external data plotted.</description>
                        <latex-image-code>
                        <!-- CDATA prevents certain LaTeX code from being interpreted as xml -->
                        <![CDATA[\tikzset{%
                        }
                        \begin{tikzpicture}
                        \begin{axis}[
                            xmin=0,xmax=100,ymin=-20,ymax=100,
                            ytick={-20,0,...,100},
                            xlabel={time (ms)},
                            ylabel={potential (V)},
                        ]
                        \addplot[blue] table {data/hodgkin-huxley-data.dat};
                        \end{axis}
                        \end{tikzpicture}]]>
                        </latex-image-code>
                    </image>
                </figure>

            </subsection>

            <subsection>
                <title>Placing Images without a Caption</title>

                <p>Figures, tables and side-by-sides that do not have a caption will automatically not receive a number.  So, in particular, a <c>figure</c> element can be used to place a centered <c>image</c>, with vertical breaks.  We interrupt this current list of figures to include a caption-less one, as a check that the numbering continues sequentially.</p>

                <figure xml:id="figure-captionless-titleless-trefoil">
                    <image source="images/trefoil.png" width="100"/>
                </figure>

            </subsection>

            <subsection>
                <title>Asymptote</title>

                <p>The Asymptote graphics language may be placed in your source to draw graphs, diagrams or pictures.  Rules for formatting code are identical to those for Sage code.  For more on Asymptote see <url href="http://asymptote.sourceforge.net/" />.</p>

                <!--
                See a different (more traditional) variant of URL usage
                in the introductory section.
                -->

                <p>This is a simple physics diagram about levers, taken from the Asymptote documentation.  In the HTML version of this article, the images are SVG's and so should scale nicely when you zoom in on the page.</p>
                <!-- http://asymptote.sourceforge.net/gallery/lever.asy -->

                <!--
                xml:id's on the figures may be employed for cross-references,
                while the xml:id's on the actual graphics code will be used to name
                the files that are created.  They are optional, in which case,
                generic names will be created, though these use serial numbers and so
                will change as more are added.
                -->

                <figure xml:id="figure-asymptote-levers">
                    <caption>Asymptote Lever Demonstration</caption>
                    <image xml:id="asymptote-lever">
                        <description>Moments on a lever</description>
                        <asymptote>
                        size(200,0);

                        pair z0=(0,0);
                        pair z1=(2,0);
                        pair z2=(5,0);
                        pair zf=z1+0.75*(z2-z1);

                        draw(z1--z2);
                        dot(z1,red+0.15cm);
                        dot(z2,darkgreen+0.3cm);
                        label("$m$",z1,1.2N,red);
                        label("$M$",z2,1.5N,darkgreen);
                        label("$\hat{\ }$",zf,0.2*S,fontsize(24pt)+blue);

                        pair s=-0.2*I;
                        draw("$x$",z0+s--z1+s,N,red,Arrows,Bars,PenMargins);

                        s=-0.5*I;
                        draw("$\bar{x}$",z0+s--zf+s,blue,Arrows,Bars,PenMargins);

                        s=-0.95*I;
                        draw("$X$",z0+s--z2+s,darkgreen,Arrows,Bars,PenMargins);
                        </asymptote>
                    </image>
                </figure>

                <p>And a colorful contour plot with logarithmic scale.  Again, from the Asymptote documentation.</p>
                <!-- http://asymptote.sourceforge.net/gallery/2D%20graphs/logimage.asy -->

                <figure xml:id="figure-asymptote-contour-plot">
                    <caption>Asymptote Contour Plot</caption>
                    <image xml:id="asymptote-contour">
                        <asymptote>
                        import graph;
                        import palette;

                        size(10cm,10cm,IgnoreAspect);

                        real f(real x, real y) {
                          return 0.9*pow10(2*sin(x/5+2*y^0.25)) + 0.1*(1+cos(10*log(y)));
                        }

                        scale(Linear,Log,Log);

                        pen[] Palette=BWRainbow();

                        bounds range=image(f,Automatic,(0,1),(100,100),nx=200,Palette);

                        xaxis("$x$",BottomTop,LeftTicks,above=true);
                        yaxis("$y$",LeftRight,RightTicks,above=true);

                        palette("$f(x,y)$",range,(0,200),(100,250),Top,Palette,
                                PaletteTicks(ptick=linewidth(0.5*linewidth())));
                        </asymptote>
                    </image>
                </figure>

                <p>Here is the lever diagram again, but now we have added an integral to one of the legends, <em>using a <latex /> macro of our own,</em> which is idential to one we used in the early part of this article.  The point is, we only needed to define the macro once for the entire document, and it is available as we make Asymptote diagrams.  This device can be used to maintain flexibility and consistency in your choice of notation.</p>

                <figure xml:id="figure-asymptote-latex-macro">
                    <caption>Aymptote Lever, plus Integral</caption>
                    <image xml:id="asymptote-lever-integral">
                        <asymptote>
                        size(200,0);

                        pair z0=(0,0);
                        pair z1=(2,0);
                        pair z2=(5,0);
                        pair zf=z1+0.75*(z2-z1);

                        draw(z1--z2);
                        dot(z1,red+0.15cm);
                        dot(z2,darkgreen+0.3cm);
                        label("$m$",z1,1.2N,red);
                        label("$M$",z2,1.5N,darkgreen);
                        label("$\hat{\ }$",zf,0.2*S,fontsize(24pt)+blue);

                        pair s=-0.2*I;
                        draw("$x$",z0+s--z1+s,N,red,Arrows,Bars,PenMargins);

                        s=-0.5*I;
                        draw("$\bar{x}=\definiteintegral{0}{1}{x\delta(x)}{x}$",z0+s--zf+s,blue,Arrows,Bars,PenMargins);

                        s=-1.05*I;
                        draw("$X$",z0+s--z2+s,darkgreen,Arrows,Bars,PenMargins);
                        </asymptote>
                    </image>
                </figure>

                <p>And finally, an example of a 3-D graph (from the documentation again).</p>
                <!-- http://asymptote.sourceforge.net/gallery/3D%20graphs/filesurface.asy -->
                <!-- Projection point adjusted by Michael Doob -->

                <figure xml:id="figure-asymptote-surface">
                    <caption>Asymptote 3-D Surface</caption>
                    <image xml:id="asymptote-surface" width="40%">
                        <asymptote>
                        // Riemann surface of z^{1/n}
                        import graph3;
                        import palette;

                        int n=3;

                        size(200,300,keepAspect=false);

                        currentprojection=orthographic(10,10,5);
                        currentlight=(10,10,5);
                        triple f(pair t) {return (t.x*cos(t.y),t.x*sin(t.y),t.x^(1/n)*sin(t.y/n));}

                        surface s=surface(f,(0,0),(1,2pi*n),8,16,Spline);
                        s.colors(palette(s.map(zpart),Rainbow()));

                        draw(s,meshpen=black,render(merge=true));
                        </asymptote>
                    </image>
                </figure>
            </subsection>

            <subsection>
                <title>Sage Plots</title>

                <p>Any of the numerous capabilities of Sage may be used to produce any graphics object, be it the simple graph of a single-variable function or some realization of a more complicated object.  All of the usual rules about formatting Sage code (esp. indentation) apply, along with one more caveat.  The last line of your Sage code <alert>must</alert> return a Sage <c>Graphics</c> object (or 3D plot).  The <c>mbx</c> script will isolate this last line, use it as the RHS of an assignment statement, and the Sage <c>.save()</c> method will be called to generate the image, which is either a Portable Document Format (PDF) file amenable to <latex /> output, or a Scalable Vector Graphics (SVG) file amenable to HTML output.  For visualizations of 3D plots, Sage will only produce Portable Network Graphics (PNG) files, which can be included in HTML pages or <latex /> output.</p>

                <figure xml:id="figure-sage-parabola">
                    <caption>A Sage standard parabola, on <m>[-2,4]</m></caption>
                    <image xml:id="sageplot-parabola">
                        <description>A standard parabola on the interval [-2,4]</description>
                        <sageplot>
                        f(x) = x^2
                        plot(f, (x, -2, 4), color='green', thickness=3)
                        </sageplot>
                    </image>
                </figure>

                <p>Pay careful attention to the requirement that the last line of your code be a graphics object.  In particular, while <c>show()</c> might appear to do the right thing, it evaluates to Python's <c>None</c> object and that is just what you will get.  The code for Figure<nbsp /><xref ref="figure-sage-double-plot" /> illustrates creating two graphics objects and combining them into an expression on the last line that evaluates to a graphics object.</p>

                <figure xml:id="figure-sage-double-plot">
                    <caption>Two Sage plots on one set of axes</caption>
                    <image xml:id="sageplot-updown">
                        <sageplot>
                        f(x) = x^4
                        g(x) = -x^4
                        up = plot(f, (x, -1.5, 1.5), color='blue', thickness=2)
                        down = plot(g, (x, -1.5, 1.5), color='red', thickness=2)
                        up + down
                        </sageplot>
                    </image>
                </figure>

                <p>The following examples are from the <url href="http://www.sagemath.org/tour-graphics.html">Sage Tour</url>.</p>

                <!-- Tour example modified: figsize moved from show() into plot() -->
                <figure xml:id="figure-sage-multigraph">
                    <caption>A Sage multigraph of a sentence</caption>
                    <image xml:id="sageplot-sentence-multigraph">
                        <sageplot>
                        stnc = 'I am a cool multiedge graph with loops'
                        g = DiGraph({}, loops=True, multiedges=True)
                        for a,b in [(stnc[i], stnc[i+1]) for i in xrange(len(stnc)-1)]:
                           g.add_edge(a, b, b)
                        g.plot(color_by_label=True, edge_style='solid', figsize=(8,8))
                        </sageplot>
                    </image>
                </figure>

                <!-- Tour example modified: now using R.lagrange_polynomial() -->
                <!-- Tour example modified: dropped ymin/ymax, figsize -->
                <figure xml:id="figure-sage-polynomial-approximation">
                    <caption>Sage polynomial approximations of <m>f(x)=1/(1+25x^2)</m></caption>
                    <image xml:id="sageplot-polynomial-approximation">
                        <sageplot>
                        def f(x):
                           return RDF(1 / (1 + 25 * x^2))

                        def runge():
                            R = PolynomialRing(RDF, 'x')
                            g = plot(f, -1, 1, rgbcolor='red', thickness=1)
                            polynom = []
                            for i, n in enumerate([6, 8, 10, 12]):
                              data = [(x, f(x)) for x in xsrange(-1, 1, 2 / (n - 1), include_endpoint=True)]
                              polynom.append(R.lagrange_polynomial(data))
                              g += list_plot(data, rgbcolor='black', pointsize=5)
                            g += plot(polynom, -1, 1, fill=f, fillalpha=0.2, thickness=0)
                            return g

                        runge()
                        </sageplot>
                    </image>
                </figure>

                <p>From the Sage documentation, with slight modifications, credited to Douglas Summers-Stay.  A plot of the implicity defined surface <me>2 = \cos(x + ty) + \cos(x - ty) + \cos(y + tz) + \cos(y - tz) + \cos(z - tx) + \cos(z + tx)</me> in rectangular <m>xyz</m> coordinates, with <m>t</m> equal to the golden ratio.</p>

                <figure xml:id="figure-sage-implicit-surface">
                    <caption>A Sage implicitly defined 3D surface</caption>
                    <image xml:id="sageplot-implicit-surface">
                        <sageplot>
                        var('x y z')
                        T = RDF(golden_ratio)
                        p = 2 - (cos(x + T*y) + cos(x - T*y) + cos(y + T*z) + cos(y - T*z) + cos(z - T*x) + cos(z + T*x))
                        r = 4.77
                        implicit_plot3d(p, (x, -r, r), (y, -r, r), (z, -r, r), plot_points=100, frame=False)
                        </sageplot>
                    </image>
                </figure>
            </subsection>

            <subsection>
                <title>Images from External Sources</title>

                <p>If you have raster images (photographs, etc) then they are specified with complete filenames, as above in Figure<nbsp /><xref ref="figure-function-derivative" />.  If you have existing images that are vector graphics, then PDF format works best for <latex /> output and SVG format works best for HTML.  The utility <c>pdf2svg</c> works well for converting PDF to SVG.  In this case, specify your source as a filenmae, but leave off the file extension, and the appropriate version will be used for the current output format.</p>

                <p>The image below is provided from a PDF file for the <latex /> output, and was converted to an SVG for use with th HTML output.</p>

                <figure xml:id="figure-complete-graph">
                    <caption>Complete graph on <m>16</m> vertices, from <c>www.texample.net</c></caption>
                    <image source="images/complete-graph" width="65%"/>
                </figure>
            </subsection>

        </section>

        <section>
            <title>Demonstrations</title>

            <demonstration>
                <title>A Simple Demonstration</title>

                <p>Hey!</p>

                <sage type="practice" />

            </demonstration>

        </section>

        <section>
            <title>Further Reading</title>

            <p>In a longer work you might wish to have some references on a per-chapter basis, or similar.  You can make a <q>references</q> subdivision anywhere to hold bibliographic items, and you can reference the items like any other item.  For example, we can cite the article below <xref ref="biblio-beezer-fcla" detail="Chapter R" />, included an indication that a specific chapter may be relevant.</p>

            <references>
                <title>References</title>

                <introduction>
                    <p>These items are here to test basic formatting of references.</p>
                </introduction>

                <biblio type="raw" xml:id="biblio-strang-article">Gilbert Strang, <title>The Fundamental Theorem of Linear Algebra</title>, <journal>The American Mathematical Monthly</journal> November 1993, <volume>100</volume> <number>9</number>, 848<ndash />855.</biblio>

                <biblio type="raw" xml:id="biblio-beezer-fcla">Robert A. Beezer, <title>A First Course in Linear Algebra</title>, 3rd Edition, Congruent Press, 2012.
                <note><p>An online, open-source offering.</p></note>
                </biblio>

                <biblio type="raw" xml:id="biblio-rosswell-fictional">Alexander Rosswell, <title>Diffeomorphisms of Penciled Fiber Bundles</title>, <journal>Mathematicians of America</journal> <year>2020</year>, <volume>2</volume> <number>6</number>, 884<ndash />888.</biblio>

                <biblio type="raw" xml:id="biblio-rosswell-fictional-two"><ibid />, <title>Diffeomorphisms of Penciled Fiber Bundles, Part 2</title>, <journal>Mathematicians of America</journal> <year>2021</year>, <volume>3</volume> <number>4</number>, 102<ndash />103.</biblio>

                <conclusion>
                    <p>This is a conclusion, which has not been used very much in this sample.  Did you see the the second reference above has a short annotation?  So you can make annotated bibliographies easily.</p>
                </conclusion>
            </references>

            <exercises>
                <title>Exercises</title>

                <exercise xml:id="exercises-null-problem">
                    <statement>
                        <p>No problem here, but the next two are in an <q>exercise group</q> with an introduction and a conclusion.  The two problems of the exercise group should be indented some to indicate the grouping.</p>
                    </statement>
                </exercise>

                <exercisegroup xml:id="exercisegroup-two-problems">

                    <introduction>
                        <p>In the next two problems compute the indicated derivative.</p>
                    </introduction>

                    <exercise>
                        <statement>
                            <p><m>f(x)=x^3</m>, <m>\frac{df}{dx}</m>.  This sentence is just a bunch of gibberish to be certain that the problem's left margin aligns with the problem number's indentation.</p>
                        </statement>
                    </exercise>

                    <exercise xml:id="exercises-cosine-derivative">
                        <statement>
                            <p><m>y = \cos(x)</m>, <m>y^\prime</m>.</p>
                        </statement>
                    </exercise>

                    <conclusion>
                        <p>Note that the previous two problems used very different notation for the function and the resulting derivative.</p>
                    </conclusion>

                </exercisegroup>

                <exercise>
                    <statement>
                        <p>Compute <m>\int 3x^2\,dx</m>.</p>
                    </statement>
                </exercise>

                <exercise>
                    <statement>
                        <p>One of the few things you can place inside of mathematics is a <q>fill-in</q> blank.  We demonstrate a few scenarios here.  See details on syntax in <xref ref="subsection-paragraph-markup" autoname="yes" /><ndash />the use is identical within mathematics.<ul>
                            <li><p>Inside inline math (short, 4 characters): <m>\sin(<fillin characters="4" />)</m></p></li>

                            <li><p>Inside inline math (default, 10 characters): <m>\sin(<fillin characters="10" />)</m></p></li>

                            <li><p>Inside exponents and subscripts (2 characters each).  In this case, be sure to wrap your exponents and subscripts in braces, as would be good <latex /> practice anyway: <m>x^{5+<fillin characters="2" />}\,y_{<fillin characters="2" />}</m></p></li>

                            <li><p>Inside inline math (too long for this line probably, 40 characters long): <m>\tan(<fillin characters="40" />)</m></p></li>

                            <li><p>So use inside a displayed equation<me>16\log\space<fillin characters="8" /></me>like this one.</p></li>

                            <li><p>Inside the second line of a multi-line display:<md>
                                <mrow>y &amp;= x^7\,x^8</mrow>
                                <mrow>  &amp;= x^{<fillin characters="3" />}</mrow>
                            </md></p></li>
                        </ul></p>
                    </statement>
                </exercise>

            </exercises>

            <exercises>
                <title>More Exercises</title>

                <exercise>
                    <statement>
                        <p>This is not a real exercise, we just want to explain that this is another subsection of exercises, which has two consecutive exercise groups.</p>
                    </statement>
                </exercise>

                <exercisegroup>
                    <introduction><p>Introduction to first exercise group.</p></introduction>
                    <exercise>
                        <statement><p>Only exercise of first group.</p></statement>
                    </exercise>
                    <conclusion><p>Conclusion to first exercise group.</p></conclusion>
                </exercisegroup>

                <exercisegroup>
                    <introduction><p>Introduction to second exercise group.</p></introduction>
                    <exercise>
                        <statement><p>First exercise of second group.</p></statement>
                    </exercise>
                    <exercise>
                        <statement><p>Second exercise of second group.</p></statement>
                    </exercise>
                    <conclusion><p>Conclusion to second exercise group.</p></conclusion>
                </exercisegroup>

            </exercises>

        </section>

        <section>
            <title>List Calisthenics</title>

            <subsection>
                <title>Lists, Generally</title>

                <p>This section contains nested lists, to demonstrate how they get assigned labels (numbering, symbols).  But we begin with two simple lists, demonstrating an ordered list and an unordered list.  Se the end of section for an example of a description list.  Since Jupyter notebooks use markdown syntax, their lists are less flexible.  So some assertions here may be wrong when viewed as a Jupyter notebook.</p>

                <ol>
                    <li><p>First.</p></li>
                    <li><p>Second.</p></li>
                    <li><p>Third.</p></li>
                </ol>

                <ul>
                    <li><p>Red</p></li>
                    <li><p>Green</p></li>
                    <li><p>Yellow</p></li>
                    <li><p>Purple</p></li>
                </ul>

                <p>Next, we have a list with no customization and multiple levels to test the defaults.  <latex /> allows a maximum of four levels of ordered/numbered lists, and a total of six levels if some unordered lists are mixed in.  The second-level defaults (lower-case Latin) are formatted slightly different in <latex /> versus HTML.  The HTML style is not easy to adjust, but you can  specify the <latex /> version to match if it is important.  The default order of the labels in Markdown/Jupyter (Arabic, Latin, latin, roman) is different than for <latex /> and HTML (Arabic, latin, roman, Latin), so cross-references are not correct.</p>

                <ol>
                    <li><p>Level 1, first.</p></li>
                    <li xml:id="list-two">
                        <p>Level 1, second.</p>
                        <ol>
                            <li><p>Level 2, first.</p></li>
                            <li>
                                <p>Level 2, second.</p>
                                <ol>
                                    <li><p>Level 3, first.</p></li>
                                    <li xml:id="list-two-two-two">
                                        <p>Level 3, second.</p>
                                        <ol>
                                            <li><p>Level 4, first.</p></li>
                                            <li><p>Level 4, second.</p></li>
                                            <li xml:id="list-two-two-two-three"><p>Level 4, third.</p></li>
                                        </ol>
                                    </li>
                                    <li><p>Level 3, third.</p></li>
                                </ol>
                            </li>
                        <li><p>Level 2, third.</p></li>
                        </ol>
                    </li>
                    <li><p>Level 1, third.</p></li>
                </ol>

                <p>Items in ordered lists may be be give an <c>xml:id</c> and then may be the target of an <c>xref</c>.  We test three here, referencing down into the hierarchy above.  Level 1, second: <xref ref="list-two" />.  Level 3, second: <xref ref="list-two-two-two" />.  Level 4, third: <xref ref="list-two-two-two-three" />.</p>

                <p>And now a four-level deep unordered list with the default labels supplied by MBX (disc, circle, square, disc).  Again, the defalt order for Markdown/Jupyter (disc, square, circle, circle) is different than for <latex /> and HTML (disc, circle, square, disc)</p>

                <ul>
                    <li><p>Level 1, first.</p></li>
                    <li>
                        <p>Level 1, second.</p>
                        <ul>
                            <li><p>Level 2, first.</p></li>
                            <li>
                                <p>Level 2, second.</p>
                                <ul>
                                    <li><p>Level 3, first.</p></li>
                                    <li>
                                        <p>Level 3, second.</p>
                                        <ul>
                                            <li><p>Level 4, first.</p></li>
                                            <li><p>Level 4, second.</p></li>
                                            <li><p>Level 4, third.</p></li>
                                        </ul>
                                    </li>
                                    <li><p>Level 3, third.</p></li>
                                </ul>
                            </li>
                            <li><p>Level 2, third.</p></li>
                        </ul>
                    </li>
                    <li><p>Level 1, third.</p></li>
                </ul>

                <p>And a total of six levels with a mix of ordered and unordered lists, the most that out-of-the-box-<latex /> is able to handle.</p>

                <ol>
                    <li><p>Level 1, first.</p></li>
                    <li>
                        <p>Level 1, second.</p>
                        <ol>
                            <li><p>Level 2, first.</p></li>
                            <li>
                                <p>Level 2, second.</p>
                                <ul>
                                    <li><p>Level 3, first.</p></li>
                                    <li>
                                        <p>Level 3, second.</p>
                                        <ol>
                                            <li><p>Level 4, first.</p></li>
                                            <li>
                                                <p>Level 4, second.</p>
                                                <ol>
                                                    <li><p>Level 5, first.</p></li>
                                                    <li>
                                                        <p>Level 5, second.</p>
                                                        <ul>
                                                            <li><p>Level 6, first.</p></li>
                                                            <li><p>Level 6, second.</p></li>
                                                            <li><p>Level 6, third.</p></li>
                                                        </ul>
                                                    </li>
                                                    <li><p>Level 5, third.</p></li>
                                                </ol>
                                            </li>
                                            <li><p>Level 4, third.</p></li>
                                        </ol>
                                    </li>
                                    <li><p>Level 3, third.</p></li>
                                </ul>
                            </li>
                            <li><p>Level 2, third.</p></li>
                        </ol>
                    </li>
                    <li><p>Level 1, third.</p></li>
                </ol>

                <p>Now, nested lists with the defaults replaced by custom choices.  First, an ordered list, three deep, upper Roman numerals, then upper-case Latin, then more traditional Arabic numerals on the three elements of the third level.  Note the adornments of the labels will be rendered in LaTeX, but not in HTML, and the label specifications have no effect in a Jupyter notebook.</p>

                <ol label="*I*">
                    <li><p>Level 1, first.</p></li>
                    <li>
                        <p>Level 1, second.</p>
                        <ol label="++A">
                            <li><p>Level 2, first.</p></li>
                            <li>
                                <p>Level 2, second.</p>
                                <ol label="1)">
                                    <li><p>Level 3, first.</p></li>
                                    <li><p>Level 3, second.</p></li>
                                    <li><p>Level 3, third.</p></li>
                                </ol>
                            </li>
                            <li><p>Level 2, third.</p></li>
                        </ol>
                    </li>
                    <li><p>Level 1, third.</p></li>
                </ol>

                <p>A nested unordered list, with labels given as squares on the outer list and nothing (blank) on the inner lists.</p>

                <ul label="square">
                    <li><p>Level 1, first.</p></li>
                    <li><p>Level 1, second.</p>
                        <ul label="">
                            <li><p>Level 2, first.</p></li>
                            <li><p>Level 2, second.</p></li>
                        </ul>
                    </li>
                    <li><p>Level 1, third.</p></li>
                </ul>

                <p>The next definition is very poorly worded.  It is meant to test leading off with a list (bad form), for which <latex /> normally begins right after the heading.</p>

                <definition>
                    <title>Group</title>
                    <statement>
                        <ol label="a)">
                            <li><p>There is a binary operation, denoted <q><m>\cdot</m></q>.</p></li>
                            <li><p>The operation is associative.</p></li>
                            <li><p>There is an identity element, <m>e</m>.</p></li>
                            <li><p>For every element <m>b</m>, there is an element <m>c</m> (the inverse), such that <me>b\cdot c=c\cdot b = e.</me></p></li>
                        </ol>
                        <p>If these conditions are met for a set <m>G</m>, then we say <m>G</m> is a <term index="yes">group</term>.</p>
                    </statement>
                </definition>


                <p>Exercises and References are specialized subdivisions you can put anywhere.  They are implemented as top-level lists, so should share behavior.  For example, an exercise may have many parts and when expressed as a list, should have the expected labels.</p>

                <p>Similarly, References may have lists in their annotations.  Unlikely?  But possible.</p>

                <p>The next two subdivisions are an Exercises subdivision and a References subdivision, which have lists within an exercise and a bibliographic item (respectively).</p>
            </subsection>

            <exercises>
                <title>Exercises (with lists)</title>

                <exercise>
                    <statement>
                        <p>This exercise should have several parts, and labels should follow the defaults for second-level lists (since the exercise is numbered according to the top-level default).</p>
                        <ol>
                            <li><p>Exercise 1, first part.</p></li>
                            <li><p>Exercise 1, second part.</p>
                                <ol>
                                    <li xml:id="exercise-one-two-one"><p>Exercise 1, second part, first refinement.</p></li>
                                </ol>
                            </li>
                            <li xml:id="exercise-one-three"><p>Exercise 1, third part.</p></li>
                        </ol>
                    </statement>
                </exercise>

                <exercise>
                    <statement>
                        <table>
                            <caption>Table Alignment Example</caption>
                            <tabular top="minor" left="minor" halign="center">
                                <col right="medium"/>
                                <col right="major"/>
                                <col />
                                <!--  -->
                                <row bottom="medium">
                                    <cell colspan="2">1111, 2222</cell>
                                    <cell right="minor">3333</cell>
                                </row>
                                <row bottom="major">
                                    <cell>aaaa</cell>
                                    <cell colspan="2" right="medium">bbbb,cccc</cell>
                                </row>
                                <row>
                                    <cell bottom="minor">AAAA</cell>
                                    <cell bottom="medium">BBBB</cell>
                                    <cell bottom="major" right="major">CCCC</cell>
                                </row>
                            </tabular>
                        </table>

                        <p>This exercise (a list item really) has a <c>table</c> first.  Default <latex /> aligns it vertically above the exercise number.  Placement here tests correcting that alignment.</p>
                    </statement>
                </exercise>


                <conclusion>
                    <p>A small test of cross-references to subsidiary parts of exercises.  Exercise 1, third part: <xref ref="exercise-one-three" />.  Exercise 1, second part, first refinement: <xref ref="exercise-one-two-one" />.</p>
                </conclusion>

            </exercises>

            <subsection>
                <title>Description Lists</title>

                <p>A <q>description</q> list has a short term or phrase that is prominent, followed by a short description.  It is modeled on the lists of similar structure in both <latex /> and HTML.  It makes for a nice medium-weight way to define terms, somewhere in-between the <c>term</c> tag which just makes a term prominent in a sentence, and a <c>definition</c>, which is set off, has a heading, a number, and a title.  This example is from Bob Plantz.</p>

                <dl>
                    <li>
                        <title>Central Processing Unit (CPU)</title>
                        <p>Controls most of the activities of the computer, performs the arithmetic and logical operations, and contains a small amount of very fast memory.</p>
                    </li>

                    <li>
                        <title>Memory</title>
                        <p>Provides storage for the instructions for the CPU and the data they manipulate.</p>
                    </li>

                    <li>
                        <title>Input/Output (I/O)</title>
                        <p>Communicates with the outside world and with mass storage devices (<eg />, disks).</p>
                    </li>

                    <li>
                        <title>Bus</title>
                        <p>A communication pathway with a protocol specifying exactly how the pathway is used.</p>
                    </li>
                </dl>

            </subsection>

            <subsection>
                <title>Named Lists</title>

                <p>A list can be wrapped with a <c>&lt;list&gt;</c> element, so that it earns a number, can be given a title and have an introduction and conclusion.  Cross-references to individual list items get a bit absurd as they are prefixed with the number of the list and then the number of the item, so conceivably you could get a number like <c>4.5.3:2.a.ii</c>.</p>

                <list xml:id="list-colors-rainbow">
                    <title>Colors of the Rainbow</title>

                    <introduction>
                        <p>Because the colors are always in the same order, an ordered list is natural here.  The colors change continuously, but are often divided up into large ranges that human perception can easily distinguish.</p>
                    </introduction>

                    <ol>
                        <li><p>Red</p></li>
                        <li xml:id="rainbow-orange"><p>Orange</p></li>
                        <li><p>Yellow</p></li>
                        <li><p>Green</p></li>
                        <li><p>Blue</p></li>
                        <li><p>Indigo</p></li>
                        <li><p>Violet</p></li>
                    </ol>

                    <conclusion>
                        <p>So some people use the acronym <acro>ROY-G-BIV</acro> to remember this sequence.</p>
                    </conclusion>
                </list>
            </subsection>

            <references>
                <title>References (with lists in Annotations)</title>

                <biblio type="raw" xml:id="biblio-undetermined">
                    Some book would be listed here.
                    <note>
                        <p>Here is the annotation and an ordered list as part of that annotation.  (The lack of a space will be addressed with more work on references.)</p>
                        <ol>
                            <li><p>Book 1, first part.</p></li>
                            <li><p>Book 1, second part.</p></li>
                            <li><p>Book 1, third part.</p></li>
                        </ol>
                    </note>
                </biblio>
            </references>

        </section>

        <section>
            <title>Table Calisthenics</title>

            <p>A very minimal table, hence with left-justified cells, no borders.  We do wrap the tabular element in a table element to get centering, numbering and a caption.</p>

            <table>
                <caption>Some Colors</caption>
                <tabular>
                    <row>
                        <cell>Red</cell>
                        <cell>Green</cell>
                        <cell>Yellow</cell>
                    </row>
                    <row>
                        <cell>Blue</cell>
                        <cell>White</cell>
                        <cell>Pink</cell>
                    </row>
                </tabular>
            </table>

            <p>Tables can be used many ways.  We describe long division of polynomials by using vertical and horizontal borders on individual entries of a table.  The division lines are slightly thicker than the subtraction lines.  This is a good example of the typical abuse of tables for horizontal and vertical layout.  Also indicative of this abuse is that it might make more sense to call this a <q>Figure,</q> not a <q>Table</q>.</p>

            <table>
                <caption>Polynomial Long Division</caption>
                <tabular halign="right">
                    <row>
                        <cell></cell>
                        <cell></cell>
                        <cell></cell>
                        <cell bottom="medium"></cell>
                        <cell bottom="medium"></cell>
                        <cell bottom="medium"><m>x</m></cell>
                        <cell bottom="medium"><m>-</m></cell>
                        <cell bottom="medium"><m>5</m></cell>
                    </row>
                    <row>
                        <cell><m>x</m></cell>
                        <cell><m>+</m></cell>
                        <cell right="medium"><m>2</m></cell>
                        <cell><m>x^2</m></cell>
                        <cell><m>-</m></cell>
                        <cell><m>3x</m></cell>
                        <cell><m>-</m></cell>
                        <cell><m>8</m></cell>
                    </row>
                    <row>
                        <cell></cell>
                        <cell></cell>
                        <cell></cell>
                        <cell bottom="minor"><m>x^2</m></cell>
                        <cell bottom="minor"><m>+</m></cell>
                        <cell bottom="minor"><m>2x</m></cell>
                        <cell bottom="minor"></cell>
                        <cell bottom="minor"></cell>
                    </row>
                    <row>
                        <cell></cell>
                        <cell></cell>
                        <cell></cell>
                        <cell></cell>
                        <cell></cell>
                        <cell><m>-5x</m></cell>
                        <cell><m>-</m></cell>
                        <cell><m>8</m></cell>
                    </row>
                    <row>
                        <cell></cell>
                        <cell></cell>
                        <cell></cell>
                        <cell></cell>
                        <cell></cell>
                        <cell bottom="minor"><m>-5x</m></cell>
                        <cell bottom="minor"><m>-</m></cell>
                        <cell bottom="minor"><m>10</m></cell>
                   </row>
                    <row>
                        <cell></cell>
                        <cell></cell>
                        <cell></cell>
                        <cell></cell>
                        <cell></cell>
                        <cell></cell>
                        <cell></cell>
                        <cell><m>2</m></cell>
                    </row>
                </tabular>
            </table>

            <p>The next table describes how to construct tables via the <c>tabular</c> element.  The <c>table</c> element may be used to enclose the raw table, so as to associate a caption and get vertical separation with horizontal centering.</p>

            <p>The <c>tabular</c> element contains a sequence of <c>row</c> elements, and must contain at least one.  Each <c>row</c> contains a sequence of <c>cell</c> elements and must have the same number in each row (acccounting for the use of the <c>colspan</c> attribute).  The contents of the <c>cell</c> elements are the text to appear in entries of the table.</p>

            <p>A sequence of <c>col</c> elements may optionally be used.  But if one appears, then there must be the right number for the width of the table.  They are empty elements always, and just carry information about their respective column.</p>

            <p>Where the body of the table below has an entry, it means the attribute may be used on the element, and affects the range of the tabular described by the element.  Employment of an attribute on elements to the right in the table will supersede use on elements to the left.  Generally, every cell has right and bottom borders, but only cells at the left side of the table have a left border and only cells across the top have a top border.  Only one cell has four borders.</p>

            <table>
                <caption>Tabular Elements and Attributes (p = planned)</caption>
                <tabular top="major" halign="center">
                    <col halign="left" />
                    <col />
                    <col />
                    <col />
                    <col />
                    <col halign="left"/>
                    <!--  -->
                    <row>
                        <cell>Attributes</cell>
                        <cell colspan="4" halign="center">Elements</cell>
                        <cell>Values</cell>
                    </row>
                    <row bottom="medium">
                        <cell></cell>
                        <cell><c>tabular</c></cell>
                        <cell><c>col</c></cell>
                        <cell><c>row</c></cell>
                        <cell><c>cell</c></cell>
                        <cell>* = default</cell>
                    </row>
                    <row>
                        <cell><c>top</c></cell>
                        <cell><m>\times</m></cell>
                        <cell><m>\times</m></cell>
                        <cell></cell>
                        <cell></cell>
                        <cell>none*, minor, medium, major</cell>
                    </row>
                    <row>
                        <cell><c>left</c></cell>
                        <cell><m>\times</m></cell>
                        <cell></cell>
                        <cell><m>\times</m></cell>
                        <cell></cell>
                        <cell>none*, minor, medium, major</cell>
                    </row>
                    <row>
                        <cell><c>bottom</c></cell>
                        <cell><m>\times</m></cell>
                        <cell></cell>
                        <cell><m>\times</m></cell>
                        <cell><m>\times</m></cell>
                        <cell>none*, minor, medium, major</cell>
                    </row>
                    <row>
                        <cell><c>right</c></cell>
                        <cell><m>\times</m></cell>
                        <cell><m>\times</m></cell>
                        <cell></cell>
                        <cell><m>\times</m></cell>
                        <cell>none*, minor, medium, major</cell>
                    </row>
                    <row>
                        <cell><c>halign</c></cell>
                        <cell><m>\times</m></cell>
                        <cell><m>\times</m></cell>
                        <cell><m>\times</m></cell>
                        <cell><m>\times</m></cell>
                        <cell>left*, center, right</cell>
                    </row>
                    <row>
                        <cell><c>halign</c></cell>
                        <cell></cell>
                        <cell>p</cell>
                        <cell></cell>
                        <cell></cell>
                        <cell>decimal, character</cell>
                    </row>
                    <row>
                        <cell><c>header</c></cell>
                        <cell></cell>
                        <cell>p</cell>
                        <cell>p</cell>
                        <cell>p</cell>
                        <cell>yes/no*</cell>
                    </row>
                    <row>
                        <cell><c>footer</c></cell>
                        <cell></cell>
                        <cell>p</cell>
                        <cell>p</cell>
                        <cell>p</cell>
                        <cell>yes/no*</cell>
                    </row>
                    <row>
                        <cell><c>valign</c></cell>
                        <cell><m>\times</m></cell>
                        <cell></cell>
                        <cell><m>\times</m></cell>
                        <cell></cell>
                        <cell>top, middle, bottom</cell>
                    </row>
                    <row>
                        <cell><c>colspan</c></cell>
                        <cell></cell>
                        <cell></cell>
                        <cell></cell>
                        <cell><m>\times</m></cell>
                        <cell>1*, integer</cell>
                    </row>
                    <row>
                        <cell><c>rowspan</c></cell>
                        <cell></cell>
                        <cell></cell>
                        <cell></cell>
                        <cell>p</cell>
                        <cell>1*, integer</cell>
                    </row>
                    <row>
                        <cell>colors</cell>
                        <cell>p</cell>
                        <cell>p</cell>
                        <cell>p</cell>
                        <cell>p</cell>
                        <cell></cell>
                    </row>
                </tabular>
            </table>

            <paragraphs>
                <title>Bully Pulpit</title>

                <p>One of the goals of MathBook XML is to gently guide authors towards good choices in the design of their documents, even if we do not claim to know it all ourselves.  Take a close look at that table about tables.  What's missing?  No vertical rules.  Try living without them, you will not really miss them.  If you think you need to divide a table into two halves, maybe you really need two tables (and then see the <q>side-by-side</q> capabilities, Section <xref ref="section-side-by-side" />).</p>

                <p>In the documentation for his excellent <latex /> package, <url href="https://www.ctan.org/pkg/booktabs">booktabs</url>, Simon Fear gives two rules for what he calls <q>formal tables</q>: (1) Never, ever use vertical rules, and (2) Never use double rules.  We have resisted the temptation to enforce the former and have provided an alternative to the second (three thicknesses).  He refers to using tables for layout as creating <q>tableau.</q>  If you are finicky about the look of your work, the first three pages of the documentation is recommended reading.</p>

                <p>That all said, we now give several examples in order to stress and demonstrate our code.</p>
            </paragraphs>


            <p>An example of aligning table cells' contents horizontally. See the source for comments.</p>

            <!-- Default matches HTML and LaTEX, left. -->
            <!-- We set this table's default to right. -->
            <table>
                <caption>Horizontal Alignment Example</caption>
                <tabular halign="right">
                    <col />
                    <col />
                    <col halign="center" />
                    <col />
                    <!--  -->
                    <!-- A uniform row to judge effects by, each centered -->
                    <row halign="center">
                        <cell>1234567890</cell>
                        <cell>1234567890</cell>
                        <cell>1234567890</cell>
                        <cell>1234567890</cell>
                    </row>
                    <!-- The bracket caused a bug with LaTeX code, DO NOT remove -->
                    <!-- See https://github.com/rbeezer/mathbook/issues/300      -->
                    <!-- Totally generic, so by columns, all to right            -->
                    <row>
                        <cell>[First</cell>
                        <cell>Second</cell>
                        <cell>Third</cell>
                        <cell>Fourth</cell>
                    </row>
                    <!-- cell-by-cell, with one taking global default -->
                    <row>
                        <cell halign="center">A</cell>
                        <cell halign="right">B</cell>
                        <cell>C</cell>
                        <cell halign="left">D</cell>
                    </row>
                    <!-- whole row is left, but one is centered -->
                    <row halign="left">
                        <cell>1</cell>
                        <cell halign="center">2</cell>
                        <cell>3</cell>
                        <cell>4</cell>
                    </row>
                    <!-- A comment -->
                </tabular>
            </table>

            <p>Example from above, but now with horizontal rules, plus an extra row to test the bottom border.  See the source for comments.</p>

            <table>
                <caption>Horizontal Rules Example</caption>
                <tabular bottom="minor" top="major" halign="right">
                    <col top="minor"/>
                    <col />
                    <col top="none" halign="center" />
                    <col top="major" />
                    <!--  -->
                    <!-- A uniform row to judge effects by, each centered -->
                    <row halign="center">
                        <cell>1234567890</cell>
                        <cell>1234567890</cell>
                        <cell>1234567890</cell>
                        <cell>1234567890</cell>
                    </row>
                    <!-- Totally generic, so by columns, all to right -->
                    <row bottom="none">
                        <cell>First</cell>
                        <cell bottom="major">Second</cell>
                        <cell bottom="major">Third</cell>
                        <cell>Fourth</cell>
                    </row>
                    <!-- cell-by-cell, with one taking global default -->
                    <row bottom="medium">
                        <cell halign="center">A</cell>
                        <cell halign="right">B</cell>
                        <cell>C</cell>
                        <cell halign="left">D</cell>
                    </row>
                    <!-- whole row is left, but one is centered -->
                    <row halign="left">
                        <cell bottom="none">1</cell>
                        <cell halign="center" bottom="minor">2</cell>
                        <cell bottom="none">3</cell>
                        <cell>4</cell>
                    </row>
                    <!-- proper bottom, otherwise defaults -->
                    <row bottom="medium">
                        <cell>1</cell>
                        <cell>2</cell>
                        <cell>3</cell>
                        <cell>4</cell>
                    </row>
                    <!-- A comment -->
                </tabular>
            </table>


            <p>Figures, tables and side-by-sides that do not have a caption will automatically not receive a number.  So, in particular, a <c>table</c> element can be used to place a centered <c>tabular</c>, with vertical breaks.  We interrupt this current list of tables to include a caption-less one, as a check that the numbering continues sequentially and as a check of a minimal example of a table, testing edge and corner cases.</p>

            <table xml:id="table-captionless-titleless-minimal">
                <tabular top="medium"><row bottom="medium" left="minor"><cell right="minor">One</cell></row></tabular>
            </table>

            <p>Same example as before, but now with vertical rules.  See the source for comments.</p>

            <table>
                <caption>Vertical Rules Example</caption>
                <tabular bottom="minor" top="major" left="major" right="medium"  halign="right">
                    <col top="minor"/>
                    <col />
                    <col top="none" halign="center"  right="none"/>
                    <col top="major" />
                    <!--  -->
                    <!-- A uniform row to judge effects by, each centered -->
                    <row halign="center">
                        <cell>1234567890</cell>
                        <cell>1234567890</cell>
                        <cell right="minor">1234567890</cell>
                        <cell>1234567890</cell>
                    </row>
                    <!-- Totally generic, so by columns, all to right -->
                    <row bottom="none">
                        <cell>First</cell>
                        <cell bottom="major">Second</cell>
                        <cell bottom="major" right="medium">Third</cell>
                        <cell>Fourth</cell>
                    </row>
                    <!-- cell-by-cell, with one taking global default -->
                    <row bottom="medium">
                        <cell halign="center">A</cell>
                        <cell halign="right">B</cell>
                        <cell>C</cell>
                        <cell halign="left">D</cell>
                    </row>
                    <!-- whole row is left, but one is centered -->
                    <row left="none" halign="left">
                        <cell bottom="none">1</cell>
                        <cell halign="center" bottom="minor">2</cell>
                        <cell bottom="none">3</cell>
                        <cell right="major">4</cell>
                    </row>
                    <!-- proper bottom, otherwise defaults -->
                    <row bottom="medium">
                        <cell right="none">1</cell>
                        <cell>2</cell>
                        <cell>3</cell>
                        <cell>4</cell>
                    </row>
                    <!-- A comment -->
                </tabular>
            </table>

            <table>
                <caption>Progressively Thicker Rules Example</caption>
                <tabular top="minor" left="minor" halign="center">
                    <col right="medium"/>
                    <col right="major"/>
                    <col />
                    <!--  -->
                    <row bottom="medium">
                        <cell>1111</cell>
                        <cell>2222</cell>
                        <cell right="minor">3333</cell>
                    </row>
                    <row bottom="major">
                        <cell>aaaa</cell>
                        <cell>bbbb</cell>
                        <cell right="medium">cccc</cell>
                    </row>
                    <row>
                        <cell bottom="minor">AAAA</cell>
                        <cell bottom="medium">BBBB</cell>
                        <cell bottom="major" right="major">CCCC</cell>
                    </row>
                </tabular>
            </table>
            <table>
                <caption>Column Span Example</caption>
                <tabular top="minor" left="minor" halign="center">
                    <col right="medium"/>
                    <col right="major"/>
                    <col />
                    <!--  -->
                    <row bottom="medium">
                        <cell colspan="2">1111, 2222</cell>
                        <cell right="minor">3333</cell>
                    </row>
                    <row bottom="major">
                        <cell>aaaa</cell>
                        <cell colspan="2" right="medium">bbbb,cccc</cell>
                    </row>
                    <row>
                        <cell bottom="minor">AAAA</cell>
                        <cell bottom="medium">BBBB</cell>
                        <cell bottom="major" right="major">CCCC</cell>
                    </row>
                </tabular>
            </table>

            <example>
                <title>Example Environment with Leading Table</title>

                <!-- Requires many right="minor" since no col attributes are used -->
                <table>
                    <caption>Column Spans, No <c>col</c> Elements, Nine Columns</caption>
                    <tabular >
                        <!--  -->
                        <row left="minor">
                            <cell right="minor">1</cell>
                            <cell colspan="2" right="minor">2+3</cell>
                            <cell right="minor">4</cell>
                            <cell colspan="3" right="medium">5+6+7</cell>
                            <cell colspan="2" right="major">8+9</cell>
                        </row>
                        <row left="minor">
                            <cell right="minor">1</cell>
                            <cell right="minor">2</cell>
                            <cell right="minor">3</cell>
                            <cell right="minor">4</cell>
                            <cell right="minor">5</cell>
                            <cell right="minor">6</cell>
                            <cell colspan="2" right="minor">7+8</cell>
                            <cell right="minor">9</cell>
                        </row>
                        <row left="minor">
                            <cell right="minor">1</cell>
                            <cell right="minor">2</cell>
                            <cell right="minor">3</cell>
                            <cell right="minor">4</cell>
                            <cell right="minor">5</cell>
                            <cell right="minor">6</cell>
                            <cell right="minor">7</cell>
                            <cell right="minor">8</cell>
                            <cell right="minor">9</cell>
                       </row>
                   </tabular>
               </table>

               <p>This example tests several things.  In <latex /> output, figures, tables, listings and side-by-sides are <q>floats</q> whose placement can migrate, but we have tries to supress this behavior.  However, a float that is the first item of an <q>environment</q> (like a theorem or an example) can still float to a position <em>before</em> its title.  If that does not happen here, then our additional defenses are working.</p>

               <p>This example also checks that the total number of columns is correctly computed from the first row, which features several <c>colspan</c> attributes.</p>
           </example>

            <p>A bare minimum table (one row with one cell) to test edge cases:</p>

            <table xml:id="table-minimal">
                <caption>One entry table</caption>
                <tabular top="medium">
                    <row bottom="medium" left="minor">
                        <cell right="minor">One</cell>
                    </row>
                </tabular>
            </table>

            <p>Table cells can have multiline content using <tag>line</tag> elements. This is not the same thing as a paragraph cell<mdash />line breaking will happen precisely where the author tells it to. A line will not break, even on a narrow screen. If a cell uses a <tag>line</tag>, it must only use a sequence of <tag>line</tag>s and no other content. This is also a good time to demonstrate the <attribute>valign</attribute> attribute.</p>

            <table xml:id="table-multiline-cells">
                <caption><abbr>Dr.</abbr> Seuss lines</caption>
                <tabular top="medium" left="medium" bottom="medium" right="medium">
                    <row valign="bottom">
                        <cell>
                             <line>One Fish</line>
                             <line>Two Fish</line>
                             <line>Red Fish</line>
                             <line>Blue Fish</line>
                        </cell>
                        <cell>
                             <line>I am the Lorax.</line>
                             <line>I speak for the trees.</line>
                        </cell>
                        <cell>
                             <line>Look at me!</line>
                             <line>Look at me!</line>
                             <line>Look at me NOW!</line>
                             <line>It is fun to have fun.</line>
                             <line>But you have</line>
                             <line>to know how.</line>
                        </cell>
                    </row>
                </tabular>
            </table>

            <p>Tables are formed in <latex /> output with copious use of the <c>\multicolumn</c> macro to override more global alignment settings, and to spread the content of one cell across several columns.  However, some other <latex /> macros then do not behave as they should.  So the table below, one item per row, is just designed for <latex /> testing.  But of course, it should still render fine in other formats.  The first five test cases are from <xref ref="section-urls" />, but without the 52 alphabetic characters (which should not be problems in this context).  The sixth cell tests the tilde, which seems to only be a problem as the leading character of the verbatim string.</p>

            <table xml:id="table-latex-problems">
                <caption>Problematic Cells for <latex /></caption>
                <tabular halign="center" top="medium" left="medium" bottom="medium" right="medium">
                    <row>
                        <cell>1</cell>
                        <cell halign="left">0123456789-.<underscore /><tilde />:/?<hash />[]@!<dollar /><ampersand />'()*+,;=</cell>
                    </row>

                    <row>
                        <cell>2</cell>
                        <cell halign="left"><c latexsep="|">0123456789-._~:/?#[]@!$&amp;'()*+,;=</c></cell>
                    </row>

                    <row>
                        <cell>3</cell>
                        <cell halign="left"><url href="0123456789-._~:/?#[]@!$&amp;'()*+,;=">0123456789-.<underscore /><tilde />:/?<hash />[]@!<dollar /><ampersand />'()*+,;=</url></cell>
                    </row>

                    <row>
                        <cell>4</cell>
                        <cell halign="left"><url href="0123456789-._~:/?#[]@!$&amp;'()*+,;="><c latexsep="|">0123456789-._~:/?#[]@!$&amp;'()*+,;=</c></url></cell>
                    </row>

                    <row>
                        <cell>5</cell>
                        <cell halign="left"><url href="0123456789-._~:/?#[]@!$&amp;'()*+,;="></url></cell>
                    </row>

                    <row>
                        <cell>6</cell>
                        <cell halign="left"><c>~x[i]</c></cell>
                    </row>
                </tabular>
            </table>

        </section>


        <section>
            <title>Embedded Interactive Elements</title>

            <introduction>
                <p>When outputting Web page versions, it is possible to embed a variety of dynamic interactive elements.  In a <latex />/PDF version, these will necessarily need to be replaced by some static substitute, such as a screenshot.  See Section<nbsp /><xref ref="section-sage-cells" /> for the specifics of embedding instances of the Sage Cell Server.</p>
            </introduction>

            <subsection>
                <title>GeoGebra</title>

                <p>This first example of a  GeoGebra demonstration has just the controls for moving the three vertices on the circumfrence of the circle.  This is courtesy of Danny Parsons at the African Institute of Mathematical Sciences.  This demo requires Java, which could be problematic.</p>

                <p>GeoGebra will create screenshots of demonstrations in TikZ/<latex /> code.  For a static version, we use this as a figure.</p>

               <!-- 1. Build a GeoGebra applet                            -->
               <!-- 2. Save it as an HTML page                            -->
               <!-- 3. Open the HTML and find the Base64 encoded version  -->
               <!-- 4. Copy (with no line breaks!) into ggbBase64 element -->

                <geogebra-applet>
                    <ggbBase64>UEsDBBQACAAIAAdcL0QAAAAAAAAAAAAAAAASAAAAZ2VvZ2VicmFfbWFjcm8ueG1s7VhNb9s4ED1vfwXBu2V9WLYTRCkcB4sGSDcLJIe9FRTFyNxKpCrRiZ1fv0NSSuXIcho3QZ1FfbAofgyH73EeOTr5uMozdMfKiksRYc9xMWKCyoSLNMJLdTuY4o+nH05SJlMWlwTdyjInKsIjx8ffx8GbM3b1YLSq+LGQf5GcVQWh7JouWE4uJSXK9FwoVRwPh/f3905j05FlOkxT5ayqBCPwR1QRrgvHYG5j0H1guvuu6w3/+XxpzQ+4qBQRlGEEvuaElhLRPNFORPj625KU0KKkzLo1n1hW6Nk4leJPnjFdrhby/kLcQOsZKSOsyiV0prJYz0mhV1HVdc1cF6JYKkTcCM8wIl6Ez/CwabtaqqaR2Mb4iwcFP8LUFIIIJ6YwinAhs7UuhhGew2Mc4XNjCXyrYEaqJ0eKK+smWaqFLHUpIUrXQE+WsZwJhdS6YNoeFwqjjMQs086dfvjjRC8OyfhfRlWztLrdvAx1H2iey0yWCKwDp6n5jyPshyFMmxULAjXAtumckTUr0R3JdK+6Bux9lgnbqCWC52YToEqxQhuApVYFYwnsO1x7DIUCDJrdd0uyqnaISlkmFVqBC44/xmith4+h8GD3rOlkVnvNH+ppg3atWmdtb06GNVDPQHb2f4Bs5BxNa8hG01eBjMo8JyJBwoYTS3W9gYpvDQWApx0Gxlpto0NAVVtrICbPUNBach8H7v4MfEcRsJ+6G7/QgOo7E3+j2u7KAWxUt93g1dNwwSy0asHpV8EqUBO/4dK1hU88SZiW40fwMs3vhVAguMzIQGXdbK3+K2PFDQy+EjclEZUWatun2aT9DF6VoCSpFCS7BPeeEHlmiSQdIuPdROqVPrIUd1m0rv94JL0Ki4NtdK172NWREjij8Kg1YrQ/jeybsEMq/R9hnhcZp1zt5mbOS5r1cDLrcEJ3cwIHCaePmNNfSspeEPKUiTvwVJYVXDXc+saydu386KGpWQE6A1O19uqqB68lfCCrJV+hWdN/1vSawcHsTZzwqP0D1ZwF9RQzOKcHVlJnoZkERHUrvyDUlN9yupvfx6B+QjGtbwv2ruB3mJ7vZnrzHJvvdY6Np4Zp/Yjt4+cDMHS8cTvMPBN+gbMZlN4bHFM7RW7WJ3LJC0QueaciN3Zcf3oYwtZ7a2AvETb2W9i2CtvAc6bTSSv+wuCpstn7da1scMN+A2VjluOkT9nOX6Js5wejbL4zCjZOjbCWtmAj6N5C2v6GvBGUrS+WDM5zm2ued+Bukk4tf01qGjepKW1SU52jPkOL9aEB3prdNx5e7b7vBS/hsz8v7KQlX7znROZ3ZrJPZrIb9ngb7L8kH+wcst72M3a8PY8YvyPQ6eGADvBONkR24hvYu2zYq82RMw78FiGTdwR7cjCw99wnt7OhJcbeKA9VYobt76n63Xyp1YXmk/Tpf1BLBwgvoJ72MAQAABgXAABQSwMEFAAIAAgAB1wvRAAAAAAAAAAAAAAAABYAAABnZW9nZWJyYV9qYXZhc2NyaXB0LmpzSyvNSy7JzM9TSE9P8s/zzMss0dBUqK7lAgBQSwcIRczeXRoAAAAYAAAAUEsDBBQACAAIAAdcL0QAAAAAAAAAAAAAAAAMAAAAZ2VvZ2VicmEueG1s1Vtbc9u4FX7O/goMH/oU08SFIJlK2XFu03SSTaZOO52+QSQkIaZILUnZkic/vucApERJvslxsoocGwSJ2/m+cwPEDH5fznJyqavalMXQo37gEV2kZWaKydBbNOOT2Pv95W+DiS4nelQpMi6rmWqGnvCZt+kHNV8G2NlkQy9UajwScnwiYqlOhBL6JOEBP0mTUPJxKnQ2Tj1ClrV5UZR/qJmu5yrV5+lUz9SHMlWNHXPaNPMXp6dXV1d+N7tfVpPTyWTkL+vMI7Dyoh567cULGG6r0xW3zVkQ0NP/fvzghj8xRd2oItUeQakW5uVvzwZXpsjKK3JlsmY69GJKPTLVZjIFMaXgHjnFRnOQda7TxlzqGrr2qlbmZjb3bDNV4PNn7orka3E8kplLk+lq6AU+E1IGCWUi5JEMosQjZWV00bRtaTvnaTfa4NLoKzcsXtkZRZBEQIGpzSjXQ2+s8hqkMsW4AkRhQdUCqnWzyvVIVV19sx76HH6ggbnWOBZQ52AYeux5kjyPguB5GAZuIf1ZPdKUZW6HDEiYkG/fCAtYQJ5jQV3BoJDSPQrcvYC7grlCuCJ0bYTrLlxT4doI1wYJuFXItr6Rsr2xJWYnJO8LSUE+/JXwa6XfkTPuyUlRiG+E4uptwQmum9r1YyHaqnTVyBY0cAVtH8b4x+Ilv1Mi/iiJaG9Wpwy3T7qnLN2MIerqQ2dkB8y4J+ZaSHaTkCy8RcjvxLablIa9SWEu+8/+7k3J2SFT3orsATNK8T12/4gJo2DL6juTdyVty7tgeLJFDU47TzhoF0TqKbZt9avRsxqXyBPrmwglIdiujMCVhIQmUERow4zQkIgQqjQmEsuIcDRbQTiJCbajnFgPFMbwR1iTliSEsfBm5GybcEFCTqj1W4IACsT6PsCEcWgRhiSETjg7xWm5JEJChcdEwALR60XoWTj0gzpMzginhGNfGhEmiWQkQs9JBTpUGePaYVBGZEAkdgXXCW7TuUzoEROO0sjW56Dj8si8rM0a56nO52uCLKSmmC+aLRjTWdZdNuVO66xML17twK5V3XTX0Aji1iY6uji2FTyfDXI10jmkGOeoEYRcqhwN3o4/LouGdNrA3L1JpeZTk9bnummgV02+qkv1QTV6+Q5a190C7dQ2pg/0Is1NZlTxH1AXHAIHJF2It16sC/EiTNwsaVlW2fmqBh0iy//pqgTfE8WY1KzaWhj5sv9BH5UqVHjOfd7/gDGsbnnUyqkv19KopV7LQCYVWlyv8r5+VeabW/PSFM1rNW8Wlc3RYA0VCnJWTHJt8bQ0Q7aTXozK5bkDkruxvqzmUAvcCkaT12VeVqRCyUJo0JYjV9o2uLR1q8C2CWyLoGPGZOvnNGG2hS1HrrStgGq3tFZU2olJg24aU1tPA4M7xepcMyoKJk+LwjQfukpj0ouNqNjhj8VsBDrWKuH2mPSpxhyc7qjV4EJXhc6d8hRA5qJc1E6b1xr5bLCo9WfVTM+K7F96Amb4WaFTbGBo13Sz5EynZgYd3f0WPIXE/huW6u5melLpTsTcpsUOWvs06Kvy3m071LuqnL0vLr+A1uwsdXDayTOo08rMUTvJCLz0hd7oX2ZqBT4+6/cD4WuQIkUnA0A2COLbRa4r8gGY94haNNMSFOSNKooVAflr6ABDgQWjyyf/VMVCVSvwn1R4aL25nkE2TBqrrlbj17Sd2TQb+SHl6Cv4lHU0cc83aMLjG1XXKrnK51OFqXgLTa5WsNw+WHa8j2W2CyEwZOUEPzF3ujLX2qmZWy9czGE4a509NbCc1GQ59E6Ej0tYwRX1Q0jir93Oy+0zUFq02i2v6O7uEAr66IC6B7JXvz5kDqcVzk7DHw7Y618fsBPmx4lFjPkRfxLE0nI2U0VGCpvSfS7z1aQsvE0GoQK0TqIoahxRDHF0IC2a7vkcelHXJnVtFBR86I3cbO0cN/DjZusYcONsx5YGUoQL2C/XdufRtKHOXvzDZJm2+c/p3cz2sOxTS0NuyQ1pG/w23NJDuL1dAWs9wdp6Iek9Knj4Qg9Uwp4qUT9iVpWkDxmZU6UoZmI3uD+cANCIHJX3fYFhUNvAsR84L7SeY8byqfhSqaLGo6ftiPlwONURwcn8MHbeX/hCWjyFH9FE/kJ4jo4HT+HzLpbKMOl/2sgq/SSM46MCd9uVfjSZiz/bvnS05z3f3Ock+0HszT5F2wnwzVFMxpYhLEaueAKV56jf/U/cBnO0hCcPTbfgqfbwfHsInm+PCM8A9qEWQeoL8fMQTPcQfHcIgu+OCEEALr5BIwHZyJ6brD/0B8B73nrTbXTfubxoP2nK7gZ51zdn98F8i3Pe3t4/jdmjdjrfLLZQDZzWnkBGcWyB7yFUvenS3F2q9GFU6WOhKvAF2zKHxBEX+ixxTAGDMv71mHrrmDrbY2p8GFPjY2GK++iSVta64m0X5vKdCIJqvHfwdkRErQfeoSpzVOk9qlKNPUpzjx/cDjabTo/Zyz865nwaj2vdIFEuoNCHukrYC7A4Ys7sIl/GXHSbLWA0CeUTxh88lXtlkIKyujfpnNyNem5P+FowJ8diJTftBVbtXuEajUjGtJeRxtHj7UX/WbgutTs9NrN5blLTPJqC/SxregAF02Oh4MSdFqzWBwg2igQ+59tp1/EAv79BMAcAb44FeHeqsFqfNFzjwY0M46gH+89G/TafP3E+f7rv802VLmboxKt7cqodt9/v9xd5fnfuGj/QTHjsUx5wvvZXjrvQ51KEYmMslkgGKbUM4ieMBa8BsFzvuqA+irckUBd305KWhUnXWF887rzoiWzjUXpuJrq4tG6iJmQZtC/HrQI3P7nu7iyp3TbiM9reuqa9HeNMNZVZkrOu/VnX6oxBxwgDFY9YJKKIMw6BiJzxdoozYQMZC1kUhwnjUcjtd85noX2HjMXQNU4YE2EUxzK62T7xe3czNundWvCpaqblpCxUbr+x29aG192B/a4KfD3APX49Fvd4c1xifpJQttmf8p/tIe9koP1aZT9A5QcwkB8LAzcEKCp9Jr7nG4UfAPorB/p+Rjw7APTZsYB+T0YMu0kW0u/YNj5tXvDVYZ/vYV8iY4enBf1uPzUruNMRUR8iPPjvzVEjMoInLSxa5wNx+IMi/w0q34fJ+fz+1nv77Bzf7zjAEFz7x2DfvZx0qDFsErJ2Vy3YQ02F80CGnFL8ljOhLTF46M6iSFIRhzGTQeDOW5jPqWAQu/FAWcLu5sfbkF7OKxgP3xDokNPLBlYJD4be3/5clM3fN+/fkDd6Zl/Qse8UuKd2xG22cAhve7y/Mmez7wHWujLjzVu0oPAfEfDA27wg2GHVdqsbVTWf0RBIe86f7B0822+ykcDNh/VP+ftQn/bfbbLvF7b/F+Hl/wFQSwcIHn8WWOwJAAA7MQAAUEsBAhQAFAAIAAgAB1wvRC+gnvYwBAAAGBcAABIAAAAAAAAAAAAAAAAAAAAAAGdlb2dlYnJhX21hY3JvLnhtbFBLAQIUABQACAAIAAdcL0RFzN5dGgAAABgAAAAWAAAAAAAAAAAAAAAAAHAEAABnZW9nZWJyYV9qYXZhc2NyaXB0LmpzUEsBAhQAFAAIAAgAB1wvRB5/FljsCQAAOzEAAAwAAAAAAAAAAAAAAAAAzgQAAGdlb2dlYnJhLnhtbFBLBQYAAAAAAwADAL4AAAD0DgAAAAA=</ggbBase64>
                   <figure>
                        <caption>GeoGebra demonstration of the Euler Line</caption>
                        <image xml:id="tikz-geogebra-euler">
                            <latex-image-code>
                            \begin{tikzpicture}
                            \definecolor{ffqqqq}{rgb}{1,0,0}
                            \definecolor{uuuuuu}{rgb}{0.27,0.27,0.27}
                            \definecolor{zzttqq}{rgb}{0.6,0.2,0}
                            \definecolor{qqqqff}{rgb}{0,0,1}
                            \clip(-8.34,-5.38) rectangle (14.1,7.73);
                            \fill[color=zzttqq,fill=zzttqq,fill opacity=0.1] (-4.55,-1.57) -- (1.17,-0.04) -- (-2.89,2.73) -- cycle;
                            \draw [color=zzttqq] (-4.55,-1.57)-- (1.17,-0.04);
                            \draw [color=zzttqq] (1.17,-0.04)-- (-2.89,2.73);
                            \draw [color=zzttqq] (-2.89,2.73)-- (-4.55,-1.57);
                            \draw(-1.87,-0.13) circle (3.04cm);
                            \draw [color=ffqqqq,domain=-8.34:14.1] plot(\x,{(-1.96-1.02*\x)/0.44});
                            \draw (-1.89,6.62) node[anchor=north west] {Euler Line Demonstration};
                            \fill [color=qqqqff] (-4.55,-1.57) circle (1.5pt);
                            \draw[color=qqqqff] (-4.32,-1.18) node {$A$};
                            \fill [color=qqqqff] (1.17,-0.04) circle (1.5pt);
                            \draw[color=qqqqff] (1.41,0.35) node {$B$};
                            \fill [color=qqqqff] (-2.89,2.73) circle (1.5pt);
                            \draw[color=qqqqff] (-2.64,3.11) node {$C$};
                            \fill [color=uuuuuu] (-2.09,0.37) circle (1.5pt);
                            \draw[color=uuuuuu] (-0.84,0.74) node {$centeroid$};
                            \fill [color=uuuuuu] (-1.87,-0.13) circle (1.5pt);
                            \draw[color=uuuuuu] (-0.24,0.02) node {$circumcentre$};
                            \fill [color=uuuuuu] (-2.53,1.39) circle (1.5pt);
                            \draw[color=uuuuuu] (-1.29,1.79) node {$orthocentre$};
                            \draw[color=ffqqqq] (-3.75,6.23) node {$Euler$};
                            \end{tikzpicture}
                            </latex-image-code>
                        </image>
                    </figure>
                </geogebra-applet>

                <p>With a totally empty <q>geogebra</q> element, you will get a blank slate to play around in.   This is based on an example of embedding GeoGebra into Sage notebooks by Bruce Cohen.  Notice the full suite of menus and tools (in contrast to the previous example).</p>

                <p>Again, this example will run with Java.  GeoGebra demonstrations can be run via HTML5 without invoking Java, but this seems to only be possible in the Chrome browser.  Support will be expanded, especially if requested.</p>

                <geogebra-applet />

            </subsection>

        </section>

        <section>
            <title>Video</title>

            <p>First, a gratuitous reference to Exercise<nbsp /><xref ref="exercises-cosine-derivative" /> about the derivative of a cosine.</p>

            <p>Embedded videos can make sense for a web version of your document. This is a video promoting the University of Puget Sound to potential new students.  Support is limited to WebM format initially, mp4 support will be easy to add.  This may require an HTML5 capable browser, such as Chrome, to render properly.</p>

            <figure>
                <caption>University of Puget Sound Promotional Video</caption>
                <video source="images/ups-visitor-guide-360.mp4" />
            </figure>

            <p>YouTube videos may be embedded with only knowledge of the <q>ID</q>.  This a string of eleven seemingly random characters that show up in the URL when you watch a video.  For the Led Zeppelin performance below, the ID is <c>hAzdgU_kpGo</c>, which you might normally watch directly from the URL <url href="https://www.youtube.com/watch?v=hAzdgU_kpGo" />.  Screen real estate is determined by specifying an optional <c>@width</c> attribute as a percentage, and aspect ratio is preserved on the assumption of HD video (16:9).</p>

            <p>Enhancements could include other aspect ratios, and attributes for a start and stop time.</p>

            <p>These may be placed <q>standalone</q> but are designed mostly on the assumption that they are wrapped in a <c>figure</c> with a <c>title</c> (which is distinct from a <c>caption</c>).</p>

            <figure>
                <title>Kashmir (Live), Led Zeppelin</title>
                <caption>Kashmir (Live), Led Zeppelin. O2 Arena, London. December 10, 2007. (8:55)</caption>
                <video youtube="hAzdgU_kpGo" width="70%" xml:id="led-zeppelin-kashmir" />
            </figure>

            <p>If you have ever owned a drone, you sympathize with this guy.  Way funnier than a cat video.</p>

            <figure>
                <title>My first day with my drone</title>
                <caption>First Drone Flight (1:28)</caption>
                <video youtube="VsHMjWORFvI" />
            </figure>

            <p>If you are only interested in a piece of the action, you can limit the video with <c>start</c> and <c>end</c> attributes in seconds.  You might make those times clear in the caption for readers getting the link out of a PDF.  Some videos may not respect these parameters.</p>

            <figure>
                <title>My first day with my drone (Splashdown)</title>
                <caption>First Drone Flight (Splashdown, 0:54 to 1:12)</caption>
                <video youtube="VsHMjWORFvI" start="54" end="72" />
            </figure>

        </section>

        <exercises xml:id="exercises">
            <title>Exercises</title>

            <introduction>
                <p>Exercises in an <q>exercises</q> section are numbered automatically.  However, what if you have a busted problem and remove it?  Then a bunch of problem numbers change and your list of homework for your students changes as well.  What a mess.  Use auto-numbering while writing and refining.  Once stable, go ahead and hard-code problem numbers as you delete/add.  Notice the oddly numbered problem below.  Once you go down this road, you can't stop.  But instructors will thank you for it.</p>

                <p>More precisely, once you hard-code a number for a problem, you will likely need to hard-code every subsequent problem number in that section of exercises.  This is because the automatic numbering is unlikely to be what you really want, or what you had before.</p>
            </introduction>

            <exercise>
                <title>An Exercise in a Section</title>
                <statement>
                    <p>Exercises can appear in a <q>section</q> of their own.  You need to give the section a title, even if it seems obvious what to call it.  Individual exercises may have titles, as you choose.  Problem: How should we hide solutions?</p>
                </statement>
                <solution>
                    <p>Maybe a global switch should be used to suppress solutions, while a separate processing regime could use them as part of a solutions manual.</p>
                </solution>
            </exercise>

            <exercise number="42a" xml:id="exercise-with-hardcoded-number">
                <title>An Exercise with a Hard-Coded Problem Number</title>
                <statement>
                    <p>Compute the definite integral <m>\definiteintegral{2}{4}{x^2}{x}</m>, not as an approximate value from a Riemann sum, but as an exact value based of the limit by using the Fundamental Theorem.</p>
                </statement>
                <solution xml:id="solution-antiderivative">
                    <p>An antiderivative of <m>x^2</m> is <m>F(x)=x^3/3</m>, so by the FTC,<me>\definiteintegral{2}{4}{x^2}{x}=F(4)-F(2)=\frac{1}{3}\left(4^3-2^3\right)=\frac{56}{3}.</me></p>
                </solution>
            </exercise>

            <exercise>
                <statement>
                    <p>Can you prove Corollary<nbsp /><xref ref="corollary-FTC-derivative" /> directly?  If not consider that a problem could have several parts, which should be formatted as a second-level list, since the problems normally get numbered at the top level</p>
                    <ol>
                        <li><p>Why is this result a Corollary?</p></li>
                        <li><p>Could you interchange the Theorem and Corollary?</p></li>
                    </ol>
                </statement>
                <!-- A hint is a push in the right direction -->
                <hint>
                    <p>Consider the definite integral as an area function and employ the Mean Value Theorem.</p>
                </hint>
                <!-- You can provide several -->
                <hint xml:id="exercise-complicated-second-hint">
                    <p>Think harder!</p>
                </hint>
                <!-- The answer is just the end product -->
                <answer xml:id="exercise-complicated-first-answer">
                    <ol>
                        <li><p>It follows easily.</p></li>
                        <li><p>Yes.</p></li>
                    </ol>
                </answer>
                <!-- A solution is everything that should be said -->
                <solution>
                    <p>We could prove either result first, then obtain the other as an easy consequence.</p>
                </solution>
            </exercise>

         </exercises>

        <!--
        Various author tools are planned.  Note the embedded "todo"
        elements above.  An XSL transform in-testing will extract them
        for a report, and they are hidden in actual output.
        For a cross-reference, instead of a "ref" atrribute,
        you can use a "provisional" attribute while writing, which is
        especially useful for unknown forward references.  This is
        included in the author report also.
        A "preview" XSL transform to HTML could be especially useful.
        -->

        <section xml:id="section-cross-referencing">
            <title>Cross-Referencing</title>

            <p>Cross-references are easy, since that is a key reason for having a highly structured document.  Here is a useful feature if you elect to use it.  Any <c>&lt;xref&gt;</c> will <q>know</q> what it points to, so you can let it provide the <q>naming</q> part of the cross-reference text.  You can turn this on globally with the command-line parameter <c>autoname</c> set to <c>'yes'</c>.  If you do that, you will see most of the names in this document doubled, since the names are written into the source already in most places outside of this section.  Try it and see: use <c>--stringparam autoname 'yes'</c> as an argument to <c>xsltproc</c>.</p>

            <p>Moreover, the names themselves will change with the use of the one language dependent file.  And another bonus is that with an autoname, you automatically get a <em>non-breaking</em> space between the name and the reference.  The autoname switch makes no sense for <q>provisional</q> cross-references, since there is no information about what they point to.</p>

            <p>Here is a reference that has no indication of its type in the source:  <xref ref="theorem-FTC" />.  So by default you will just see a number that you can click on.  If you use the <c>autoname="yes"</c> switch then you should see <q>Theorem</q> prepended.  Note that if you changed the theorem to a lemma, then that change would be reflected here automatically when autonaming is in effect.</p>

            <p>If you set the autonaming behavior globally, or accept the default behavior, there will still be instances where you want to override that choice.  Simple: just say <c>autoname="yes"</c> or <c>autoname="no"</c> as part of the <c>xref</c>.  Each example below should look the same each time this article is processed, no matter how the global <c>autoname</c> is set.</p>

            <ul>
                <li><p>No name ever: <xref ref="corollary-FTC-derivative" autoname="no" /></p></li>
                <li><p>Always named: <xref ref="corollary-FTC-derivative" autoname="yes" /></p></li>
            </ul>

            <p>You might also wish to provide a prefix to a cross-reference and have it incorporated into the text of what you would click on in an electronic version.  So if you make an <c>xref</c> with some content, then that content will prefix the cross-reference within the clickable/pokeable text and be attached with a non-breaking space.  This <c>xref</c> content totally overrides any prefix that might happen otherwise.  So the name of an item (<eg /> <q>corollary</q>) could be replaced, and if you make a cross-reference with a title as the clickable, then that text can be replaced also.  An example:</p>

            <ul>
                <li><p>A grand result: <xref ref="corollary-FTC-derivative">Major Corollary</xref></p></li>
                <li><p>A grand result: <xref ref="corollary-FTC-derivative" autoname="title">a nice corollary</xref></p></li>
            </ul>

            <p>Suppose you want to reference two theorems, so you might want to say something like <q>Theorems 4.6 and 5.2.</q>  With global autonaming on, you can override the first <c>Theorem</c> by providing the content <c>Theorems</c> on the first <c>xref</c> and <c>autoname="no"</c> on the second <c>xref</c>.  (With global autonaming off, you will also get what you want/expect.)   Here is the test, which should look correct no matter what the global switch is:  <xref ref="section-cross-referencing">Sections</xref> and <xref ref="section-internationalization" autoname="no" />.  (But notice that it is up to you to be certain the types of these targets do not change without you changing the content of the first <c>xref</c>.  The <q>author-tools</q> mode and careful choices of <c>xml:id</c> strings can help avoid this trap.)</p>

            <p>One final twist.  If you say <c>autoname="title"</c>, then the title you assigned to the theorem will prefix the number.  Here is a the final example, which should always refer to a fundamental theorem by name <xref ref="theorem-FTC" autoname="title" />.</p>

            <p>Cross-references to exercises with hard-coded numbers should respect the supplied number.  Exercise<nbsp /><xref ref="exercise-with-hardcoded-number" /> should reference problem 42a.</p>

            <p>Here we form a list to test pointing at various structures.  Each of the following should open a knowl in the HTML version, otherwise it will be a traditional hyperlink (if possible).  Note that if a knowl opens, there will always be an <q>in-context</q> link which will take you to the actual location, should you have  wished instead to just go there.</p>

            <ul>
                <li><p>Footnotes: Fermat allusion at <xref ref="footnote-fermat" />.</p></li>
                <li><p>Citations: Judson's AATA with annotation at <xref ref="biblio-judson-AATA" /></p></li>
                <li><p>Citations: Judson's AATA with autoname that should have zero effect <xref ref="biblio-judson-AATA" autoname="yes"/></p></li>
                <li><p>Note: just the annotation of previous citation at <xref ref="note-judson-AATA" /></p></li>
                <li><p>Examples: Mystery derivative at <xref ref="example-mysterious" />, or a question at <xref ref="sample-question" />.</p></li>
                <li><p>Definition-like: A mathematical statement with no proof <xref ref="principle-principle" />.</p></li>
                <li><p>A numbered Note: <xref ref="note-remark" /></p></li>
                <li><p>A link to a <c>proposition</c> element, while this document has globally renamed <c>proposition</c>s as <q>Conundrum</q>s, so this link should use the new name: <xref ref="proposition-as-conundrum" autoname="yes" /></p></li>
                <li><p>Theorems: Fundamental Theorem of Calculus, with proof at <xref ref="theorem-FTC" /></p></li>
                <li><p>Proof: of second version of FTC at <xref ref="proof-FTC-corollary" /></p></li>
                <li><p>Figures: A plot with a derivative at <xref ref="figure-function-derivative" />.</p></li>
                <li><p>A Figure within a side-by-side panel, with its own number: <xref ref="another-regular-figure" /></p></li>
                <li><p>A Table within a side-by-side panel, with a subnumber: <xref ref="table-sidebyside-subtable" /></p></li>
                <li><p>A Side-By-Side Panel, in its entirety (a special Figure): <xref ref="fig-sidebyside-global" /></p></li>
                <li><p>Display Mathematics: single, first with no name: <xref ref="equation-alternate-FTC" />.  Then with an autoname: <xref ref="equation-alternate-FTC" autoname="yes" />.</p></li>
                <li><p>Display Mathematics: multi-row, first with no name: <xref ref="equation-use-FTC" />.  Then with an autoname: <xref ref="equation-use-FTC" autoname="yes" />.  And two, with a plural form: <xref ref="equation-alternate-FTC">Equations</xref> and <xref ref="equation-use-FTC" autoname="no" />.</p></li>
                <li><p>Exercises (sectional), a range, with plural form provided to override autonaming: <xref first="exercises-null-problem" last="exercises-cosine-derivative">Exercises</xref>.</p></li>
                <li><p>Exercise (inline): with enclosed hint at <xref ref="exercise-essay" /></p></li>
                <li><p>A group of two exercises, with introduction, conclusion: <xref ref="exercisegroup-two-problems" autoname="yes" /></p></li>
                <li><p>Solution: An autonamed portion of an exercise: <xref ref="solution-antiderivative" autoname="yes" /></p></li>
                <li><p>Parts of a complicated exercise: <xref ref="exercise-complicated-second-hint" autoname="yes" /> <xref ref="exercise-complicated-first-answer" autoname="yes" /></p></li>
                <li><p>An item buried in nested ordered lists (local reference): <xref ref="list-two-two-two-three" autoname="yes"/></p></li>
                <li><p>A subsidary part of an exercise (fully-qualified reference): <xref ref="exercise-one-two-one" /></p></li>
                <li><p>List item as knowls in HTML, including nested lists: <xref ref="list-two" />, <xref ref="list-two-two-two" autoname="yes" /></p></li>
                <li><p>A titled list: <xref ref="list-colors-rainbow" /></p></li>
                <li><p>List item inside a named list, second color in rainbow list: <xref ref="rainbow-orange" autoname="yes" /></p></li>
                <li><p>An assemblage, which never has a number.  A cross-reference now requires content in the <c>xref</c> element: <xref ref="assemblage-basics">text to xref an assemblage</xref></p></li>
                <!-- <li><p>: <xref ref="" /></p></li> -->
            </ul>

            <p>Cross-references to structural elements of the document will always take you there directly, since even in the HTML version these parts never get realized as knowls.  You will find such links sprinkled through this document, but here is an autonamed link to a subsubsection:  <xref ref="subsubsection-different-integrals" autoname="yes" />.</p>

            <p>Cross-references can be built into display mathematics, but they can only point to one item (<ie /> a comma-delimited list of targets is not supported).  Examples below should test the distinction in HTML output between a link that opens a knowl and a link that jumps to a larger chunk of content.  Notice that display mathematics is entirely <latex /> syntax, no matter which output format you create.  So if you do not use the <c>autoname</c> facility, you need to wrap non-math text in <c>\text{}</c> and perhaps use a tilde (<c>~</c>) as a non-breaking space (examine the source of this article).</p>

            <p><md>
                <mrow>x^2 + y^2 &amp;= z^2&amp;&amp;<xref ref="theorem-FTC" autoname="yes" /></mrow>
                <mrow>a^2 + b^2 &amp;= c^2&amp;&amp;\text{Section}~<xref ref="section-fundamental-theorem" /></mrow>
            </md></p>

            <p>Variations on the above include multiple <c>xml:id</c> as the value of a single <c>ref</c> attribute on an <c>xref</c>, in the form of a comma-separated list.  In this case, only the numbers are links/knowls and the autonaming attribute is based on the type of the first <c>ref</c>.  Wrapping with brackets (citations) or parentheses (equations) is also controlled by the type of the first <c>ref</c>.  And the <c>detail</c> attribute for a bibliographic reference is silently ignored.  So you can do silly things like have a reference to a theorem within a list of equation numbers and there will be no error message.  Handle with care.  Spaces after commas in the list will migrate to the output as spaces, so if you don't have any, you won't get any.</p>

            <ul>
                <li><p>Three theorems, with spaces, autonamed: <xref ref="theorem-FTC, theorem-number-01, theorem-number-03" autoname="yes"/></p></li>
                <li><p>Two equations, no spaces, autonamed: <xref ref="equation-alternate-FTC,equation-use-FTC" autoname="yes"/></p></li>
                <li><p>Two bibliographic items, no autoname: <xref ref="biblio-judson-AATA, biblio-lay-article" /></p></li>
                <!-- <li><p>: <xref ref="" /></p></li> -->
            </ul>

            <p>If you have a long list of items (such as homework exercises, not in an <c>exercisegroup</c>, or perhaps several chapters, you can get a cross-reference that prints as a range by using <c>xref</c> with two attributes <c>first</c> and <c>last</c>, which may contain a single <c>xml:id</c> each.  As with multiple references, <c>first</c> will control autonaming and other features.</p>

            <ul>
                <li><p>A range of exercises, autonamed: <xref first="exercise-test-number" last="exercise-essay" autoname="yes"/></p></li>
                <li><p>A range of equations: <xref first="equation-alternate-FTC" last="equation-use-FTC" /></p></li>
                <li><p>A system of equations, given as range from first to last: <xref first="equation-system-begin" last="equation-system-end" /></p></li>
                <li><p>A range of sections, hand-named to be plural: Sections<nbsp /><xref first="section-sage-cells" last="section-cross-referencing" /></p></li>
                <li><p>A range of bibliographic items: <xref first="biblio-judson-AATA" last="biblio-lay-article" /></p></li>
                <!-- <li><p>: <xref ref="" /></p></li> -->
            </ul>

        </section>

        <section xml:id="section-internationalization">
            <title>Internationalization</title>

            <p>Supporting a multitude of possible characters, across many languages and across many output formats can be a challenge.  One of our goals is to make this easier for authors.  Fortunately, the Unicode standard has led to improvements from the 7-bit ASCII standard of old.</p>

            <paragraphs>
                <title>Unicode Characters for HTML Output</title>

                <p>First, we discuss HTML output.  If you include Unicode characters in your MathBook XML source, they should survive just fine <foreign>en route</foreign> to a web browser or e-reader.  Here are the caveats for HTML output:<ul>
                    <li>So that you can conhtinue to get the best results with print and PDF output, use available empty elements for special characters, even if targeting HTML output, before resorting to a Unicode character.  For example, use <c>&lt;times /&gt;</c> for a small <q>multiplication sign</q> in text before resorting to the Unicode character <c>U+00D7</c>.</li>

                    <li>How you actually enter Unicode characters into your source file is dependent on your editor and operating system, and is therefore outside the scope of our documentation.  You can cut/paste characters and text from the source of our examples for initial testing and experimentation.</li>

                    <li>Always, always identify your source as having Unicode characters by including the incantation <c latexsep="!">&lt;?xml version="1.0" encoding="UTF-8" ?&gt;</c> as the first line of your source file. (You <em>may</em> be able to accurately cut/paste this text here.  But if the copy has non-standard characters in it, go back to the top of this source file for a copy.)</li>

                    <li>Alan Woods <url href="http://www.alanwood.net/unicode/unicode_samples.html">Unicode Resources</url> has a plethora of samples of various groups of Unicode characters.  If you, or your readers, are <q>missing</q> characters in a web browser, this is a good place to start testing the local setup.</li>
                </ul></p>
            </paragraphs>

            <paragraphs>
                <title>Characters in <latex />, PDF, print</title>

                <p>The situation for <latex /> is much more complicated, since <tex /> pre-dates Unicode's widespread adoption.</p>

                <p>This sample article is intended to work well, out-of-the-box, for authors just starting with MathBook XML.  So we only include here examples that we know are likely to convert to PDF without any errors.  For more extensive examples and experiments, we provide the sample document <c>examples/fonts/fonts-and-characters.xml</c>, so be aware of that example as you look to see what is possible.</p>

                <p>Similarly, you should be able to process this sample article successfully with various <latex /> engines.  We test regularly with <c>pdflatex</c> and <c>xelatex</c> and provide online sample PDF output of this document processed by <c>pdflatex</c>.  In principle, you should be able to use <c>latex</c> (to produce a DVI), and possibly other (unsupported) engines, such as <c>lualatex</c>.</p>

                <p>Once you get beyond the Latin alphabet, with accents common in Western Europe and the Western Hemisphere, you will almost assuredly need to restrict your attention to producing PDF output with the <c>xelatex</c> engine.  This is discussed and tested in <c>examples/fonts/fonts-and-characters.xml</c>.</p>
            </paragraphs>

            <paragraphs>
                <title>Basic Latin, <c>U+0000</c><ndash /><c>U+007F</c></title>

                <p>Unicode uses multiple 8-bit bytes to represent characters, and these are typically expressed in hexadecimal (base 16) notation.  Using just a single byte, we can get 256 values, and the first 128 (hex <c>00</c> to <c>7F</c>) are the <q>usual</q> Latin characters with some values used as control codes.  These 95 characters are the most basic, and should all render using <c>pdflatex</c> or <c>xelatex</c> with no special setup (and HTML).  <c>U+0000</c> to <c>U+001F</c> are control codes and not used here.  <c>U+007F</c> is also a control code and so is excluded.  We have also replaced reserved <latex /> characters by their MathBook XML equivalent empty elements: </p>

                <!-- ex &#x0000; - &#x001F; controls -->
                <!-- ex &#x007F; control             -->
                <blockquote>
                    <p>&#x0020; &#x0021; &#x0022; <hash /> <dollar /> <percent /> <ampersand /> &#x0027; &#x0028; &#x0029; &#x002A; &#x002B; &#x002C; &#x002D; &#x002E; &#x002F; &#x0030; &#x0031; &#x0032; &#x0033; &#x0034; &#x0035; &#x0036; &#x0037; &#x0038; &#x0039; &#x003A; &#x003B; <less /> &#x003D; &#x003E; &#x003F; &#x0040; &#x0041; &#x0042; &#x0043; &#x0044; &#x0045; &#x0046; &#x0047; &#x0048; &#x0049; &#x004A; &#x004B; &#x004C; &#x004D; &#x004E; &#x004F; &#x0050; &#x0051; &#x0052; &#x0053; &#x0054; &#x0055; &#x0056; &#x0057; &#x0058; &#x0059; &#x005A; &#x005B; <backslash /> &#x005D; <circumflex /> <underscore /> &#x0060; &#x0061; &#x0062; &#x0063; &#x0064; &#x0065; &#x0066; &#x0067; &#x0068; &#x0069; &#x006A; &#x006B; &#x006C; &#x006D; &#x006E; &#x006F; &#x0070; &#x0071; &#x0072; &#x0073; &#x0074; &#x0075; &#x0076; &#x0077; &#x0078; &#x0079; &#x007A; <lbrace /> &#x007C; <rbrace /> <tilde /></p>
                </blockquote>
            </paragraphs>

            <paragraphs>
                <title>Latin-1 Supplement, <c>U+0080</c><ndash /><c>U+00FF</c></title>

                <p>Now we are interested in the next 128 possible bytes,  (hex <c>80</c> to <c>FF</c>).  The first 32 are again control codes and <c>U+00A0</c> is a non-breaking space, while <c>U+00AD</c> is a soft hyphen.  We have taken care to see that the remainder will render using <c>pdflatex</c> or <c>xelatex</c> with no special setup (and HTML).For more details, see the fothcoming extensive tables in <c>examples/fonts/fonts-and-characters.xml</c> . Here are all of the 94 characters.</p>

                <!-- ex &#x0080; - &#x009F; controls -->
                <!-- ex &#x00A0; non-breaking space  -->
                <!-- ex &#x00AD; soft hyphen         -->
                <blockquote>
                    <p>&#x00A1; &#x00A2; &#x00A3; &#x00A4; &#x00A5; &#x00A6; &#x00A7; &#x00A8; &#x00A9; &#x00AA; &#x00AB; &#x00AC; &#x00AE; &#x00AF; &#x00B0; &#x00B1; &#x00B2; &#x00B3; &#x00B4; &#x00B5; &#x00B6; &#x00B7; &#x00B8; &#x00B9; &#x00BA; &#x00BB; &#x00BC; &#x00BD; &#x00BE; &#x00BF; &#x00C0; &#x00C1; &#x00C2; &#x00C3; &#x00C4; &#x00C5; &#x00C6; &#x00C7; &#x00C8; &#x00C9; &#x00CA; &#x00CB; &#x00CC; &#x00CD; &#x00CE; &#x00CF; &#x00D0; &#x00D1; &#x00D2; &#x00D3; &#x00D4; &#x00D5; &#x00D6; &#x00D7; &#x00D8; &#x00D9; &#x00DA; &#x00DB; &#x00DC; &#x00DD; &#x00DE; &#x00DF; &#x00E0; &#x00E1; &#x00E2; &#x00E3; &#x00E4; &#x00E5; &#x00E6; &#x00E7; &#x00E8; &#x00E9; &#x00EA; &#x00EB; &#x00EC; &#x00ED; &#x00EE; &#x00EF; &#x00F0; &#x00F1; &#x00F2; &#x00F3; &#x00F4; &#x00F5; &#x00F6; &#x00F7; &#x00F8; &#x00F9; &#x00FA; &#x00FB; &#x00FC; &#x00FD; &#x00FE; &#x00FF;</p>
                </blockquote>
            </paragraphs>

            <p>Again, more examples and more thorough explanations can be found in the sample: <c>examples/fonts/fonts-and-characters.xml</c>.  Be aware that the nature of this sample is that it will likely produce many errors when processed with <c>pdflatex</c>.  Adding <c>-interaction batchmode</c> or <c>-interaction nonstopmode</c> to the <c>pdflatex</c> command-line will sometimes be less painless than acknowledging each error.  This more thorough sample will perform well when processed with <c>xelatex</c>.</p>
        </section>

        <section>
            <title>Pre-Formatted Text</title>

            <p>In Sage, if you wanted to build a matrix, then you would use the <c>matrix()</c> constructor.  Here is the matrix of second partials of <m>f(x,y)=x^3+8x^2y^3 + y^4</m>, as you would enter it in Sage.  Notice that <c>SR</c> is the ring of symbolic expressions, <c>Symbolic Ring</c>.</p>

            <pre>
            var('x', 'y')
            J = matrix(SR, [
                [6*x + 16*y^3, 48*x*y^2],
                [48*x*y^2, 48*x^2*y + 12*y^2]
                ])
            </pre>

            <p>That accomplished, Sage will easily and naturally provide a <latex /> representation of the matrix with the command <c>latex(J)</c>.</p>

            <pre>
            \left(\begin{array}{rr}
            16 \, y^{3} + 6 \, x &amp; -48 \, x y^{2} \\
            48 \, x y^{2} &amp; 48 \, x^{2} y + 12 \, y^{2}
            \end{array}\right)
            </pre>

            <p>The realization of preformatted text should be robust enough that it can be cut from documents and pasted without any substitutions of <q>fancier</q> Unicode characters for generic ASCII characters.  Try the <q>minus</q> sign on the <m>48</m> above to see if it does not become a dash, or the single quotes on the Sage variables.</p>

            <p>For Sage input code, the first non-whitespace character sets the left margin, since legitimate Python code has no subsequent lines outdented.  For pre-formatted code, the line with the <em>least</em> whitespace leading the line will determine the left margin.  If preserving indentation is important, do not mix spaces and tabs.  For syntax highlighting of text representing computer programs, or parts of them, see Section<nbsp /><xref ref="section-programs" />.  Examine the source of the following example to help understand this paragraph.</p>

            <pre>
            A normal line
                    An indented line
    An outdented line
            </pre>

            <p>The <c>&lt;c&gt;</c> element, for inline code snippets (or anything else in a monospace font) uses the question-mark character to tell <latex /> where the text begins and ends.  This will be a problem if the text has a question mark in it!  So there is the attribute <c>latexsep</c> that allows you to specify another character that does not appear in your text.  For example, XML directives use question-marks now and then, so writing about them in MathBook XML requires specifying a different separation character, as in:  <c latexsep="!">&lt;?xml version="1.0" encoding="UTF-8" ?&gt;</c>.  The <c>&lt;pre&gt;</c> element does not suffer from this quirk.</p>

            <p>Snippets should also be robust for cut/paste operations.  For example, you should not get <q>curly</q> <q>smart</q> quote marks in verbatim text: <c>this should have "dumb" quote marks</c>. Here are a few characters that should migrate through <latex /> to a PDF unmolested:  <c>'"----"'</c></p>

            <p><c>If you write a very long snippet of inline code it can impinge on the right margin, especially if it were to begin close to that margin.  For output in LaTeX we allow line-breaking, but we do not get hyphenation and the font is fixed-width.  So not always perfect.  Consider a display (program listing as above with the pre element) or maybe reorganizing a sentence.  And it looks like a space after that left parenthesis just got ignored in the PDF created from the latex output.</c></p>

            <p>An intermediate type of verbatim text can be accomplished with the <c>&lt;cd&gt;</c> tag, short for <q>code display.</q>  It allows for larger chunks of verbatim text to show up in the middle of a paragraph, but with some vertical space above and below.  It can be<cd>authored as a single line</cd>or if you wish to have multiple lines<cd>
                <cline>there is the cline tag</cline>
                <cline>meant to model the line tag</cline>
                <cline>and short for "code line"</cline>
            </cd>and you may even<cd>
                <cline>use a single cline</cline>
            </cd>if you like to have your source closely model the visual look of the output.</p>

            <p>The <c>&lt;pre&gt;</c> tag is meant for use outside of paragraphs, but is otherwise very similar.  The source may also be structured as a sequence of <c>&lt;cline&gt;</c> as in the next example, recycling content from above.</p>

            <pre>
                <cline>If you write a very long snippet of inline </cline>
                <cline>code it can impinge on the right margin,</cline>
                <cline>especially if it were to begin close to that</cline>
                <cline>margin.  For output in LaTeX we allow line-breaking,</cline>
                <cline>but we do not get hyphenation and the font is</cline>
                <cline>fixed-width.  So not always perfect.  Consider a</cline>
                <cline>display (program listing as above with the pre element)</cline>
                <cline>or maybe reorganizing a sentence.</cline>
            </pre>

        </section>

        <section xml:id="section-programs">
            <title>Program Listings</title>

            <p>Sage cells can be used for Python examples, but Sage uses a mild amount of pre-parsing, so that might not be a wise decision, especially in instructional settings.  We might implement Skulpt or Brython (in-browser Python) or the Python language argument to the Sage Cell Server.  To see examples of authoring Sage cells, have a look at Section<nbsp /><xref ref="section-sage-cells" />.</p>

            <p>In the meantime, program listings, especially with syntax highlighting, is useful all by itself.  The <q>R</q> language might not be a bad stand-in for pseudo-code, as it supports assignment with a left arrow and has fairly generic procedural syntax for control structures and data structures.  Or maybe Pascal would be a good choice?  Here is an example of R.  Note in the source that the entire block of code is wrapped in a CDATA section due to the four left angle brackets.</p>

            <!-- Output in knowls?? -->

            <!-- Comments edited for length                                                         -->
            <!-- http://connectmv.com/tutorials/r-tutorial/programming-in-r-loops-and-flow-control/ -->
            <program language="r">
                <input>
                <![CDATA[n_loops <- 10
                x.means <- numeric(n_loops)  # create a vector of zeros for results
                for (i in 1:n_loops){
                    x <- as.integer(runif(100, 1, 7))  # 1 to 6, uniformly
                    x.means[i] <- mean(x)
                }
                x.means]]>
                </input>
            </program>

            <p>And some self-referential XSL:</p>

            <program language="xslt">
                <input>
                <![CDATA[<xsl:template match="biblio" mode="number">
                    <xsl:apply-templates select="." mode="structural-number" />
                    <xsl:text>.</xsl:text>
                    <xsl:number from="references" level="any" count="biblio" />
                </xsl:template>]]>
                </input>
            </program>

            <p>You can write made-up pseudo-code and get reasonable syntax highlighting, but you might explain to a reader what your symbols all mean.  This routine takes the <m>m\times n</m> marix <m>A</m> to reduced row-echelon form.  Note in the source the use of escaped characters for the four angle brackets.</p>

            <program>
                <input>
                input m, n and A
                r := 0
                for j := 1 to n
                   i := r+1
                   while i &lt;= m and A[i,j] == 0
                       i := i+1
                   if i &lt; m+1
                       r := r+1
                       swap rows i and r of A (row op 1)
                       scale A[r,j] to a leading 1 (row op 2)
                       for k := 1 to m, k &lt;&gt; r
                           make A[k,j] zero (row op 3, employing row r)
                output r and A
                </input>
            </program>

            <p>Look in the <c>mathbook-common.xsl</c> file to see the strings to use to identify languages.  Always all-lowercase, no symbols, no punctuation.</p>

            <p>A <c>program</c> may be nested inside a <c>listing</c>, which behaves similar to a <c>figure</c>.  You can provide a <c>caption</c>, and the listing will be numbered along with tables and figures.  This then makes it possible to cross-reference the listing, such as <xref ref="listing-c-hello" autoname="yes" />.</p>

            <listing xml:id="listing-c-hello">
                <caption>C Version of <q>Hello, World!</q></caption>
                <program language="c">
                    <input>
                    /* Hello World program */

                    #include&lt;stdio.h&gt;

                    main()
                    {
                        printf("Hello, World!");
                    }
                    </input>
                </program>
            </listing>

            <p>If you are discussing algorithms in the abstract (or even concretely), you can set them off like a theorem, with a number, a title and a target for cross-references.  Sometimes you claim an algorithm produces something in particular, or has certain properties, such as a theoretical run time, so a proof may be included.  See the discussion just preceding about (limited) options for pseudo-code.</p>

            <algorithm xml:id="algorithm-sieve-eratosthenes">
                <title>Sieve of Eratosthenes</title>
                <statement>
                    <p>On input of a positive integer <c>n</c> this algorithm will compute all the prime numbers up to, and including, <c>n</c>.  It was named for Eratosthenes of Cyrene (<circa /> 276 BC<ndash /><circa /> 195/194 BC) by Nicomachus (<circa /> 60<ndash /><circa /> 120 CE) in <booktitle>Introduction to Arithmetic</booktitle>. (<url href="http://en.wikipedia.org/wiki/Sieve_of_Eratosthenes">Wikipedia</url>, 2015)</p>

                    <ol>
                        <li><p>Input: <c>n</c></p></li>
                        <li><p>Form the list of all integers from <c>2</c> to <c>n</c></p></li>
                        <li><p>Set <c>p = 2</c></p></li>
                        <li><p>While <c>p &lt; sqrt(n)</c></p>
                            <ol label="1.">
                                <li><p>If present, remove from the list multiples <c>2p, 3p, ...</c></p></li>
                                <li><p>If <c>p</c> is now the last element of the list, stop</p></li>
                                <li><p>Otherwise, set <c>p</c> to the element of the list immediately after current <c>p</c></p></li>
                            </ol>
                        </li>
                        <li><p>Output: the remaining elements of the list</p></li>
                    </ol>
                </statement>

                <proof>
                    <p>Any element removed is a non-trivial product of two integers and hence composite.  So no prime is is ever removed from the list.</p>

                    <p>Each composite number is a multiple of some prime, and since no prime is ever removed, each composite will be removed.  Hence the removed elements are precisely the set of composite numbers in the list and thus the remainder are precisely the primes on the list.</p>
                </proof>
            </algorithm>

            <p>If you are writing about system-level software, you may need to write numbers in hexadecimal or binary.  Here we use a numbered, displayed equation (mathematics) and <latex /> macros such as <c>\texttt</c> for a monospace text font, and <c>\;</c> for spacing/grouping the bits of the binary number. <men>\texttt{6C2A}_{16} = \texttt{0110}\;\texttt{1100}\;\texttt{0010}\;\texttt{1010}_{2}</men>  If you use these constructions repeatedly, then some <latex /> macros might be useful.  It might also be beneficial for us to add some MathBook XML markup for such numbers used in a paragraph<mdash />send us a feature request.</p>

            <theorem>
                <statement>
                    <p>This is a spurious theorem to break up the run of consecutive <c>listing</c> so we might test the effect.</p>
                </statement>
            </theorem>

            <p>A specialized version of a program listing is an interactive command/response session at a command-line, where differing fonts are used to differentiate the system prompt, the user's commands, and the system's reaction.  A   <c>console</c> session may be used by itself, or it can be wrapped in a listing to get a number and a caption.  As elsewhere, you will need to escape ampersands and angle brackets (such as if you have a command using redirection), using <c>&amp;amp;</c>, <c>&amp;lt;</c>, and <c>&amp;gt;</c> in your source.  </p>

            <listing xml:id="console-raspberry-pi">
                <caption>Console Session: <c>int</c> and <c>float</c></caption>
                <console>
                    <prompt>pi@raspberrypi ~/progs/chap02 $ </prompt>
                    <input>gcc -Wall -o intAndFloat intAndFloat.c</input>
                    <prompt>pi@raspberrypi ~/progs/chap02 $ </prompt>
                    <input>./intAndFloat</input>
                    <output>
                    The integer is 19088743 and the float is 19088.742188
                    </output>
                    <prompt>pi@raspberrypi ~/progs/chap02 $ </prompt>
                    <input />
                </console>
            </listing>

            <p>If your console input exceeds more than one line, you can author it across several lines and your choice of line breaks will be reflected in the rendering.  You can decide to indent lines after the first one for clarity, if desired.  You can also decide if your audience needs line-continuation characters or not.  (But be careful, a backslash, <q><c>\</c>,</q> will require you to define the <c>latex.console.macro-char</c> xsltproc stringparam to something else, as explained below.)</p>

            <listing xml:id="console-raspberry-pi-multi">
                <caption>Console Session: <c>int</c> and <c>float</c> (multi-line input)</caption>
                <console>
                    <prompt>pi@raspberrypi ~/progs/chap02 $ </prompt>
                    <input>
                    gcc -Wall
                        -o intAndFloat intAndFloat.c
                    </input>
                    <prompt>pi@raspberrypi ~/progs/chap02 $ </prompt>
                    <input>./intAndFloat</input>
                    <output>
                    The integer is 19088743 and the float is 19088.742188
                    </output>
                    <prompt>pi@raspberrypi ~/progs/chap02 $ </prompt>
                    <input />
                </console>
            </listing>

            <p>Notice in the HTML version of the above example that when you highlight all, or a portion, of the listing for a cut<ampersand />paste that the prompts are not included.</p>

            <p>There is one subtlety with a <c>console</c> session rendered as <latex /> output.  The user input is made bold by a <latex /> macro, which means that your code cannot contain the special <latex /> characters <q><backslash /></q>, <q><lbrace /></q>, and <q><rbrace /></q>, which are used to begin a macro, begin a group, and end a group (respectively).  You will get an error message if this condition exists, and there are parameters <c>latex.console.macro-char</c>, <c>latex.console.begin-char</c>, and <c>latex.console.end-char</c> that will allow you to specify alternatives (which need to be characters that do not appear in <em>any</em> of your console sessions, document-wide).  The characters <c>&amp; % $ # _ { } ~ ^ \</c> have special meaning in <latex /> but should be available for duty as these alternative characters (though not all have been tested).  The backslash used in pathnames for Windows is a highly likely case where this needs adjustment.</p>

            <!-- & % $ # _ { } ~ ^ \ Add @ to this list as it is implemented, but need empty element to render it?-->

            <p>There is no good way to provide an example of this situation, without making a document with an error in it, out-of-the-box.  So experiment by using <c>--stringparam</c> on the <c>xsltproc</c> command-line with alternative characters that will behave with the example above, and with characters that will cause the example above to raise errors.  In practice, you may want to specify alternative characters in a thin XSL extension file specific to your project.</p>

            <p>We conclude with a longer example, an assembly language program from Bob Plantz, included to test a <c>listing</c> breaking across pages in PDF output.</p>

            <listing>
                <caption>A longer program listing</caption>
                <program>
                    <input>
                    @ structPass2.s
                    @ Allocates two structs and assigns a value to each field
                    @ in each struct, then displays the values.
                    @ Bob Plantz - 6 July 2016

                    @ Constants for assembler
                            .include "theTag_struct.s"  @ theTag struct defs.
                            .equ    y,-28           @ y struct
                            .equ    x,-16           @ x struct
                            .equ    locals,28       @ space for the structs

                    @ Constant program data
                            .section .rodata
                            .align  2
                    displayX:
                            .asciz        "x fields:\n"
                    displayY:
                            .asciz        "y fields:\n"
                    dispAChar:
                            .asciz        "         aChar = "
                    dispAnInt:
                            .asciz        "         anInt = "
                    dispOtherChar:
                            .asciz        "   anotherChar = "

                    @ The program
                            .text
                            .align  2
                            .global main
                            .type   main, %function
                    main:
                            stmfd   sp!, {r4, fp, lr}   @ save caller's info
                            add     fp, sp, #8      @ our frame pointer
                            sub     sp, sp, #locals @ for the structs

                    @ fill the x struct
                            add     r0, fp, #x      @ address of x struct
                            mov     r1, #'1
                            mov     r2, #456
                            mov     r3, #'2
                            bl      loadStruct

                    @ fill the y struct
                            add     r0, fp, #y      @ address of y struct
                            mov     r1, #'a
                            mov     r2, #123
                            mov     r3, #'b
                            bl      loadStruct

                    @ display x struct
                            add     r4, fp, #x        @ address of x struct
                            ldr     r0, displayXaddr
                            bl      writeStr
                            ldr     r0, dispACharAddr @ display aChar
                            bl      writeStr
                            ldrb    r0, [r4, #aChar]
                            bl      putChar
                            bl      newLine
                            ldr     r0, dispAnIntAddr @ display anInt
                            bl      writeStr
                            ldr     r0, [r4, #anInt]
                            bl      putDecInt
                            bl      newLine
                            ldr     r0, dispOtherCharAddr @ display anotherChar
                            bl      writeStr
                            ldrb    r0, [r4, #anotherChar]
                            bl      putChar
                            bl      newLine

                    @ display y struct
                            add     r4, fp, #y        @ address of y struct
                            ldr     r0, displayXaddr
                            bl      writeStr
                            ldr     r0, dispACharAddr @ display aChar
                            bl      writeStr
                            ldrb    r0, [r4, #aChar]
                            bl      putChar
                            bl      newLine
                            ldr     r0, dispAnIntAddr @ display anInt
                            bl      writeStr
                            ldr     r0, [r4, #anInt]
                            bl      putDecInt
                            bl      newLine
                            ldr     r0, dispOtherCharAddr @ display anotherChar
                            bl      writeStr
                            ldrb    r0, [r4, #anotherChar]
                            bl      putChar
                            bl      newLine

                            mov     r0, #0          @ return 0;
                            sub     sp, fp, #8      @ restore sp
                            ldmfd   sp!, {r4, fp, pc}   @ restore and return

                            .align  2
                    @ addresses of messages
                    displayXaddr:
                            .word   displayX
                    displayYaddr:
                            .word   displayY
                    dispACharAddr:
                            .word   dispAChar
                    dispAnIntAddr:
                            .word   dispAnInt
                    dispOtherCharAddr:
                            .word   dispOtherChar
                    </input>
                </program>
            </listing>
        </section>

        <section>
            <title>Units of Measure</title>

            <p>Units of measure can be given xml treatment too with the <c>quantity</c> element. In <latex />, the <c>siunitx</c> package is loaded to achive unit handling. Since that package only offers SI units, some other common units will be added by MBX in the preamble. In HTML, the capabilities of <c>siunitx</c> are simulated, weakly. Note that at present, you should not attempt to use the <c>quantity</c> element within a math environment.</p>
            <p>The value of gravitational constant <m>g</m> is <quantity><mag>9.8</mag><unit base="meter"/><per base="second" exp="2"/></quantity>. Force is measured in <quantity><unit prefix="kilo" base="gram"/><unit base="meter"/><per base="second" exp="2"/></quantity>, also known as one <quantity><unit base="newton"/></quantity>. A quantity with rather ridiculous units is <quantity><mag>23</mag><unit prefix='micro' base='hectare' exp='23'/><per base='degreeCelsius'/><per base='second' exp='2'/></quantity>. One <quantity><unit base="hertz"/></quantity> is the same as <quantity><per base='second'/></quantity>. You can have a unitless quantity, like <quantity><mag>42</mag></quantity>, which may help with consistency between such numbers and units in the <latex /> output. Some non-SI units are available, such as the absurd <quantity><unit base="degreeFahrenheit"/><unit base="foot"/><unit base="pound"/><per base="gallon"/></quantity>.  The <latex /> command <c>\pi</c> is recognized within <c>mag</c> in conversions to HTML, which is consistent with the behavior with a conversion to <latex />, for example there are <quantity><mag>2\pi</mag><unit base="radian"/></quantity> in a full circle.</p>

            <p>For a full list of the allowed units and prefixes, see <c>mathbook-units.xsl</c>. If you have a need for more units, they need to be added to <c>mathbook-units.xsl</c> in the section that deals with units which are not part of <c>siunitx</c> by default.  Note that the <c>mag</c> element should come first, followed by the <c>unit</c> element, followed by the <c>per</c> element.</p>

        </section>

        <section xml:id="section-side-by-side">
            <title>Side-By-Side Panels</title>

            <introduction>
              <title>Introduction</title>

              <p>A variety of different objects can be put side-by-side using the <c>sidebyside</c> element.  Specifically, <c>figure</c>, <c>table</c>, <c>paragraphs</c>, <c>image</c>, <c>tabular</c>, <c>p</c>.  The first three have some structure, the second three are atomic.  For HTML output, the entire <c>sidebyside</c> will be a knowl as a target of a cross reference, and may be born within a knowl (via the <c>html.knowl.sidebyside</c> switch).  Figures and tables (only) from within a side-by-side will be realized as knowls when the target of a cross-reference, but are never born as knowls within a side-by-side.</p>
            </introduction>

            <subsection>
                <title>Figures with Numbers Side-By-Side</title>

                <p>Figures can be put side-by-side using the <c>sidebyside</c> element; if a <q>global</q> caption is present, then the figures will be labelled as (a), (b), (c), etc; for example, see the subfigures in <xref ref="fig-sidebyside-global" autoname="yes"/>. You can, of course, reference the subfigures individually, for example: <xref ref="fig-sidebyside-subfigure" autoname="yes"/>.</p>

                <p>If a global caption is <em>not</em> present, then the figures will be labeled regularly, as for example, <xref ref="regular-figure" autoname="yes"/> and <xref ref="another-regular-figure" autoname="yes"/></p>

                <p>The <c>width</c> can be specified for each child, or omitted, in which case it will be calculated automatically based on the <em>remaining</em> width available; for finer control, it is generally best to specify the width.</p>

                <sidebyside xml:id="fig-sidebyside-global">
                    <caption>Side-by-side Figure, with subfigure children.</caption>
                    <figure width="25.67%" xml:id="fig-sidebyside-subfigure">
                        <caption></caption>
                        <image source="images/trefoil.png">
                            <description>Trefoil image</description>
                        </image>
                    </figure>
                    <figure width="25%">
                        <caption></caption>
                        <image source="images/trefoil.png"/>
                    </figure>
                </sidebyside>

                <sidebyside>
                    <caption>Side-by-side Figure, with subfigure children.</caption>
                    <figure width="50%">
                        <caption>width=50<percent/></caption>
                        <image source="images/trefoil.png"/>
                    </figure>
                    <figure width="25%">
                        <caption>width=25<percent/></caption>
                        <image source="images/trefoil.png"/>
                    </figure>
                </sidebyside>

                <sidebyside>
                    <caption>Widths can be calculated automatically</caption>
                    <figure>
                        <caption></caption>
                        <image source="images/trefoil.png"/>
                    </figure>
                    <figure>
                        <caption></caption>
                        <image source="images/trefoil.png"/>
                    </figure>
                    <figure>
                    <caption></caption>
                    <image source="images/trefoil.png"/>
                    </figure>
                </sidebyside>

                <sidebyside>
                    <figure xml:id="regular-figure">
                        <caption>Side-by-side Figures</caption>
                        <image source="images/trefoil.png"/>
                    </figure>
                    <figure xml:id="another-regular-figure">
                        <caption>Regular numbering</caption>
                        <image source="images/trefoil.png"/>
                    </figure>
                    <figure width="50%">
                        <caption>Regular numbering</caption>
                        <image source="images/trefoil.png"/>
                    </figure>
                </sidebyside>
            </subsection>

            <subsection>
                <title>Images Without Captions</title>

                <p>We can use the <c>sidebyside</c> element to put <c>images</c> next to each other; there's no need to specify the <c>width</c>, unless you want to fine tune things.</p>

                <sidebyside>
                    <image source="images/trefoil.png"/>
                    <image source="images/trefoil.png"/>
                </sidebyside>

                <p>Now we fine-tune with different widths (which add up to 100<percent />).</p>

                <sidebyside>
                    <image width="10%" source="images/trefoil.png"/>
                    <image width="30%" source="images/trefoil.png"/>
                    <image width="20%" source="images/trefoil.png"/>
                    <image width="20%" source="images/trefoil.png"/>
                    <image width="20%" source="images/trefoil.png"/>
                </sidebyside>

                <p>If you want an overall caption, but no sub-captions on your images, that is also straightforward.</p>

                <sidebyside>
                    <caption>Two equally-spaced (identical) images</caption>
                    <image source="images/trefoil.png"/>
                    <image source="images/trefoil.png"/>
                </sidebyside>



            </subsection>

            <subsection>
                <title>Vertical Alignment</title>
                <p>Vertical alignment can be specified using the (optional) <c>valign</c> attribute which can take values <c>top</c>, <c>middle</c>, and <c>bottom</c>; the default is <c>bottom</c>.</p>

                <sidebyside>
                    <figure width="33%" valign="middle">
                        <caption>Middle</caption>
                        <image source="images/trefoil.png"/>
                    </figure>
                    <figure width="17%" valign="top">
                        <caption>Top</caption>
                        <image source="images/trefoil.png"/>
                    </figure>
                    <figure width="50%" valign="middle">
                        <caption>Middle</caption>
                        <image source="images/trefoil.png"/>
                    </figure>
                </sidebyside>

                <p>We may apply the same <c>valign</c> attribute to <c>images</c> without captions.</p>

                <sidebyside>
                    <image width="10%" valign="top" source="images/trefoil.png"/>
                    <image width="10%" valign="bottom" source="images/trefoil.png"/>
                    <image width="20%" source="images/trefoil.png"/>
                    <image width="10%" valign="bottom" source="images/trefoil.png"/>
                    <image width="20%" source="images/trefoil.png"/>
                </sidebyside>
            </subsection>

            <subsection>
                <title>Text Next to Text and Images</title>

                <p>Text can be put next to other blocks of text using either the <c>paragraphs</c> element, which can contain multiple paragraphs using the <c>p</c> element.</p>

                <p>If only one paragraph is required, simply use the <c>p</c> element on its own.</p>

                <sidebyside>
                    <paragraphs width="20%" valign="middle">
                        <title>Sample title</title>
                        <p>here is some text here is some text here is some text here is some text here is some text here is some text here is some text here is some text here is some text here is some text here is some text here is some text here is some text here is some text here is some text here is some text here is some text here is some text here is some text here is some text here is some text</p>
                    </paragraphs>
                    <paragraphs width="20%" valign="top">
                        <p>here is some text here is some text here is some text here is some text here</p>
                        <p>here is some text here is some text here is some text here is some text here</p>
                        <p>here is some text here is some text here is some text here is some text here</p>
                    </paragraphs>
                    <p width="20%" valign="middle" halign="right">here is some text here is some text here is some text here is some text here</p>
                    <p width="20%" valign="bottom" halign="center">here is some text here is some text here is some text here is some text here</p>
                </sidebyside>

                <p>Similarly, text can be put next to images.</p>

                <sidebyside>
                    <p width="50%" valign="middle"> here is some text here is some text here is some text here is some text here is some text here is some text here is some text here is some text here is some text here is some text here is some text here is some text here is some text here is some text here is some text here is some text here is some text here is some text here is some text here is some text here is some text cross reference: <xref ref="text-next-to-figure" autoname="yes"/> and math: <m>x^2</m></p>
                    <image width="20%" valign="top" source="images/trefoil.png"/>
                </sidebyside>

                <p>You can even place text next to numbered figures, as shown below in <xref ref="text-next-to-figure" autoname="yes"/>.</p>

                <sidebyside>
                    <paragraphs width="50%" valign="middle">
                        <p>here is some text here is some text here is some text here is some text here is some text here is some text here is some text here is some text here is some text here is some text here is some text here is some text here is some text here is some text here is some text here is some text here is some text here is some text here is some text here is some text here is some text; cross reference: <xref ref="text-next-to-figure" autoname="yes"/> and math: <m>x^2</m></p>
                    </paragraphs>
                    <figure width="20%" valign="top" xml:id="text-next-to-figure">
                        <caption>Text next to a figure</caption>
                        <image source="images/trefoil.png" height="30" />
                    </figure>
                </sidebyside>
            </subsection>

            <subsection>
                <title>Horizontal Alignment</title>

                <p>Text can be horizontally aligned to the <c>left</c> (default), <c>center</c>, or <c>right</c> using the optional <c>halign</c> attribute.</p>

                <sidebyside>
                    <paragraphs width="20%" halign="center" valign="bottom">
                        <p>here is some text here is some text here is some text here is some text here is some text here is some text here is some text here is some text here is some text here is some text here is some text here is some text here is some text here is some text here is some text here is some text here is some text here is some text here is some text here is some text here is some text</p>
                    </paragraphs>
                    <paragraphs width="20%" halign="left" valign="top">
                        <p>here is some text here is some text here is some text here is some text here </p>
                        <p>here is some text here is some text here is some text here is some text here </p>
                        <p>here is some text here is some text here is some text here is some text here </p>
                    </paragraphs>
                    <paragraphs width="20%" halign="right" valign="middle">
                        <p>here is some text here is some text here is some text here is some text here </p>
                        <p>here is some text here is some text here is some text here is some text here </p>
                    </paragraphs>
                </sidebyside>

            </subsection>

            <subsection>
                <title>Tables Side-By-Side</title>

                <p>Tables can also be put side-by-side, as demonstrated below in <xref ref="table-sidebyside-global" autoname="yes"/>; naturally, subtables can be referenced as in <xref ref="table-sidebyside-subtable" autoname="yes"/>.</p>

                <sidebyside xml:id="table-sidebyside-global">
                    <caption>Side-by-side Table, with subtable children.</caption>
                    <table halign="left" width="50%" xml:id="table-sidebyside-subtable">
                        <caption>width=50<percent/></caption>
                        <tabular top="minor" left="minor" halign="center">
                            <col right="medium"/>
                            <col right="major"/>
                            <col />
                            <!--  -->
                            <row bottom="medium">
                                <cell>1111</cell>
                                <cell right="minor">2222</cell>
                            </row>
                            <row bottom="major">
                                <cell>aaaa</cell>
                                <cell right="medium">bbbb</cell>
                            </row>
                            <row>
                                <cell bottom="minor">AAAA</cell>
                                <cell bottom="major" right="major">BBBB</cell>
                            </row>
                        </tabular>
                    </table>
                    <table width="25%">
                        <caption>width=25<percent/></caption>
                        <tabular top="minor" left="minor" halign="center">
                            <col right="medium"/>
                            <col right="major"/>
                            <col />
                            <!--  -->
                            <row bottom="medium">
                                <cell>1111</cell>
                                <cell right="minor">2222</cell>
                            </row>
                            <row bottom="major">
                                <cell>aaaa</cell>
                                <cell right="medium">bbbb</cell>
                            </row>
                            <row>
                                <cell bottom="minor">AAAA</cell>
                                <cell bottom="major" right="major">BBBB</cell>
                            </row>
                        </tabular>
                    </table>
                </sidebyside>
                <sidebyside>
                    <caption>Widths can be calculated automatically.</caption>
                    <table>
                        <caption></caption>
                        <tabular top="minor" left="minor" halign="center">
                            <col right="medium"/>
                            <col right="major"/>
                            <col />
                            <!--  -->
                            <row bottom="medium">
                                <cell>1111</cell>
                                <cell right="minor">2222</cell>
                            </row>
                            <row bottom="major">
                                <cell>aaaa</cell>
                                <cell right="medium">bbbb</cell>
                            </row>
                            <row>
                                <cell bottom="minor">AAAA</cell>
                                <cell bottom="major" right="major">BBBB</cell>
                            </row>
                        </tabular>
                    </table>
                    <table>
                        <caption></caption>
                        <tabular top="minor" left="minor" halign="center">
                            <col right="medium"/>
                            <col right="major"/>
                            <col />
                            <!--  -->
                            <row bottom="medium">
                                <cell>1111</cell>
                                <cell right="minor">2222</cell>
                            </row>
                            <row bottom="major">
                                <cell>aaaa</cell>
                                <cell right="medium">bbbb</cell>
                            </row>
                            <row>
                                <cell bottom="minor">AAAA</cell>
                                <cell bottom="major" right="major">BBBB</cell>
                            </row>
                        </tabular>
                    </table>
                </sidebyside>

                <!-- the "Tables" content interior to the xref will override any autonaming -->
                <p>If you put two <c>table</c> elements side-by-side without a <q>global</q> caption, then they will use regular numbering; see <xref first="table-regular-fig1" last="table-regular-fig3">Tables</xref>.</p>

                <sidebyside>
                    <table xml:id="table-regular-fig1">
                        <caption></caption>
                        <tabular top="minor" left="minor" halign="center">
                            <col right="medium"/>
                            <col right="major"/>
                            <col />
                            <!--  -->
                            <row bottom="medium">
                                <cell>1111</cell>
                                <cell right="minor">2222</cell>
                            </row>
                            <row bottom="major">
                                <cell>aaaa</cell>
                                <cell right="medium">bbbb</cell>
                            </row>
                            <row>
                                <cell bottom="minor">AAAA</cell>
                                <cell bottom="major" right="major">BBBB</cell>
                            </row>
                        </tabular>
                    </table>
                    <table xml:id="table-regular-fig2">
                        <caption></caption>
                        <tabular top="minor" left="minor" halign="center">
                            <col right="medium"/>
                            <col right="major"/>
                            <col />
                            <!--  -->
                            <row bottom="medium">
                                <cell>1111</cell>
                                <cell right="minor">2222</cell>
                            </row>
                            <row bottom="major">
                                <cell>aaaa</cell>
                                <cell right="medium">bbbb</cell>
                            </row>
                            <row>
                                <cell bottom="minor">AAAA</cell>
                                <cell bottom="major" right="major">BBBB</cell>
                            </row>
                        </tabular>
                    </table>
                    <table xml:id="table-regular-fig3">
                        <caption></caption>
                        <tabular top="minor" left="minor" halign="center">
                            <col right="medium"/>
                            <col right="major"/>
                            <col />
                            <!--  -->
                            <row bottom="medium">
                                <cell>1111</cell>
                                <cell right="minor">2222</cell>
                            </row>
                            <row bottom="major">
                                <cell>aaaa</cell>
                                <cell right="medium">bbbb</cell>
                            </row>
                            <row>
                                <cell bottom="minor">AAAA</cell>
                                <cell bottom="major" right="major">BBBB</cell>
                            </row>
                        </tabular>
                    </table>
                </sidebyside>
            </subsection>

            <subsection>
                <title>Horizontal and Vertical Alignment</title>

                <p>Tables within the <c>sidebyside</c> element can accept the <c>halign</c> and <c>valign</c> attributes; see <xref ref="table-regular-halign-demo" /> and <xref ref="table-regular-valign-demo" />. The <c>halign</c> attribute can take values <c>left</c>, <c>center</c> (default), and <c>right</c>; the <c>valign</c> attribute can take values <c>top</c>, <c>middle</c>, and <c>bottom</c> (default).</p>

                <sidebyside>
                    <caption>Global Caption</caption>
                    <table>
                        <caption></caption>
                        <tabular top="minor" left="minor" halign="center">
                            <col right="medium"/>
                            <col right="major"/>
                            <col />
                            <!--  -->
                            <row bottom="medium">
                                <cell>1111</cell>
                                <cell right="minor">2222</cell>
                            </row>
                            <row bottom="major">
                                <cell>aaaa</cell>
                                <cell right="medium">bbbb</cell>
                            </row>
                            <row>
                                <cell bottom="minor">AAAA</cell>
                                <cell bottom="major" right="major">BBBB</cell>
                            </row>
                        </tabular>
                    </table>
                    <table xml:id="table-regular-halign-demo" halign="right">
                        <caption>halign="right"</caption>
                        <tabular top="minor" left="minor" halign="center">
                            <col right="medium"/>
                            <col right="major"/>
                            <col />
                            <!--  -->
                            <row bottom="medium">
                                <cell>1111</cell>
                                 <cell right="minor">2222</cell>
                            </row>
                            <row bottom="major">
                                <cell>aaaa</cell>
                                <cell right="medium">bbbb</cell>
                            </row>
                            <row>
                                <cell bottom="minor">AAAA</cell>
                                <cell bottom="major" right="major">BBBB</cell>
                            </row>
                        </tabular>
                    </table>
                    <table xml:id="table-regular-valign-demo" valign="top">
                        <caption>valign="top"</caption>
                        <tabular top="minor" left="minor" halign="center">
                            <col right="medium"/>
                            <col right="major"/>
                            <col />
                            <!--  -->
                            <row bottom="medium">
                                <cell>1111</cell>
                                <cell right="minor">2222</cell>
                            </row>
                            <row bottom="major">
                                <cell>aaaa</cell>
                                <cell right="medium">bbbb</cell>
                            </row>
                            <row>
                                <cell bottom="minor">AAAA</cell>
                                <cell bottom="major" right="major">BBBB</cell>
                            </row>
                        </tabular>
                    </table>
                </sidebyside>
            </subsection>

            <subsection>
                <title>Tables Next to Figures</title>

                <p>Tables and Figures can go next to each other, as demonstrated in <xref ref="table-next-figure" autoname="yes"/> and <xref ref="figure-next-table" autoname="yes"/>, plus within an overall captioned figure, <xref ref="figure-table-captioned" autoname="yes"/>.</p>

                <sidebyside>
                    <table xml:id="table-next-figure">
                        <caption>Table next to a Figure</caption>
                        <tabular top="minor" left="minor" halign="center">
                            <col right="medium"/>
                            <col right="major"/>
                            <col />
                            <!--  -->
                            <row bottom="medium">
                                <cell>1111</cell>
                                <cell right="minor">2222</cell>
                            </row>
                            <row bottom="major">
                                <cell>aaaa</cell>
                                <cell right="medium">bbbb</cell>
                            </row>
                            <row>
                                <cell bottom="minor">AAAA</cell>
                                <cell bottom="major" right="major">BBBB</cell>
                             </row>
                        </tabular>
                    </table>
                    <!--  -->
                    <figure xml:id="figure-next-table">
                        <caption>Figure next to a Table</caption>
                        <image source="images/trefoil.png"/>
                    </figure>
                </sidebyside>

                <sidebyside xml:id="figure-table-captioned">
                    <caption>Figure and Table, Captioned, so Sublabeled</caption>
                    <table xml:id="table-next-figure-sublabeled">
                        <caption>Table next to a Figure</caption>
                        <tabular top="minor" left="minor" halign="center">
                            <col right="medium"/>
                            <col right="major"/>
                            <col />
                            <!--  -->
                            <row bottom="medium">
                                <cell>1111</cell>
                                <cell right="minor">2222</cell>
                            </row>
                            <row bottom="major">
                                <cell>aaaa</cell>
                                <cell right="medium">bbbb</cell>
                            </row>
                            <row>
                                <cell bottom="minor">AAAA</cell>
                                <cell bottom="major" right="major">BBBB</cell>
                             </row>
                        </tabular>
                    </table>
                    <!--  -->
                    <figure xml:id="figure-next-table-sublabeled">
                        <caption>Figure next to a Table</caption>
                        <image source="images/trefoil.png"/>
                    </figure>
                </sidebyside>
            </subsection>

            <subsection>
                <title>Tables Next to Text</title>

                <p>Tables can go next to text blocks.</p>

                <sidebyside>
                    <table valign="top">
                        <caption>Table next to text</caption>
                        <tabular top="minor" left="minor" halign="center">
                            <col right="medium"/>
                            <col right="major"/>
                            <col />
                            <!--  -->
                            <row bottom="medium">
                                <cell>1111</cell>
                                <cell right="minor">2222</cell>
                            </row>
                            <row bottom="major">
                                <cell>aaaa</cell>
                                <cell right="medium">bbbb</cell>
                            </row>
                            <row>
                                <cell bottom="minor">AAAA</cell>
                                <cell bottom="major" right="major">BBBB</cell>
                            </row>
                        </tabular>
                    </table>
                    <paragraphs width="20%" halign="left" valign="top">
                        <p>here is some text here is some text here is some text here is some text here </p>
                        <p>here is some text here is some text here is some text here is some text here </p>
                        <p>here is some text here is some text here is some text here is some text here </p>
                    </paragraphs>
                    <paragraphs width="20%" halign="center" valign="middle">
                        <p>here is some text here is some text here is some text here is some text here </p>
                        <p>here is some text here is some text here is some text here is some text here </p>
                    </paragraphs>
                </sidebyside>
            </subsection>

            <subsection>
                <title>Tables Without Captions Next to Each Other</title>

                <p>Tables can go next to each other without captions using the <c>tabular</c> element.</p>

                <sidebyside>
                    <tabular top="minor" left="minor" halign="center">
                        <col right="medium"/>
                        <col right="major"/>
                        <col />
                        <!--  -->
                        <row bottom="medium">
                            <cell>1111</cell>
                            <cell right="minor">2222</cell>
                        </row>
                        <row bottom="major">
                            <cell>aaaa</cell>
                            <cell right="medium">bbbb</cell>
                        </row>
                        <row>
                            <cell bottom="minor">AAAA</cell>
                            <cell bottom="major" right="major">BBBB</cell>
                        </row>
                        <row>
                            <cell>CCCC</cell>
                            <cell>DDDD</cell>
                        </row>
                    </tabular>
                    <tabular valign="top" top="minor" left="minor" halign="center">
                        <col right="medium"/>
                        <col right="major"/>
                        <col />
                        <!--  -->
                        <row bottom="medium">
                            <cell>1111</cell>
                            <cell right="minor">2222</cell>
                        </row>
                        <row bottom="major">
                            <cell>aaaa</cell>
                            <cell right="medium">bbbb</cell>
                        </row>
                        <row>
                            <cell bottom="minor">AAAA</cell>
                            <cell bottom="major" right="major">BBBB</cell>
                        </row>
                    </tabular>
                    <tabular valign="middle" top="minor" left="minor" halign="center">
                        <col right="medium"/>
                        <col right="major"/>
                        <col />
                        <!--  -->
                        <row bottom="medium">
                            <cell>1111</cell>
                            <cell right="minor">2222</cell>
                        </row>
                        <row bottom="major">
                            <cell>aaaa</cell>
                            <cell right="medium">bbbb</cell>
                        </row>
                        <row>
                            <cell bottom="minor">AAAA</cell>
                            <cell bottom="major" right="major">BBBB</cell>
                        </row>
                    </tabular>
                    <tabular top="minor" left="minor" halign="center">
                        <col right="medium"/>
                        <col right="major"/>
                        <col />
                        <!--  -->
                        <row bottom="medium">
                            <cell>1111</cell>
                            <cell right="minor">2222</cell>
                        </row>
                        <row bottom="major">
                            <cell>aaaa</cell>
                            <cell right="medium">bbbb</cell>
                        </row>
                        <row>
                            <cell bottom="minor">AAAA</cell>
                            <cell bottom="major" right="major">BBBB</cell>
                        </row>
                    </tabular>
                </sidebyside>
            </subsection>

            <subsection>
                <title>Other Objects </title>

                <p>Other objects such as lists can be put in the <c>sidebyside</c> element.</p>

                <sidebyside>
                    <paragraphs>
                        <ol>
                            <li><p>Footnotes: Fermat allusion at <xref ref="footnote-fermat" />.</p></li>
                            <li><p>Examples: Mystery derivative at <xref ref="example-mysterious" />.</p></li>
                            <li><p>Definition-like: A mathematical statement with no proof <xref ref="principle-principle" />.</p></li>
                            <li><p>Figures: An early plot, Figure<nbsp /><xref ref="figure-function-derivative" />.</p></li>
                        </ol>
                    </paragraphs>
                    <paragraphs>
                        <ul>
                            <li><p>Footnotes: Fermat allusion at <xref ref="footnote-fermat" />.</p></li>
                            <li><p>Examples: Mystery derivative at <xref ref="example-mysterious" />.</p></li>
                            <li><p>Definition-like: A mathematical statement with no proof <xref ref="principle-principle" />.</p></li>
                            <li><p>Figures: An early plot, Figure<nbsp /><xref ref="figure-function-derivative" />.</p></li>
                        </ul>
                    </paragraphs>
                </sidebyside>

                <p>You can even experiment with <em>aligned</em> equations in the <c>sidebyside</c> element.</p>

                <sidebyside>
                    <paragraphs valign="middle">
                        <p>here is some text, and here is an equation that contains alignment.<md>
                            <mrow>f(x)&amp;= x^2+3x+2</mrow>
                            <mrow>&amp;=(x+2)(x+1)</mrow>
                        </md></p>
                    </paragraphs>
                    <paragraphs>
                        <p>here is some text, and here is an equation that contains alignment.<md>
                            <mrow>f(x)&amp;= x^2+3x+2</mrow>
                            <mrow>&amp;=(x+2)(x+1)</mrow>
                        </md></p>
                        <p>here is some text, and here is an equation that contains alignment.<md>
                            <mrow>f(x)&amp;= x^2+3x+2</mrow>
                            <mrow>&amp;=(x+2)(x+1)</mrow>
                        </md></p>
                    </paragraphs>
                </sidebyside>
            </subsection>
        </section>

        <section xml:id="poetry">
            <title>Poetry</title>

            <p>There is support for basic poems via the <c>poem</c> tag, which can contain a <c>title</c>, <c>author</c> and multiple <c>stanza</c>, each containing multiple <c>line</c>.  See the source of the following poem for an example of the exact arrangement.  Note how the first quote crosses two <c>line</c> elements and how this is handled in the source.  Various enhancements are possible, send requests.</p>

            <poem width="30">
                <title>The Charge of the Light Brigade</title>
                <author>Alfred Lord Tennyson</author>

                <stanza>
                    <line>Half a league, half a league,</line>
                    <line>Half a league onward,</line>
                    <line>All in the valley of Death</line>
                    <line>Rode the six hundred.</line>
                    <line><lq />Forward, the Light Brigade!</line>
                    <line>Charge for the guns!<rq /> he said:</line>
                    <line>Into the valley of Death</line>
                    <line>Rode the six hundred.</line>
                </stanza>

                <stanza>
                    <line><q>Forward, the Light Brigade!</q></line>
                    <line>Was there a man dismay'd?</line>
                    <line>Not tho' the soldier knew</line>
                    <line>Someone had blunder'd:</line>
                    <line>Theirs not to make reply,</line>
                    <line>Theirs not to reason why,</line>
                    <line>Theirs but to do and die:</line>
                    <line>Into the valley of Death</line>
                    <line>Rode the six hundred.</line>
                </stanza>
            </poem>

        </section>

        <section xml:id="advanced-numbering">
            <title>Advanced Numbering</title>

            <introduction>
                <p>This section demonstrates the numbering patterns used throughout MathBook XML.  There are five subsections.  Two intermediate subsections each have two subsubsections.  This creates a total of seven divisions that are leaves of the document tree.  In each leaf we have placed two numbered theorems, for a total of fourteen.  There is no real content, this is just a demonstration.</p>

                <p>Use values of <c>0</c> through <c>3</c> for the <c>numbering.theorems.level</c> parameter to see how these numbers change accordingly.  It is easiest to compare if you use <c>chunk.level &lt; 2</c> so the theorems all land on the same page if you are previewing in HTML.</p>
            </introduction>

            <subsection>
                <title>One</title>

                <p>A document leaf.</p>

                <theorem xml:id="theorem-number-01">
                    <title>First Theorem</title>
                    <statement><p>No statement.</p></statement>
                </theorem>

                <theorem xml:id="theorem-number-02">
                    <title>Second Theorem</title>
                    <statement><p>No statement.</p></statement>
                </theorem>

            </subsection>

            <subsection>
                <title>Two</title>

                <introduction><p>Further subdivided.</p></introduction>

                <subsubsection>
                    <title>Uno</title>

                    <p>A document leaf.</p>

                    <theorem xml:id="theorem-number-03">
                        <title>First Theorem</title>
                        <statement><p>No statement.</p></statement>
                    </theorem>

                    <theorem xml:id="theorem-number-04">
                        <title>Second Theorem</title>
                        <statement><p>No statement.</p></statement>
                    </theorem>

                </subsubsection>

                <subsubsection>
                    <title>Dos</title>

                    <p>A document leaf.</p>

                    <theorem xml:id="theorem-number-05">
                        <title>First Theorem</title>
                        <statement><p>No statement.</p></statement>
                    </theorem>

                    <theorem xml:id="theorem-number-06">
                        <title>Second Theorem</title>
                        <statement><p>No statement.</p></statement>
                    </theorem>

                </subsubsection>

            </subsection>

            <subsection>
                <title>Three</title>

                <p>A document leaf.</p>

                <theorem xml:id="theorem-number-07">
                    <title>First Theorem</title>
                    <statement><p>No statement.</p></statement>
                </theorem>

                <theorem xml:id="theorem-number-08">
                    <title>Second Theorem</title>
                    <statement><p>No statement.</p></statement>
                </theorem>

            </subsection>

            <subsection>
                <title>Four</title>

                <introduction>
                    <p>Further subdivided.  We include two theorems as numbered items in the introduction to test their numbers, which should always be logical.</p>

                    <theorem xml:id="theorem-good-one">
                        <title>Good Numbered Theorem One</title>
                        <statement><p>No statement.</p></statement>
                    </theorem>

                    <theorem xml:id="theorem-good-two">
                        <title>Good Numbered Theorem Two</title>
                        <statement><p>No statement.</p></statement>
                    </theorem>

                </introduction>

                <subsubsection>
                    <title>Uno</title>

                    <p>A document leaf.</p>

                    <theorem xml:id="theorem-number-09">
                        <title>First Theorem</title>
                        <statement><p>No statement.</p></statement>
                    </theorem>

                    <theorem xml:id="theorem-number-10">
                        <title>Second Theorem</title>
                        <statement><p>No statement.</p></statement>
                    </theorem>

                </subsubsection>

                <subsubsection>
                    <title>Dos</title>

                    <p>A document leaf.</p>

                    <theorem xml:id="theorem-number-11">
                        <title>First Theorem</title>
                        <statement><p>No statement.</p></statement>
                    </theorem>

                    <theorem xml:id="theorem-number-12">
                        <title>Second Theorem</title>
                        <statement><p>No statement.</p></statement>
                    </theorem>

                </subsubsection>

                <conclusion>
                    <p>Conclusion now.  We include two theorems as numbered items in the conclusion to test their numbers, which are sometimes totally illogical and are inconsistent across output formats.  To see the effect, use <c>--stringparam numbering.theorems.level 3</c> in the <c>xsltproc</c> invocation. See this GitHub <url href="https://github.com/rbeezer/mathbook/issues/139">issue</url> for details.</p>

                    <theorem xml:id="theorem-bad-one">
                        <title>Bad Numbered Theorem One</title>
                        <statement><p>No statement.</p></statement>
                    </theorem>

                    <theorem xml:id="theorem-bad-two">
                        <title>Bad Numbered Theorem Two</title>
                        <statement><p>No statement.</p></statement>
                    </theorem>

                </conclusion>
            </subsection>

            <subsection>
                <title>Five</title>

                <p>A document leaf.</p>

                <theorem xml:id="theorem-number-13">
                    <title>First Theorem</title>
                    <statement><p>No statement.</p></statement>
                </theorem>

                <theorem xml:id="theorem-number-14">
                    <title>Second Theorem</title>
                    <statement><p>No statement.</p></statement>
                </theorem>

            </subsection>

            <subsection xml:id="subsection-local-theorems">
                <title>Theorems in This Section</title>

                <p>We have a lot of theorems in this section, so we illustrate including an automatic list of these here.  We use the <c>elements</c> attribute to limit the list to <c>theorem</c> elements, and we use the <c>scope</c> attribute to limit the list to this <c>section</c>.  You can use an introductory <c>p</c> like this one, or not.  The list gets no title or visual separation, so use the usual subdivision elements to make that happen.  The <c>elements</c> attribute can be a space-delimited list of many different elements.  This list should not include the Fundamental Theorem of Calculus, Theorem<nbsp /><xref ref="theorem-FTC" />.  See a slightly different example in <xref ref="appendix-results" autoname="yes" />.</p>

                <list-of elements="theorem" scope="section" />
            </subsection>
        </section>

        <section>
            <title>Customizations</title>

            <subsection xml:id="rename-facility">
                <title>Renaming Document Parts</title>

                <p><q>Names</q> for various parts of a document are determined exactly once for each language, ensuring consistency and saving you the bother of always typing them in.</p>

                <p>However, you may want to have <q>Conundrum</q>s in your document and you have no use for any <q>Proposition</q>s.  So you can repurpose the <c>proposition</c> tag to render a different name.  Or you might have a Lab Manual and want to rename <c>subsection</c> as <q>Activity</q>.  See the <c>docinfo</c> portion of this sample article to see how this is done, in concert with the example below.</p>

                <proposition xml:id="proposition-as-conundrum">
                    <statement>
                        <p>Aah, this <em>is</em> confusing!</p>
                    </statement>
                </proposition>

                <paragraphs>
                    <title>Important Notes</title>

                    <p>If you are renaming many parts of your document, then you may not understand the design philosophy of MathBook XML.  In particular, you should not be doing a wholesale shuffle of <c>part</c>, <c>chapter</c>, <c>section</c>, <etc />  This feature is intended for very limited use and is <em>not considered best practice</em>.</p>

                    <p>This feature could also be abused to provide a comprehensive suite of translations into a language not yet supported.  If so, please contact us about moving your translations into MathBook XML for the benefit of all.  Thanks.</p>
                </paragraphs>

            </subsection>

        </section>



        <backmatter xml:id="backmatter">
            <title>Reference</title>

            <appendix>
                <title>Notation</title>
                <p>This is some notation introduced in the article.</p>
                <notation-list />
            </appendix>

            <appendix>
                <title>Solutions to Selected Exercises</title>
                <solution-list />
            </appendix>

            <appendix xml:id="appendix-results">
                <title>List of Results</title>

                <p>We had an automatic list of theorems for just one section, back in <xref ref="subsection-local-theorems" autoname="yes" />.  Here we expand to include <c>corollary</c> in our space-delimited list of <c>elements</c> and we request <c>divisions</c> (headings) at each <c>subsection</c> and <c>section</c>.  The default <c>scope</c> is the entire document, which is appropriate here in the backmatter.  There are many subsections with no results, so we set the <c>empty</c> attribute to <c>no</c> to suppress them, though this is the default behavior (<c>yes</c> being the other option to see divisions with no list items).  These lists are most valuable if you are in the practice of giving items titles.</p>

                <list-of elements="  theorem corollary" divisions="section    subsection " empty="no" />
            </appendix>

            <!-- Bibliography/References can appear anywhere, -->
            <!-- but these are in the backmatter              -->

            <references>
                <title>References</title>

                <biblio type="raw" xml:id="biblio-judson-AATA">Tom Judson, <title>Abstract Algebra: Theory and Applications</title>.
                <note xml:id="note-judson-AATA"><p>Another online, open-source offering.</p></note>
                </biblio>

                <biblio type="raw" xml:id="biblio-lay-article">David C. Lay, <title>Subspaces and Echelon Forms</title>. <journal>The College Mathematics Journal</journal>, January 1993, <volume>24</volume> <number>1</number>, 57<ndash />62.</biblio>

                <conclusion>
                    <p>There is an index manufactured in the next subdivision (so we are talking about here), which contains just a few sample entries.  Look at the source of this XML file, searching on <c>&gt;index&lt;</c>, to see how they are written.  They may be placed inside of a a variety of structures, and their location greatly influences the cross-references produced in the HTML version of the index.</p>

                    <p>The <latex /> version of the index is more traditional, using page numbers to reference locations.  A newer package is used to create the index, and so there is no extra intermediate step required to process the index.  The one downside of this convenience is that index entries may not be placed in the back colophon (which is the only subdivision that may follow the index).</p>

                    <p>There is an index entry about multicolumn lists which spans more than one page.  This requires doubly-linked index entries, the first has the index content and points to the <c>xml:id</c> of the second.  The second is an empty element, but points back to the <c>xml:id</c> of the first entry.  So each has a marker and a reference, which allows the span of the index topic to cut across XML boundaries in the source.  This is the mechanism to produce a page range in the <latex /> index.  See the source of this article for syntax details.</p>
                </conclusion>
            </references>

            <index-part >
                <title>Index</title>
                <index-list />
            </index-part>

            <colophon>
                <p>This article was authored in MathBook XML.</p>
            </colophon>
        </backmatter>
    </article>
</mathbook>
